"use strict";var __defProp=Object.defineProperty,__name=(target,value)=>__defProp(target,"name",{value,configurable:!0});exports.id=926,exports.ids=[926],exports.modules={3137:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D:()=>debounce});var _innerSubscribe__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5814);function debounce(durationSelector){return source=>source.lift(new DebounceOperator(durationSelector))}__name(debounce,"debounce");class DebounceOperator{constructor(durationSelector){this.durationSelector=durationSelector}call(subscriber,source){return source.subscribe(new DebounceSubscriber(subscriber,this.durationSelector))}}__name(DebounceOperator,"DebounceOperator");class DebounceSubscriber extends _innerSubscribe__WEBPACK_IMPORTED_MODULE_0__.Ds{constructor(destination,durationSelector){super(destination),this.durationSelector=durationSelector,this.hasValue=!1}_next(value){try{const result=this.durationSelector.call(this,value);result&&this._tryNext(value,result)}catch(err){this.destination.error(err)}}_complete(){this.emitValue(),this.destination.complete()}_tryNext(value,duration){let subscription=this.durationSubscription;this.value=value,this.hasValue=!0,subscription&&(subscription.unsubscribe(),this.remove(subscription)),subscription=(0,_innerSubscribe__WEBPACK_IMPORTED_MODULE_0__.ft)(duration,new _innerSubscribe__WEBPACK_IMPORTED_MODULE_0__.IY(this)),subscription&&!subscription.closed&&this.add(this.durationSubscription=subscription)}notifyNext(){this.emitValue()}notifyComplete(){this.emitValue()}emitValue(){if(this.hasValue){const value=this.value,subscription=this.durationSubscription;subscription&&(this.durationSubscription=void 0,subscription.unsubscribe(),this.remove(subscription)),this.value=void 0,this.hasValue=!1,super._next(value)}}}__name(DebounceSubscriber,"DebounceSubscriber")},3834:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{YA:()=>CART_VALIDATION_NORMALIZER,$:()=>cartGroup_actions,YW:()=>CartAdapter,Jp:()=>CartBaseCoreModule,r_:()=>CartConfigService,CQ:()=>CartConnector,vI:()=>CartEntryAdapter,n5:()=>CartValidationAdapter,i4:()=>CartValidationGuard,Eu:()=>CartVoucherAdapter,N4:()=>MULTI_CART_DATA,F5:()=>multiCartGroup_selectors,Qx:()=>ProductImportInfoService,T6:()=>getCartIdByUserId,xb:()=>isEmpty,F7:()=>isSelectiveCart});var core=__webpack_require__(305),spartacus_core=__webpack_require__(9345),ngrx_store=__webpack_require__(7776),spartacus_cart_base_root=__webpack_require__(405),map=__webpack_require__(6466),concatMap=__webpack_require__(6942),catchError=__webpack_require__(2155),mergeMap=__webpack_require__(7505),groupBy=__webpack_require__(5677),switchMap=__webpack_require__(3714),withLatestFrom=__webpack_require__(9320),filter=__webpack_require__(2026),distinctUntilChanged=__webpack_require__(3029);function distinctUntilKeyChanged(key,compare){return(0,distinctUntilChanged.x)((x,y)=>compare?compare(x[key],y[key]):x[key]===y[key])}__name(distinctUntilKeyChanged,"distinctUntilKeyChanged");var tap=__webpack_require__(5171),take=__webpack_require__(5426),switchMapTo=__webpack_require__(6399),shareReplay=__webpack_require__(1753),pairwise=__webpack_require__(5872),debounce=__webpack_require__(3137),from=__webpack_require__(6904),of=__webpack_require__(5202),Subscription=__webpack_require__(1765),using=__webpack_require__(9156),combineLatest=__webpack_require__(85),ReplaySubject=__webpack_require__(8834),timer=__webpack_require__(6424),empty=__webpack_require__(4614),ngrx_effects=__webpack_require__(8468),spartacus_storefront=__webpack_require__(3525),spartacus_user_profile_root=__webpack_require__(8518),common=__webpack_require__(9318),router=__webpack_require__(8258);const MULTI_CART_DATA="[Multi Cart] Multi Cart Data";class CartAddEntry extends spartacus_core.kPG.EntityProcessesIncrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Add Entry"}}__name(CartAddEntry,"CartAddEntry");class CartAddEntrySuccess extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Add Entry Success"}}__name(CartAddEntrySuccess,"CartAddEntrySuccess");class CartAddEntryFail extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Add Entry Fail"}}__name(CartAddEntryFail,"CartAddEntryFail");class CartRemoveEntry extends spartacus_core.kPG.EntityProcessesIncrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Remove Entry"}}__name(CartRemoveEntry,"CartRemoveEntry");class CartRemoveEntrySuccess extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Remove Entry Success"}}__name(CartRemoveEntrySuccess,"CartRemoveEntrySuccess");class CartRemoveEntryFail extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Remove Entry Fail"}}__name(CartRemoveEntryFail,"CartRemoveEntryFail");class CartUpdateEntry extends spartacus_core.kPG.EntityProcessesIncrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Update Entry"}}__name(CartUpdateEntry,"CartUpdateEntry");class CartUpdateEntrySuccess extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Update Entry Success"}}__name(CartUpdateEntrySuccess,"CartUpdateEntrySuccess");class CartUpdateEntryFail extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Update Entry Fail"}}__name(CartUpdateEntryFail,"CartUpdateEntryFail");const CART_ADD_VOUCHER="[Cart-voucher] Add Cart Vouchers",CART_ADD_VOUCHER_SUCCESS="[Cart-voucher] Add Cart Voucher Success",CART_REMOVE_VOUCHER="[Cart-voucher] Remove Cart Voucher";class CartAddVoucher extends spartacus_core.kPG.EntityLoadAction{constructor(payload){super(spartacus_core.BzF,"addVoucher"),this.payload=payload,this.type=CART_ADD_VOUCHER}}__name(CartAddVoucher,"CartAddVoucher");class CartAddVoucherFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(spartacus_core.BzF,"addVoucher",payload.error),this.payload=payload,this.type="[Cart-voucher] Add Cart Voucher Fail"}}__name(CartAddVoucherFail,"CartAddVoucherFail");class CartAddVoucherSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(spartacus_core.BzF,"addVoucher"),this.payload=payload,this.type=CART_ADD_VOUCHER_SUCCESS}}__name(CartAddVoucherSuccess,"CartAddVoucherSuccess");class CartResetAddVoucher extends spartacus_core.kPG.EntityLoaderResetAction{constructor(){super(spartacus_core.BzF,"addVoucher"),this.type="[Cart-voucher] Reset Add Cart Voucher"}}__name(CartResetAddVoucher,"CartResetAddVoucher");class CartRemoveVoucher extends spartacus_core.kPG.EntityProcessesIncrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=CART_REMOVE_VOUCHER}}__name(CartRemoveVoucher,"CartRemoveVoucher");class CartRemoveVoucherFail extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-voucher] Remove Cart Voucher Fail"}}__name(CartRemoveVoucherFail,"CartRemoveVoucherFail");class CartRemoveVoucherSuccess extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-voucher] Remove Cart Voucher Success"}}__name(CartRemoveVoucherSuccess,"CartRemoveVoucherSuccess");const CREATE_CART="[Cart] Create Cart",CREATE_CART_SUCCESS="[Cart] Create Cart Success",LOAD_CART="[Cart] Load Cart",LOAD_CART_SUCCESS="[Cart] Load Cart Success",LOAD_CARTS_SUCCESS="[Cart] Load Carts Success",REMOVE_CART="[Cart] Remove Cart",DELETE_CART="[Cart] Delete Cart",DELETE_CART_SUCCESS="[Cart] Delete Cart Success";class CreateCart extends spartacus_core.kPG.EntityLoadAction{constructor(payload){super(MULTI_CART_DATA,payload.tempCartId),this.payload=payload,this.type=CREATE_CART}}__name(CreateCart,"CreateCart");class CreateCartFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(MULTI_CART_DATA,payload.tempCartId),this.payload=payload,this.type="[Cart] Create Cart Fail"}}__name(CreateCartFail,"CreateCartFail");class CreateCartSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=CREATE_CART_SUCCESS}}__name(CreateCartSuccess,"CreateCartSuccess");class AddEmailToCart extends spartacus_core.kPG.EntityProcessesIncrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart] Add Email to Cart"}}__name(AddEmailToCart,"AddEmailToCart");class AddEmailToCartFail extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart] Add Email to Cart Fail"}}__name(AddEmailToCartFail,"AddEmailToCartFail");class AddEmailToCartSuccess extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart] Add Email to Cart Success"}}__name(AddEmailToCartSuccess,"AddEmailToCartSuccess");class LoadCart extends spartacus_core.kPG.EntityLoadAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=LOAD_CART}}__name(LoadCart,"LoadCart");class LoadCartFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId,payload.error),this.payload=payload,this.type="[Cart] Load Cart Fail"}}__name(LoadCartFail,"LoadCartFail");class LoadCartSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=LOAD_CART_SUCCESS}}__name(LoadCartSuccess,"LoadCartSuccess");class LoadCartsSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(MULTI_CART_DATA,payload.map(cart=>cart?.code??"")),this.payload=payload,this.type=LOAD_CARTS_SUCCESS}}__name(LoadCartsSuccess,"LoadCartsSuccess");class MergeCart{constructor(payload){this.payload=payload,this.type="[Cart] Merge Cart"}}__name(MergeCart,"MergeCart");class MergeCartSuccess extends spartacus_core.kPG.EntityRemoveAction{constructor(payload){super(MULTI_CART_DATA,payload.oldCartId),this.payload=payload,this.type="[Cart] Merge Cart Success"}}__name(MergeCartSuccess,"MergeCartSuccess");class ResetCartDetails extends spartacus_core.kPG.ProcessesLoaderResetAction{constructor(){super(MULTI_CART_DATA),this.type="[Cart] Reset Cart Details"}}__name(ResetCartDetails,"ResetCartDetails");class RemoveCart extends spartacus_core.kPG.EntityRemoveAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=REMOVE_CART}}__name(RemoveCart,"RemoveCart");class DeleteCart{constructor(payload){this.payload=payload,this.type=DELETE_CART}}__name(DeleteCart,"DeleteCart");class DeleteCartSuccess extends spartacus_core.kPG.EntityRemoveAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=DELETE_CART_SUCCESS}}__name(DeleteCartSuccess,"DeleteCartSuccess");class DeleteCartFail{constructor(payload){this.payload=payload,this.type="[Cart] Delete Cart Fail"}}__name(DeleteCartFail,"DeleteCartFail");const CLEAR_CART_STATE="[Cart] Clear Cart State",SET_CART_TYPE_INDEX="[Cart] Set cart type index",SET_CART_DATA="[Cart] Set cart data";class CartProcessesIncrement extends spartacus_core.kPG.EntityProcessesIncrementAction{constructor(payload){super(MULTI_CART_DATA,payload),this.payload=payload,this.type="[Cart] Cart Processes Increment"}}__name(CartProcessesIncrement,"CartProcessesIncrement");class CartProcessesDecrement extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload),this.payload=payload,this.type="[Cart] Cart Processes Decrement"}}__name(CartProcessesDecrement,"CartProcessesDecrement");class SetActiveCartId{constructor(payload){this.payload=payload,this.type="[Cart] Set Active Cart Id"}}__name(SetActiveCartId,"SetActiveCartId");class ClearCartState extends spartacus_core.kPG.EntityRemoveAllAction{constructor(){super(MULTI_CART_DATA),this.type=CLEAR_CART_STATE}}__name(ClearCartState,"ClearCartState");class SetCartTypeIndex{constructor(payload){this.payload=payload,this.type=SET_CART_TYPE_INDEX}}__name(SetCartTypeIndex,"SetCartTypeIndex");class SetCartData extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=SET_CART_DATA}}__name(SetCartData,"SetCartData");var cartGroup_actions=Object.freeze({__proto__:null,ADD_EMAIL_TO_CART:"[Cart] Add Email to Cart",ADD_EMAIL_TO_CART_FAIL:"[Cart] Add Email to Cart Fail",ADD_EMAIL_TO_CART_SUCCESS:"[Cart] Add Email to Cart Success",AddEmailToCart,AddEmailToCartFail,AddEmailToCartSuccess,CART_ADD_ENTRY:"[Cart-entry] Add Entry",CART_ADD_ENTRY_FAIL:"[Cart-entry] Add Entry Fail",CART_ADD_ENTRY_SUCCESS:"[Cart-entry] Add Entry Success",CART_ADD_VOUCHER,CART_ADD_VOUCHER_FAIL:"[Cart-voucher] Add Cart Voucher Fail",CART_ADD_VOUCHER_SUCCESS,CART_PROCESSES_DECREMENT:"[Cart] Cart Processes Decrement",CART_PROCESSES_INCREMENT:"[Cart] Cart Processes Increment",CART_REMOVE_ENTRY:"[Cart-entry] Remove Entry",CART_REMOVE_ENTRY_FAIL:"[Cart-entry] Remove Entry Fail",CART_REMOVE_ENTRY_SUCCESS:"[Cart-entry] Remove Entry Success",CART_REMOVE_VOUCHER,CART_REMOVE_VOUCHER_FAIL:"[Cart-voucher] Remove Cart Voucher Fail",CART_REMOVE_VOUCHER_SUCCESS:"[Cart-voucher] Remove Cart Voucher Success",CART_RESET_ADD_VOUCHER:"[Cart-voucher] Reset Add Cart Voucher",CART_UPDATE_ENTRY:"[Cart-entry] Update Entry",CART_UPDATE_ENTRY_FAIL:"[Cart-entry] Update Entry Fail",CART_UPDATE_ENTRY_SUCCESS:"[Cart-entry] Update Entry Success",CLEAR_CART_STATE,CREATE_CART,CREATE_CART_FAIL:"[Cart] Create Cart Fail",CREATE_CART_SUCCESS,CartAddEntry,CartAddEntryFail,CartAddEntrySuccess,CartAddVoucher,CartAddVoucherFail,CartAddVoucherSuccess,CartProcessesDecrement,CartProcessesIncrement,CartRemoveEntry,CartRemoveEntryFail,CartRemoveEntrySuccess,CartRemoveVoucher,CartRemoveVoucherFail,CartRemoveVoucherSuccess,CartResetAddVoucher,CartUpdateEntry,CartUpdateEntryFail,CartUpdateEntrySuccess,ClearCartState,CreateCart,CreateCartFail,CreateCartSuccess,DELETE_CART,DELETE_CART_FAIL:"[Cart] Delete Cart Fail",DELETE_CART_SUCCESS,DeleteCart,DeleteCartFail,DeleteCartSuccess,LOAD_CART,LOAD_CARTS_SUCCESS,LOAD_CART_FAIL:"[Cart] Load Cart Fail",LOAD_CART_SUCCESS,LoadCart,LoadCartFail,LoadCartSuccess,LoadCartsSuccess,MERGE_CART:"[Cart] Merge Cart",MERGE_CART_SUCCESS:"[Cart] Merge Cart Success",MergeCart,MergeCartSuccess,REMOVE_CART,RESET_CART_DETAILS:"[Cart] Reset Cart Details",RemoveCart,ResetCartDetails,SET_ACTIVE_CART_ID:"[Cart] Set Active Cart Id",SET_CART_DATA,SET_CART_TYPE_INDEX,SetActiveCartId,SetCartData,SetCartTypeIndex});class CartEntryAdapter{}__name(CartEntryAdapter,"CartEntryAdapter");class CartEntryConnector{constructor(adapter){this.adapter=adapter}add(userId,cartId,productCode,quantity,pickupStore){return this.adapter.add(userId,cartId,productCode,quantity,pickupStore)}update(userId,cartId,entryNumber,qty,pickupStore,pickupToDelivery=!1){return this.adapter.update(userId,cartId,entryNumber,qty,pickupStore,pickupToDelivery)}remove(userId,cartId,entryNumber){return this.adapter.remove(userId,cartId,entryNumber)}}__name(CartEntryConnector,"CartEntryConnector"),CartEntryConnector.\u0275fac=__name(function(t){return new(t||CartEntryConnector)(core.LFG(CartEntryAdapter))},"CartEntryConnector_Factory"),CartEntryConnector.\u0275prov=core.Yz7({token:CartEntryConnector,factory:CartEntryConnector.\u0275fac,providedIn:"root"});class CartEntryEffects{constructor(actions$,cartEntryConnector){this.actions$=actions$,this.cartEntryConnector=cartEntryConnector,this.contextChange$=this.actions$.pipe((0,ngrx_effects.l4)(spartacus_core.dO9.CURRENCY_CHANGE,spartacus_core.dO9.LANGUAGE_CHANGE)),this.addEntry$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Cart-entry] Add Entry"),(0,map.U)(action=>action.payload),(0,concatMap.b)(payload=>this.cartEntryConnector.add(payload.userId,payload.cartId,payload.productCode,payload.quantity,payload.pickupStore).pipe((0,map.U)(cartModification=>new CartAddEntrySuccess({...payload,...cartModification})),(0,catchError.K)(error=>(0,from.D)([new CartAddEntryFail({...payload,error:(0,spartacus_core.cxH)(error)}),new LoadCart({cartId:payload.cartId,userId:payload.userId})])))),(0,spartacus_core.FM_)(this.contextChange$))),this.removeEntry$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Cart-entry] Remove Entry"),(0,map.U)(action=>action.payload),(0,concatMap.b)(payload=>this.cartEntryConnector.remove(payload.userId,payload.cartId,payload.entryNumber).pipe((0,map.U)(()=>new CartRemoveEntrySuccess({...payload})),(0,catchError.K)(error=>(0,from.D)([new CartRemoveEntryFail({...payload,error:(0,spartacus_core.cxH)(error)}),new LoadCart({cartId:payload.cartId,userId:payload.userId})])))),(0,spartacus_core.FM_)(this.contextChange$))),this.updateEntry$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Cart-entry] Update Entry"),(0,map.U)(action=>action.payload),(0,concatMap.b)(payload=>this.cartEntryConnector.update(payload.userId,payload.cartId,payload.entryNumber,payload.quantity,payload.pickupStore,payload.pickupToDelivery).pipe((0,map.U)(()=>new CartUpdateEntrySuccess({...payload})),(0,catchError.K)(error=>(0,from.D)([new CartUpdateEntryFail({...payload,error:(0,spartacus_core.cxH)(error)}),new LoadCart({cartId:payload.cartId,userId:payload.userId})])))),(0,spartacus_core.FM_)(this.contextChange$)))}}__name(CartEntryEffects,"CartEntryEffects"),CartEntryEffects.\u0275fac=__name(function(t){return new(t||CartEntryEffects)(core.LFG(ngrx_effects.eX),core.LFG(CartEntryConnector))},"CartEntryEffects_Factory"),CartEntryEffects.\u0275prov=core.Yz7({token:CartEntryEffects,factory:CartEntryEffects.\u0275fac});class CartVoucherAdapter{}__name(CartVoucherAdapter,"CartVoucherAdapter");class CartVoucherConnector{constructor(adapter){this.adapter=adapter}add(userId,cartId,voucherId){return this.adapter.add(userId,cartId,voucherId)}remove(userId,cartId,voucherId){return this.adapter.remove(userId,cartId,voucherId)}}__name(CartVoucherConnector,"CartVoucherConnector"),CartVoucherConnector.\u0275fac=__name(function(t){return new(t||CartVoucherConnector)(core.LFG(CartVoucherAdapter))},"CartVoucherConnector_Factory"),CartVoucherConnector.\u0275prov=core.Yz7({token:CartVoucherConnector,factory:CartVoucherConnector.\u0275fac,providedIn:"root"});class CartVoucherEffects{constructor(actions$,cartVoucherConnector,messageService){this.actions$=actions$,this.cartVoucherConnector=cartVoucherConnector,this.messageService=messageService,this.addCartVoucher$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(CART_ADD_VOUCHER),(0,map.U)(action=>action.payload),(0,mergeMap.zg)(payload=>this.cartVoucherConnector.add(payload.userId,payload.cartId,payload.voucherId).pipe((0,map.U)(()=>(this.showGlobalMessage("voucher.applyVoucherSuccess",payload.voucherId,spartacus_core.xUg.MSG_TYPE_CONFIRMATION),new CartAddVoucherSuccess({...payload}))),(0,catchError.K)(error=>(0,from.D)([new CartAddVoucherFail({...payload,error:(0,spartacus_core.cxH)(error)}),new CartProcessesDecrement(payload.cartId),new LoadCart({userId:payload.userId,cartId:payload.cartId})])))))),this.removeCartVoucher$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(CART_REMOVE_VOUCHER),(0,map.U)(action=>action.payload),(0,mergeMap.zg)(payload=>this.cartVoucherConnector.remove(payload.userId,payload.cartId,payload.voucherId).pipe((0,map.U)(()=>(this.showGlobalMessage("voucher.removeVoucherSuccess",payload.voucherId,spartacus_core.xUg.MSG_TYPE_INFO),new CartRemoveVoucherSuccess({userId:payload.userId,cartId:payload.cartId,voucherId:payload.voucherId}))),(0,catchError.K)(error=>(0,from.D)([new CartRemoveVoucherFail({error:(0,spartacus_core.cxH)(error),cartId:payload.cartId,userId:payload.userId,voucherId:payload.voucherId}),new LoadCart({userId:payload.userId,cartId:payload.cartId})]))))))}showGlobalMessage(text,param,messageType){this.messageService.add({key:text,params:{voucherCode:param}},messageType)}}function getCartIdByUserId(cart,userId){return userId===spartacus_core.Fds?cart?.guid??"":cart?.code??""}function isSelectiveCart(cartId=""){return cartId.startsWith("selectivecart")}function isCartNotFoundError(error){return"notFound"===error.reason&&"cart"===error.subjectType&&!isSelectiveCart(error.subject)}function voucherExceededError(error){return"coupon.already.redeemed"===error.message}function voucherInvalidError(error){return"coupon.invalid.code.provided"===error.message}function isVoucherError(error){return"VoucherOperationError"===error.type}function isCartError(error){return"CartError"===error.type||"CartAddressError"===error.type||"CartEntryError"===error.type||"CartEntryGroupError"===error.type}function isTempCartId(cartId){return cartId.startsWith("temp-")}function isEmpty(cart){return!cart||"object"==typeof cart&&0===Object.keys(cart).length}function isEmail(str){return!!str&&!!str.match(spartacus_core.QIJ)}function isJustLoggedIn(userId,previousUserId){return userId!==spartacus_core.Fds&&previousUserId!==userId}__name(CartVoucherEffects,"CartVoucherEffects"),CartVoucherEffects.\u0275fac=__name(function(t){return new(t||CartVoucherEffects)(core.LFG(ngrx_effects.eX),core.LFG(CartVoucherConnector),core.LFG(spartacus_core.IWp))},"CartVoucherEffects_Factory"),CartVoucherEffects.\u0275prov=core.Yz7({token:CartVoucherEffects,factory:CartVoucherEffects.\u0275fac}),__name(getCartIdByUserId,"getCartIdByUserId"),__name(isSelectiveCart,"isSelectiveCart"),__name(isCartNotFoundError,"isCartNotFoundError"),__name(voucherExceededError,"voucherExceededError"),__name(voucherInvalidError,"voucherInvalidError"),__name(isVoucherError,"isVoucherError"),__name(isCartError,"isCartError"),__name(isTempCartId,"isTempCartId"),__name(isEmpty,"isEmpty"),__name(isEmail,"isEmail"),__name(isJustLoggedIn,"isJustLoggedIn");const getMultiCartState=(0,ngrx_store.ZF)("cart"),getMultiCartEntities=(0,ngrx_store.P1)(getMultiCartState,state=>state.carts),getCartEntitySelectorFactory=__name(cartId=>(0,ngrx_store.P1)(getMultiCartEntities,state=>spartacus_core.kPG.entityProcessesLoaderStateSelector(state,cartId)),"getCartEntitySelectorFactory"),getCartSelectorFactory=__name(cartId=>(0,ngrx_store.P1)(getMultiCartEntities,state=>spartacus_core.kPG.entityValueSelector(state,cartId)),"getCartSelectorFactory"),getCartIsStableSelectorFactory=__name(cartId=>(0,ngrx_store.P1)(getMultiCartEntities,state=>spartacus_core.kPG.entityIsStableSelector(state,cartId)),"getCartIsStableSelectorFactory"),getCartHasPendingProcessesSelectorFactory=__name(cartId=>(0,ngrx_store.P1)(getMultiCartEntities,state=>spartacus_core.kPG.entityHasPendingProcessesSelector(state,cartId)),"getCartHasPendingProcessesSelectorFactory"),getCartEntriesSelectorFactory=__name(cartId=>(0,ngrx_store.P1)(getCartSelectorFactory(cartId),state=>state&&state.entries?state.entries:[]),"getCartEntriesSelectorFactory"),getCartEntrySelectorFactory=__name((cartId,productCode)=>(0,ngrx_store.P1)(getCartEntriesSelectorFactory(cartId),state=>state.find(entry=>entry.product?.code===productCode)),"getCartEntrySelectorFactory"),getCartsSelectorFactory=(0,ngrx_store.P1)(getMultiCartEntities,state=>Object.keys(state.entities).map(key=>spartacus_core.kPG.entityValueSelector(state,key))),getCartTypeIndex=(0,ngrx_store.P1)(getMultiCartState,state=>state.index),getCartIdByTypeFactory=__name(type=>(0,ngrx_store.P1)(getCartTypeIndex,state=>state&&state[type]),"getCartIdByTypeFactory");class CartAdapter{}__name(CartAdapter,"CartAdapter");class CartConnector{constructor(adapter){this.adapter=adapter}loadAll(userId){return this.adapter.loadAll(userId)}load(userId,cartId){return this.adapter.load(userId,cartId)}create(userId,oldCartId,toMergeCartGuid){return this.adapter.create(userId,oldCartId,toMergeCartGuid)}delete(userId,cartId){return this.adapter.delete(userId,cartId)}save(userId,cartId,saveCartName,saveCartDescription){return this.adapter.save(userId,cartId,saveCartName,saveCartDescription)}addEmail(userId,cartId,email){return this.adapter.addEmail(userId,cartId,email)}}__name(CartConnector,"CartConnector"),CartConnector.\u0275fac=__name(function(t){return new(t||CartConnector)(core.LFG(CartAdapter))},"CartConnector_Factory"),CartConnector.\u0275prov=core.Yz7({token:CartConnector,factory:CartConnector.\u0275fac,providedIn:"root"});class CartEffects{handleLoadCartError(payload,error){if(error?.error?.errors){if(error.error.errors.filter(err=>"invalid"===err.reason).length>0)return(0,of.of)(new LoadCart({...payload}));if(error.error.errors.filter(err=>isCartNotFoundError(err)||"UnknownResourceError"===err.reason).length>0)return(0,of.of)(new RemoveCart({cartId:payload.cartId}))}return(0,of.of)(new LoadCartFail({...payload,error:(0,spartacus_core.cxH)(error)}))}constructor(actions$,cartConnector,store){this.actions$=actions$,this.cartConnector=cartConnector,this.store=store,this.contextChange$=this.actions$.pipe((0,ngrx_effects.l4)(spartacus_core.dO9.CURRENCY_CHANGE,spartacus_core.dO9.LANGUAGE_CHANGE)),this.loadCart$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(LOAD_CART),(0,map.U)(action=>action.payload),(0,groupBy.v)(payload=>payload.cartId),(0,mergeMap.zg)(group$=>group$.pipe((0,switchMap.w)(payload=>(0,of.of)(payload).pipe((0,withLatestFrom.M)(this.store.pipe((0,ngrx_store.Ys)(getCartHasPendingProcessesSelectorFactory(payload.cartId)))))),(0,filter.h)(([_,hasPendingProcesses])=>!hasPendingProcesses),(0,map.U)(([payload])=>payload),(0,switchMap.w)(payload=>this.cartConnector.load(payload.userId,payload.cartId).pipe((0,mergeMap.zg)(cart=>{let actions=[];return cart?(actions.push(new LoadCartSuccess({...payload,cart,cartId:getCartIdByUserId(cart,payload.userId)})),payload.cartId===spartacus_core.gSv&&actions.push(new RemoveCart({cartId:spartacus_core.gSv}))):actions=[new LoadCartFail({...payload,error:{}})],actions}),(0,catchError.K)(error=>this.handleLoadCartError(payload,error)))))),(0,spartacus_core.FM_)(this.contextChange$))),this.createCart$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(CREATE_CART),(0,map.U)(action=>action.payload),(0,mergeMap.zg)(payload=>this.cartConnector.create(payload.userId,payload.oldCartId,payload.toMergeCartGuid).pipe((0,switchMap.w)(cart=>{const conditionalActions=[];return payload.oldCartId&&conditionalActions.push(new MergeCartSuccess({extraData:payload.extraData,userId:payload.userId,tempCartId:payload.tempCartId,cartId:getCartIdByUserId(cart,payload.userId),oldCartId:payload.oldCartId})),[new CreateCartSuccess({...payload,cart,cartId:getCartIdByUserId(cart,payload.userId)}),new RemoveCart({cartId:payload.tempCartId}),...conditionalActions]}),(0,catchError.K)(error=>(0,of.of)(new CreateCartFail({...payload,error:(0,spartacus_core.cxH)(error)}))))),(0,spartacus_core.FM_)(this.contextChange$))),this.mergeCart$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Cart] Merge Cart"),(0,map.U)(action=>action.payload),(0,switchMap.w)(payload=>this.cartConnector.load(payload.userId,spartacus_core.gSv).pipe((0,map.U)(currentCart=>{if(currentCart?.code!==payload.cartId)return new CreateCart({userId:payload.userId,oldCartId:payload.cartId,toMergeCartGuid:currentCart?currentCart.guid:void 0,extraData:payload.extraData,tempCartId:payload.tempCartId})}),(0,filter.h)(spartacus_core.pTN))),(0,spartacus_core.FM_)(this.contextChange$))),this.refresh$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(CART_ADD_VOUCHER_SUCCESS),(0,map.U)(action=>action.payload),(0,concatMap.b)(payload=>(0,from.D)([new CartProcessesDecrement(payload.cartId),new LoadCart({userId:payload.userId,cartId:payload.cartId})])))),this.refreshWithoutProcesses$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Cart-entry] Add Entry Success","[Cart-entry] Remove Entry Success","[Cart-entry] Update Entry Success","[Cart-voucher] Remove Cart Voucher Success"),(0,map.U)(action=>action.payload),(0,map.U)(payload=>new LoadCart({userId:payload.userId,cartId:payload.cartId})))),this.resetCartDetailsOnSiteContextChange$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(spartacus_core.dO9.LANGUAGE_CHANGE,spartacus_core.dO9.CURRENCY_CHANGE),(0,mergeMap.zg)(()=>[new ResetCartDetails]))),this.addEmail$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Cart] Add Email to Cart"),(0,map.U)(action=>action.payload),(0,mergeMap.zg)(payload=>this.cartConnector.addEmail(payload.userId,payload.cartId,payload.email).pipe((0,mergeMap.zg)(()=>[new AddEmailToCartSuccess({...payload}),new LoadCart({userId:payload.userId,cartId:payload.cartId})]),(0,catchError.K)(error=>(0,from.D)([new AddEmailToCartFail({...payload,error:(0,spartacus_core.cxH)(error)}),new LoadCart({userId:payload.userId,cartId:payload.cartId})])))),(0,spartacus_core.FM_)(this.contextChange$))),this.deleteCart$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(DELETE_CART),(0,map.U)(action=>action.payload),(0,mergeMap.zg)(payload=>this.cartConnector.delete(payload.userId,payload.cartId).pipe((0,map.U)(()=>new DeleteCartSuccess({...payload})),(0,catchError.K)(error=>(0,from.D)([new DeleteCartFail({...payload,error:(0,spartacus_core.cxH)(error)}),new LoadCart({...payload})]))))))}}__name(CartEffects,"CartEffects"),CartEffects.\u0275fac=__name(function(t){return new(t||CartEffects)(core.LFG(ngrx_effects.eX),core.LFG(CartConnector),core.LFG(ngrx_store.yh))},"CartEffects_Factory"),CartEffects.\u0275prov=core.Yz7({token:CartEffects,factory:CartEffects.\u0275fac});class MultiCartEffects{getActiveCartTypeOnLoad(action){if(action?.payload?.cartId===spartacus_core.gSv)return new SetCartTypeIndex({cartType:spartacus_cart_base_root.EI.ACTIVE,cartId:""})}getActiveCartTypeOnCreate(action){if(action?.payload?.extraData?.active)return new SetCartTypeIndex({cartType:spartacus_cart_base_root.EI.ACTIVE,cartId:action.meta.entityId})}constructor(actions$){this.actions$=actions$,this.processesIncrement$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(CART_ADD_VOUCHER),(0,map.U)(action=>action.payload),(0,map.U)(payload=>new CartProcessesIncrement(payload.cartId)))),this.setSelectiveId$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(LOAD_CART_SUCCESS),(0,map.U)(action=>{switch(action.type){case LOAD_CART_SUCCESS:{const payload=action.payload;if(isSelectiveCart(payload.cartId))return new SetCartTypeIndex({cartType:spartacus_cart_base_root.EI.SELECTIVE,cartId:payload.cartId});break}}}),(0,filter.h)(spartacus_core.pTN))),this.setActiveCartId$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(LOAD_CART_SUCCESS,LOAD_CART,CREATE_CART_SUCCESS,CREATE_CART,"[Cart] Set Active Cart Id"),(0,map.U)(action=>{switch(action.type){case LOAD_CART:return this.getActiveCartTypeOnLoad(action);case LOAD_CART_SUCCESS:if(action?.payload?.extraData?.active)return action.payload?.cart.saveTime?new SetCartTypeIndex({cartType:spartacus_cart_base_root.EI.ACTIVE,cartId:""}):new SetCartTypeIndex({cartType:spartacus_cart_base_root.EI.ACTIVE,cartId:action.meta.entityId});break;case CREATE_CART:return this.getActiveCartTypeOnCreate(action);case CREATE_CART_SUCCESS:return new SetCartTypeIndex({cartType:action?.payload?.extraData?.active?spartacus_cart_base_root.EI.ACTIVE:spartacus_cart_base_root.EI.NEW_CREATED,cartId:action.meta.entityId});case"[Cart] Set Active Cart Id":return new SetCartTypeIndex({cartType:spartacus_cart_base_root.EI.ACTIVE,cartId:action.payload})}}),(0,filter.h)(spartacus_core.pTN)))}}__name(MultiCartEffects,"MultiCartEffects"),MultiCartEffects.\u0275fac=__name(function(t){return new(t||MultiCartEffects)(core.LFG(ngrx_effects.eX))},"MultiCartEffects_Factory"),MultiCartEffects.\u0275prov=core.Yz7({token:MultiCartEffects,factory:MultiCartEffects.\u0275fac});const effects=[CartEntryEffects,CartVoucherEffects,CartEffects,MultiCartEffects],cartTypeIndexInitialState={[spartacus_cart_base_root.EI.ACTIVE]:""};function cartTypeIndexReducer(state=cartTypeIndexInitialState,action){switch(action.type){case SET_CART_TYPE_INDEX:return{...state,[action.payload.cartType]:action.payload.cartId};case REMOVE_CART:case DELETE_CART_SUCCESS:return action.payload?.cartId===state[spartacus_cart_base_root.EI.ACTIVE]?{...state,[spartacus_cart_base_root.EI.ACTIVE]:""}:state;case CLEAR_CART_STATE:return cartTypeIndexInitialState}return state}__name(cartTypeIndexReducer,"cartTypeIndexReducer");const cartEntitiesInitialState=void 0;function cartEntitiesReducer(state=cartEntitiesInitialState,action){switch(action.type){case LOAD_CARTS_SUCCESS:return action.payload;case LOAD_CART_SUCCESS:case CREATE_CART_SUCCESS:case SET_CART_DATA:return action.payload.cart}return state}function clearMultiCartState(reducer){return function(state,action){return action.type===spartacus_core.uQL.LOGOUT&&(state=void 0),reducer(state,action)}}__name(cartEntitiesReducer,"cartEntitiesReducer"),__name(clearMultiCartState,"clearMultiCartState");const multiCartMetaReducers=[clearMultiCartState],multiCartReducerToken=new core.OlP("MultiCartReducers");function getMultiCartReducers(){return{carts:spartacus_core.kPG.entityProcessesLoaderReducer(MULTI_CART_DATA,cartEntitiesReducer),index:cartTypeIndexReducer}}__name(getMultiCartReducers,"getMultiCartReducers");const multiCartReducerProvider={provide:multiCartReducerToken,useFactory:getMultiCartReducers};var multiCartGroup_selectors=Object.freeze({__proto__:null,getCartEntitySelectorFactory,getCartEntriesSelectorFactory,getCartEntrySelectorFactory,getCartHasPendingProcessesSelectorFactory,getCartIdByTypeFactory,getCartIsStableSelectorFactory,getCartSelectorFactory,getCartTypeIndex,getCartsSelectorFactory,getMultiCartEntities,getMultiCartState});class MultiCartStatePersistenceService{constructor(statePersistenceService,store,siteContextParamsService){this.statePersistenceService=statePersistenceService,this.store=store,this.siteContextParamsService=siteContextParamsService,this.subscription=new Subscription.w}initSync(){this.subscription.add(this.statePersistenceService.syncWithStorage({key:"cart",state$:this.getCartState(),context$:this.siteContextParamsService.getValues([spartacus_core.iEg]),storageType:spartacus_core.iHd.LOCAL_STORAGE,onRead:state=>this.onRead(state)}))}getCartState(){return this.store.pipe((0,filter.h)(store=>!!store.cart),(0,ngrx_store.Ys)(getMultiCartState),(0,filter.h)(state=>!!state),(0,map.U)(state=>state.index),distinctUntilKeyChanged("Active"),(0,map.U)(indexState=>({active:indexState[spartacus_cart_base_root.EI.ACTIVE]??""})))}onRead(state){this.store.dispatch(new ClearCartState),state?this.store.dispatch(new SetActiveCartId(state.active)):this.store.dispatch(new SetActiveCartId(""))}ngOnDestroy(){this.subscription.unsubscribe()}}function cartStatePersistenceFactory(cartStatePersistenceService,configInit){return __name(()=>configInit.getStable("context").pipe((0,tap.b)(()=>{cartStatePersistenceService.initSync()})).toPromise(),"result")}function uninitializeActiveCartMetaReducerFactory(){return __name(reducer=>(state,action)=>{const newState={...state};return"@ngrx/store/init"===action.type&&(newState.cart={...newState.cart,index:{[spartacus_cart_base_root.EI.ACTIVE]:void 0}}),reducer(newState,action)},"metaReducer")}__name(MultiCartStatePersistenceService,"MultiCartStatePersistenceService"),MultiCartStatePersistenceService.\u0275fac=__name(function(t){return new(t||MultiCartStatePersistenceService)(core.LFG(spartacus_core.WBb),core.LFG(ngrx_store.yh),core.LFG(spartacus_core.Qnj))},"MultiCartStatePersistenceService_Factory"),MultiCartStatePersistenceService.\u0275prov=core.Yz7({token:MultiCartStatePersistenceService,factory:MultiCartStatePersistenceService.\u0275fac,providedIn:"root"}),__name(cartStatePersistenceFactory,"cartStatePersistenceFactory"),__name(uninitializeActiveCartMetaReducerFactory,"uninitializeActiveCartMetaReducerFactory");class CartPersistenceModule{}__name(CartPersistenceModule,"CartPersistenceModule"),CartPersistenceModule.\u0275fac=__name(function(t){return new(t||CartPersistenceModule)},"CartPersistenceModule_Factory"),CartPersistenceModule.\u0275mod=core.oAB({type:CartPersistenceModule}),CartPersistenceModule.\u0275inj=core.cJS({providers:[{provide:spartacus_core.z4I,useFactory:cartStatePersistenceFactory,deps:[MultiCartStatePersistenceService,spartacus_core.yUt],multi:!0},{provide:ngrx_store.sr,useFactory:uninitializeActiveCartMetaReducerFactory,multi:!0}]});class CartValidationAdapter{}__name(CartValidationAdapter,"CartValidationAdapter");class CartValidationConnector{constructor(adapter){this.adapter=adapter}validate(cartId,userId){return this.adapter.validate(cartId,userId)}}__name(CartValidationConnector,"CartValidationConnector"),CartValidationConnector.\u0275fac=__name(function(t){return new(t||CartValidationConnector)(core.LFG(CartValidationAdapter))},"CartValidationConnector_Factory"),CartValidationConnector.\u0275prov=core.Yz7({token:CartValidationConnector,factory:CartValidationConnector.\u0275fac,providedIn:"root"});class CartEventBuilder{constructor(actionsSubject,event,activeCartService,stateEventService){this.actionsSubject=actionsSubject,this.event=event,this.activeCartService=activeCartService,this.stateEventService=stateEventService,this.register()}register(){this.registerCreateCart(),this.registerAddEntry(),this.registerRemoveEntry(),this.registerUpdateEntry(),this.registerDeleteCart(),this.registerAddCartVoucher(),this.registerRemoveCartVoucher(),this.registerMergeCartSuccess()}registerAddEntry(){this.registerMapped({action:"[Cart-entry] Add Entry",event:spartacus_cart_base_root.uP}),this.registerMapped({action:"[Cart-entry] Add Entry Success",event:spartacus_cart_base_root.VD}),this.registerMapped({action:"[Cart-entry] Add Entry Fail",event:spartacus_cart_base_root.K$})}registerRemoveEntry(){this.registerMapped({action:"[Cart-entry] Remove Entry Success",event:spartacus_cart_base_root.A7}),this.registerMapped({action:"[Cart-entry] Remove Entry Fail",event:spartacus_cart_base_root.dC})}registerUpdateEntry(){this.registerMapped({action:"[Cart-entry] Update Entry Success",event:spartacus_cart_base_root.X}),this.registerMapped({action:"[Cart-entry] Update Entry Fail",event:spartacus_cart_base_root.gI})}registerMergeCartSuccess(){this.registerMapped({action:"[Cart] Merge Cart Success",event:spartacus_cart_base_root.pA})}registerCreateCart(){this.stateEventService.register({action:CREATE_CART,event:spartacus_cart_base_root.su}),this.stateEventService.register({action:CREATE_CART_SUCCESS,event:spartacus_cart_base_root.cA}),this.stateEventService.register({action:"[Cart] Create Cart Fail",event:spartacus_cart_base_root.Cj})}registerDeleteCart(){this.stateEventService.register({action:DELETE_CART,event:spartacus_cart_base_root.aY,factory:action=>(0,spartacus_core.PjU)(spartacus_cart_base_root.aY,{...action.payload,cartCode:action.payload.cartId})}),this.stateEventService.register({action:DELETE_CART_SUCCESS,event:spartacus_cart_base_root.N0,factory:action=>(0,spartacus_core.PjU)(spartacus_cart_base_root.N0,{...action.payload,cartCode:action.payload.cartId})}),this.stateEventService.register({action:"[Cart] Delete Cart Fail",event:spartacus_cart_base_root.Ks,factory:action=>(0,spartacus_core.PjU)(spartacus_cart_base_root.Ks,{...action.payload,cartCode:action.payload.cartId})})}registerAddCartVoucher(){this.stateEventService.register({action:CART_ADD_VOUCHER,event:spartacus_cart_base_root.aT}),this.stateEventService.register({action:CART_ADD_VOUCHER_SUCCESS,event:spartacus_cart_base_root.Es}),this.stateEventService.register({action:"[Cart-voucher] Add Cart Voucher Fail",event:spartacus_cart_base_root.re})}registerRemoveCartVoucher(){this.stateEventService.register({action:CART_REMOVE_VOUCHER,event:spartacus_cart_base_root.uX}),this.stateEventService.register({action:"[Cart-voucher] Remove Cart Voucher Success",event:spartacus_cart_base_root.FC}),this.stateEventService.register({action:"[Cart-voucher] Remove Cart Voucher Fail",event:spartacus_cart_base_root.kd})}registerMapped(mapping){const eventStream$=this.getAction(mapping.action).pipe((0,switchMap.w)(action=>(0,of.of)(action).pipe((0,withLatestFrom.M)(this.activeCartService.getActive(),this.activeCartService.getActiveCartId()))),(0,filter.h)(([action,_activeCart,activeCartId])=>action.payload.cartId===activeCartId),(0,map.U)(([action,activeCart])=>(0,spartacus_core.PjU)(mapping.event,{...action.payload,cartCode:activeCart.code,entry:action.payload.entry?action.payload.entry:activeCart.entries?.[Number(action.payload.entryNumber)]})));return this.event.register(mapping.event,eventStream$)}getAction(actionType){return this.actionsSubject.pipe((0,ngrx_effects.l4)(...[].concat(actionType)))}}__name(CartEventBuilder,"CartEventBuilder"),CartEventBuilder.\u0275fac=__name(function(t){return new(t||CartEventBuilder)(core.LFG(ngrx_store.UO),core.LFG(spartacus_core.POd),core.LFG(spartacus_cart_base_root.bu),core.LFG(spartacus_core.vL$))},"CartEventBuilder_Factory"),CartEventBuilder.\u0275prov=core.Yz7({token:CartEventBuilder,factory:CartEventBuilder.\u0275fac,providedIn:"root"});class CartEventModule{constructor(_CartEventBuilder){}}__name(CartEventModule,"CartEventModule"),CartEventModule.\u0275fac=__name(function(t){return new(t||CartEventModule)(core.LFG(CartEventBuilder))},"CartEventModule_Factory"),CartEventModule.\u0275mod=core.oAB({type:CartEventModule}),CartEventModule.\u0275inj=core.cJS({});class CartPageEventBuilder{constructor(eventService){this.eventService=eventService,this.register()}register(){this.eventService.register(spartacus_cart_base_root.uB,this.buildCartPageEvent())}buildCartPageEvent(){return this.eventService.get(spartacus_storefront.z4w).pipe((0,filter.h)(navigationEvent=>"cart"===navigationEvent.semanticRoute),(0,map.U)(navigationEvent=>(0,spartacus_core.PjU)(spartacus_cart_base_root.uB,{navigation:navigationEvent})))}}__name(CartPageEventBuilder,"CartPageEventBuilder"),CartPageEventBuilder.\u0275fac=__name(function(t){return new(t||CartPageEventBuilder)(core.LFG(spartacus_core.POd))},"CartPageEventBuilder_Factory"),CartPageEventBuilder.\u0275prov=core.Yz7({token:CartPageEventBuilder,factory:CartPageEventBuilder.\u0275fac,providedIn:"root"});class CartPageEventModule{constructor(_cartPageEventBuilder){}}__name(CartPageEventModule,"CartPageEventModule"),CartPageEventModule.\u0275fac=__name(function(t){return new(t||CartPageEventModule)(core.LFG(CartPageEventBuilder))},"CartPageEventModule_Factory"),CartPageEventModule.\u0275mod=core.oAB({type:CartPageEventModule}),CartPageEventModule.\u0275inj=core.cJS({});class ActiveCartService{constructor(multiCartFacade,userIdService){this.multiCartFacade=multiCartFacade,this.userIdService=userIdService,this.subscription=new Subscription.w,this.activeCartId$=this.userIdService.getUserId().pipe((0,take.q)(1),(0,switchMapTo.c)(this.multiCartFacade.getCartIdByType(spartacus_cart_base_root.EI.ACTIVE)),(0,filter.h)(cartId=>void 0!==cartId),(0,map.U)(cartId=>""===cartId?spartacus_core.gSv:cartId)),this.cartEntity$=this.activeCartId$.pipe((0,switchMap.w)(cartId=>this.multiCartFacade.getCartEntity(cartId))),this.checkInitLoad=void 0,this.initActiveCart(),this.detectUserChange()}initActiveCart(){const cartValue$=this.cartEntity$.pipe((0,map.U)(cartEntity=>({cart:cartEntity.value,isStable:!cartEntity.loading&&0===cartEntity.processesCount,loaded:Boolean((cartEntity.error||cartEntity.success)&&!cartEntity.loading)})),(0,filter.h)(({isStable,cart})=>isStable||isEmpty(cart))),loading=cartValue$.pipe((0,withLatestFrom.M)(this.activeCartId$,this.userIdService.getUserId()),(0,tap.b)(([{cart,loaded,isStable},cartId,userId])=>{isStable&&isEmpty(cart)&&!loaded&&!isTempCartId(cartId)&&this.load(cartId,userId)}));this.activeCart$=(0,using.g)(()=>loading.subscribe(),()=>cartValue$).pipe((0,map.U)(({cart})=>cart||{}),(0,distinctUntilChanged.x)(),(0,shareReplay.d)({bufferSize:1,refCount:!0}))}detectUserChange(){this.subscription.add(this.userIdService.getUserId().pipe((0,pairwise.G)(),(0,withLatestFrom.M)(this.activeCartId$)).subscribe(([[previousUserId,userId],cartId])=>{isJustLoggedIn(userId,previousUserId)&&this.loadOrMerge(cartId,userId,previousUserId)}))}getActive(){return this.activeCart$}takeActive(){return this.isStable().pipe((0,filter.h)(isStable=>isStable),(0,switchMap.w)(()=>this.getActive()),(0,filter.h)(cart=>!!cart),(0,take.q)(1))}getActiveCartId(){return this.activeCart$.pipe((0,withLatestFrom.M)(this.userIdService.getUserId()),(0,map.U)(([cart,userId])=>getCartIdByUserId(cart,userId)),(0,distinctUntilChanged.x)())}takeActiveCartId(){return this.isStable().pipe((0,filter.h)(isStable=>isStable),(0,switchMap.w)(()=>this.getActiveCartId()),(0,filter.h)(cartId=>!!cartId),(0,take.q)(1))}getEntries(){return this.activeCartId$.pipe((0,switchMap.w)(cartId=>this.multiCartFacade.getEntries(cartId)),(0,distinctUntilChanged.x)())}getLastEntry(productCode){return this.activeCartId$.pipe((0,switchMap.w)(cartId=>this.multiCartFacade.getLastEntry(cartId,productCode)),(0,distinctUntilChanged.x)())}getLoading(){return this.cartEntity$.pipe((0,map.U)(cartEntity=>Boolean(cartEntity.loading)),(0,distinctUntilChanged.x)())}isStable(){return this.activeCartId$.pipe((0,switchMap.w)(cartId=>this.multiCartFacade.isStable(cartId)))}load(cartId,userId){userId===spartacus_core.Fds&&cartId===spartacus_core.gSv||this.multiCartFacade.loadCart({userId,cartId,extraData:{active:!0}})}loadOrMerge(cartId,userId,previousUserId){cartId===spartacus_core.gSv||previousUserId!==spartacus_core.Fds?this.multiCartFacade.loadCart({userId,cartId,extraData:{active:!0}}):Boolean((0,spartacus_core.P51)(this.isGuestCart()))?this.guestCartMerge(cartId):this.multiCartFacade.mergeToCurrentCart({userId,cartId,extraData:{active:!0}})}guestCartMerge(cartId){this.getEntries().pipe((0,take.q)(1)).subscribe(entries=>{this.multiCartFacade.deleteCart(cartId,spartacus_core.Fds),this.addEntriesGuestMerge(entries)})}addEntriesGuestMerge(cartEntries){const entriesToAdd=cartEntries.map(entry=>({productCode:entry.product?.code??"",quantity:entry.quantity??0}));this.requireLoadedCart(!0).pipe((0,withLatestFrom.M)(this.userIdService.getUserId())).subscribe(([cart,userId])=>{this.multiCartFacade.addEntries(userId,getCartIdByUserId(cart,userId),entriesToAdd)})}isCartCreating(cartState,cartId){return isTempCartId(cartId)&&(cartState.loading||cartState.success||cartState.error)}requireLoadedCart(forGuestMerge=!1){this.checkInitLoad=void 0===this.checkInitLoad;const cartSelector$=(forGuestMerge?this.cartEntity$.pipe((0,filter.h)(()=>!Boolean((0,spartacus_core.P51)(this.isGuestCart())))):this.cartEntity$).pipe((0,filter.h)(cartState=>!cartState.loading||!!this.checkInitLoad));return this.activeCartId$.pipe((0,withLatestFrom.M)(cartSelector$),(0,filter.h)(([cartId,cartState])=>!this.isCartCreating(cartState,cartId)),(0,map.U)(([,cartState])=>cartState),(0,take.q)(1),(0,withLatestFrom.M)(this.userIdService.getUserId()),(0,tap.b)(([cartState,userId])=>{isEmpty(cartState.value)&&userId!==spartacus_core.Fds&&!cartState.loading&&this.load(spartacus_core.gSv,userId),this.checkInitLoad=!1}),(0,switchMapTo.c)(cartSelector$),(0,withLatestFrom.M)(this.userIdService.getUserId()),(0,filter.h)(([cartState,userId])=>Boolean(userId===spartacus_core.Fds||cartState.success||cartState.error)),(0,take.q)(1),(0,tap.b)(([cartState,userId])=>{isEmpty(cartState.value)&&this.multiCartFacade.createCart({userId,extraData:{active:!0}})}),(0,switchMapTo.c)(cartSelector$),(0,filter.h)(cartState=>cartState.success||cartState.error),(0,withLatestFrom.M)(this.activeCartId$),(0,filter.h)(([cartState,cartId])=>!this.isCartCreating(cartState,cartId)),(0,map.U)(([cartState])=>cartState.value),(0,filter.h)(cart=>!isEmpty(cart)),(0,take.q)(1))}addEntry(productCode,quantity,pickupStore){this.requireLoadedCart().pipe((0,withLatestFrom.M)(this.userIdService.getUserId())).subscribe(([cart,userId])=>{this.multiCartFacade.addEntry(userId,getCartIdByUserId(cart,userId),productCode,quantity,pickupStore)})}removeEntry(entry){this.activeCartId$.pipe((0,withLatestFrom.M)(this.userIdService.getUserId()),(0,take.q)(1)).subscribe(([cartId,userId])=>{this.multiCartFacade.removeEntry(userId,cartId,entry.entryNumber)})}updateEntry(entryNumber,quantity,pickupStore,pickupToDelivery=!1){this.activeCartId$.pipe((0,withLatestFrom.M)(this.userIdService.getUserId()),(0,take.q)(1)).subscribe(([cartId,userId])=>{this.multiCartFacade.updateEntry(userId,cartId,entryNumber,quantity,pickupStore,pickupToDelivery)})}getEntry(productCode){return this.activeCartId$.pipe((0,switchMap.w)(cartId=>this.multiCartFacade.getEntry(cartId,productCode)),(0,distinctUntilChanged.x)())}addEmail(email){this.activeCartId$.pipe((0,withLatestFrom.M)(this.userIdService.getUserId()),(0,take.q)(1)).subscribe(([cartId,userId])=>{this.multiCartFacade.assignEmail(cartId,userId,email)})}getAssignedUser(){return this.activeCart$.pipe((0,map.U)(cart=>cart.user))}isGuestCart(cart){return cart?(0,of.of)(this.isCartUserGuest(cart)):this.activeCart$.pipe((0,map.U)(activeCart=>this.isCartUserGuest(activeCart)),(0,distinctUntilChanged.x)())}isCartUserGuest(cart){const cartUser=cart.user;return Boolean(cartUser&&(cartUser.name===spartacus_core.YI5||isEmail(cartUser.uid?.split("|").slice(1).join("|"))))}addEntries(cartEntries){const entriesToAdd=cartEntries.map(entry=>({productCode:entry.product?.code??"",quantity:entry.quantity??0}));this.requireLoadedCart().pipe((0,withLatestFrom.M)(this.userIdService.getUserId())).subscribe(([cart,userId])=>{cart&&this.multiCartFacade.addEntries(userId,getCartIdByUserId(cart,userId),entriesToAdd)})}reloadActiveCart(){(0,combineLatest.aj)([this.getActiveCartId(),this.userIdService.takeUserId()]).pipe((0,take.q)(1),(0,map.U)(([cartId,userId])=>{this.multiCartFacade.loadCart({cartId,userId,extraData:{active:!0}})})).subscribe()}hasPickupItems(){return this.getActive().pipe((0,map.U)(cart=>!!cart.pickupItemsQuantity&&cart.pickupItemsQuantity>0))}hasDeliveryItems(){return this.getActive().pipe((0,map.U)(cart=>!!cart.deliveryItemsQuantity&&cart.deliveryItemsQuantity>0))}getPickupEntries(){return this.getEntries().pipe((0,map.U)(entries=>entries.filter(entry=>void 0!==entry.deliveryPointOfService)))}getDeliveryEntries(){return this.getEntries().pipe((0,map.U)(entries=>entries.filter(entry=>void 0===entry.deliveryPointOfService)))}ngOnDestroy(){this.subscription.unsubscribe()}}__name(ActiveCartService,"ActiveCartService"),ActiveCartService.\u0275fac=__name(function(t){return new(t||ActiveCartService)(core.LFG(spartacus_cart_base_root.WT),core.LFG(spartacus_core.XBV))},"ActiveCartService_Factory"),ActiveCartService.\u0275prov=core.Yz7({token:ActiveCartService,factory:ActiveCartService.\u0275fac});class CartValidationStateService{constructor(routingService){this.routingService=routingService,this.NAVIGATION_SKIPS=2,this.navigationIdCount=0,this.subscription=new Subscription.w,this.cartValidationResult$=new ReplaySubject.t(1),this.checkForValidationResultClear$=this.routingService.getRouterState().pipe((0,withLatestFrom.M)(this.cartValidationResult$),(0,tap.b)(([routerState,cartModifications])=>{this.navigationIdCount+this.NAVIGATION_SKIPS<=routerState.navigationId&&cartModifications.length&&(this.cartValidationResult$.next([]),this.navigationIdCount=routerState.navigationId)})),this.setInitialState()}ngOnDestroy(){this.subscription.unsubscribe()}setInitialState(){this.setNavigationIdStep(),this.subscription.add(this.checkForValidationResultClear$.subscribe())}updateValidationResultAndRoutingId(cartModification){this.cartValidationResult$.next(cartModification),this.setNavigationIdStep()}setNavigationIdStep(){this.routingService.getRouterState().pipe((0,take.q)(1)).subscribe(routerState=>this.navigationIdCount=routerState.navigationId)}}__name(CartValidationStateService,"CartValidationStateService"),CartValidationStateService.\u0275fac=__name(function(t){return new(t||CartValidationStateService)(core.LFG(spartacus_core.Znh))},"CartValidationStateService_Factory"),CartValidationStateService.\u0275prov=core.Yz7({token:CartValidationStateService,factory:CartValidationStateService.\u0275fac,providedIn:"root"});class CartValidationService{constructor(cartValidationConnector,command,userIdService,activeCartFacade,cartValidationStateService){this.cartValidationConnector=cartValidationConnector,this.command=command,this.userIdService=userIdService,this.activeCartFacade=activeCartFacade,this.cartValidationStateService=cartValidationStateService,this.validateCartCommand=this.command.create(()=>(0,combineLatest.aj)([this.activeCartFacade.getActiveCartId(),this.userIdService.takeUserId(),this.activeCartFacade.isStable()]).pipe((0,filter.h)(([_,__,loaded])=>loaded),(0,take.q)(1),(0,switchMap.w)(([cartId,userId])=>this.cartValidationConnector.validate(cartId,userId))),{strategy:spartacus_core.flE.CancelPrevious})}validateCart(){return this.validateCartCommand.execute()}getValidationResults(){return this.cartValidationStateService.cartValidationResult$}}__name(CartValidationService,"CartValidationService"),CartValidationService.\u0275fac=__name(function(t){return new(t||CartValidationService)(core.LFG(CartValidationConnector),core.LFG(spartacus_core.VDr),core.LFG(spartacus_core.XBV),core.LFG(spartacus_cart_base_root.bu),core.LFG(CartValidationStateService))},"CartValidationService_Factory"),CartValidationService.\u0275prov=core.Yz7({token:CartValidationService,factory:CartValidationService.\u0275fac});class CartVoucherService{constructor(store,activeCartFacade,userIdService){this.store=store,this.activeCartFacade=activeCartFacade,this.userIdService=userIdService}addVoucher(voucherId,cartId){this.combineUserAndCartId(cartId).subscribe(([occUserId,cartIdentifier])=>this.store.dispatch(new CartAddVoucher({userId:occUserId,cartId:cartIdentifier,voucherId})))}removeVoucher(voucherId,cartId){this.combineUserAndCartId(cartId).subscribe(([occUserId,cartIdentifier])=>this.store.dispatch(new CartRemoveVoucher({userId:occUserId,cartId:cartIdentifier,voucherId})))}getAddVoucherResultError(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessErrorFactory("addVoucher")))}getAddVoucherResultSuccess(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessSuccessFactory("addVoucher")))}getAddVoucherResultLoading(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessLoadingFactory("addVoucher")))}resetAddVoucherProcessingState(){this.store.dispatch(new CartResetAddVoucher)}combineUserAndCartId(cartId){return cartId?this.userIdService.getUserId().pipe((0,take.q)(1),(0,map.U)(userId=>[userId,cartId])):(0,combineLatest.aj)([this.userIdService.getUserId(),this.activeCartFacade.getActiveCartId()]).pipe((0,take.q)(1))}}__name(CartVoucherService,"CartVoucherService"),CartVoucherService.\u0275fac=__name(function(t){return new(t||CartVoucherService)(core.LFG(ngrx_store.yh),core.LFG(spartacus_cart_base_root.bu),core.LFG(spartacus_core.XBV))},"CartVoucherService_Factory"),CartVoucherService.\u0275prov=core.Yz7({token:CartVoucherService,factory:CartVoucherService.\u0275fac});class MultiCartService{constructor(store,userIdService){this.store=store,this.userIdService=userIdService}getCart(cartId){return this.store.pipe((0,ngrx_store.Ys)(getCartSelectorFactory(cartId)))}getCarts(){return this.store.pipe((0,ngrx_store.Ys)(getCartsSelectorFactory))}getCartEntity(cartId){return this.store.pipe((0,ngrx_store.Ys)(getCartEntitySelectorFactory(cartId)))}isStable(cartId){return this.store.pipe((0,ngrx_store.Ys)(getCartIsStableSelectorFactory(cartId)),(0,debounce.D)(isStable=>isStable?(0,timer.H)(0):empty.E),(0,distinctUntilChanged.x)())}generateTempCartId(){return`temp-${Math.random().toString(36).substr(2,9)}`}createCart({userId,oldCartId,toMergeCartGuid,extraData}){const tempCartId=this.generateTempCartId();return this.store.dispatch(new CreateCart({extraData,userId,oldCartId,toMergeCartGuid,tempCartId})),this.getCartIdByType(extraData?.active?spartacus_cart_base_root.EI.ACTIVE:spartacus_cart_base_root.EI.NEW_CREATED).pipe((0,switchMap.w)(cartId=>this.getCart(cartId)),(0,filter.h)(spartacus_core.pTN))}mergeToCurrentCart({userId,cartId,extraData}){const tempCartId=this.generateTempCartId();this.store.dispatch(new MergeCart({userId,cartId,extraData,tempCartId}))}loadCart({cartId,userId,extraData}){this.store.dispatch(new LoadCart({userId,cartId,extraData}))}getEntries(cartId){return this.store.pipe((0,ngrx_store.Ys)(getCartEntriesSelectorFactory(cartId)))}getLastEntry(cartId,productCode){return this.store.pipe((0,ngrx_store.Ys)(getCartEntriesSelectorFactory(cartId)),(0,map.U)(entries=>{const filteredEntries=entries.filter(entry=>entry.product?.code===productCode);return filteredEntries?filteredEntries[filteredEntries.length-1]:void 0}))}addEntry(userId,cartId,productCode,quantity,pickupStore){this.store.dispatch(new CartAddEntry({userId,cartId,productCode,quantity,pickupStore}))}addEntries(userId,cartId,products){products.forEach(product=>{this.store.dispatch(new CartAddEntry({userId,cartId,productCode:product.productCode,quantity:product.quantity}))})}removeEntry(userId,cartId,entryNumber){this.store.dispatch(new CartRemoveEntry({userId,cartId,entryNumber:`${entryNumber}`}))}updateEntry(userId,cartId,entryNumber,quantity,pickupStore,pickupToDelivery=!1){void 0!==quantity&&quantity<=0?this.removeEntry(userId,cartId,entryNumber):this.store.dispatch(new CartUpdateEntry({userId,cartId,pickupStore,pickupToDelivery,entryNumber:`${entryNumber}`,quantity}))}getEntry(cartId,productCode){return this.store.pipe((0,ngrx_store.Ys)(getCartEntrySelectorFactory(cartId,productCode)))}assignEmail(cartId,userId,email){this.store.dispatch(new AddEmailToCart({userId,cartId,email}))}removeCart(cartId){this.store.dispatch(new RemoveCart({cartId}))}deleteCart(cartId,userId){this.store.dispatch(new DeleteCart({userId,cartId}))}reloadCart(cartId,extraData){this.userIdService.takeUserId().subscribe(userId=>this.store.dispatch(new LoadCart({userId,cartId,extraData})))}getCartIdByType(cartType){return this.store.pipe((0,ngrx_store.Ys)(getCartIdByTypeFactory(cartType)),(0,distinctUntilChanged.x)())}}__name(MultiCartService,"MultiCartService"),MultiCartService.\u0275fac=__name(function(t){return new(t||MultiCartService)(core.LFG(ngrx_store.yh),core.LFG(spartacus_core.XBV))},"MultiCartService_Factory"),MultiCartService.\u0275prov=core.Yz7({token:MultiCartService,factory:MultiCartService.\u0275fac});class SelectiveCartService{constructor(userProfileFacade,multiCartFacade,baseSiteService,userIdService){this.userProfileFacade=userProfileFacade,this.multiCartFacade=multiCartFacade,this.baseSiteService=baseSiteService,this.userIdService=userIdService}getCart(){return this.selectiveCart$||(this.selectiveCart$=(0,combineLatest.aj)([this.getSelectiveCartId(),this.userProfileFacade.get(),this.userIdService.getUserId(),this.baseSiteService.getActive()]).pipe((0,distinctUntilChanged.x)(),(0,tap.b)(([selectiveId,user,userId,activeBaseSite])=>{!Boolean(selectiveId)&&userId!==spartacus_core.Fds&&user?.customerId&&this.multiCartFacade.loadCart({userId,cartId:`selectivecart${activeBaseSite}${user.customerId}`})}),(0,filter.h)(([selectiveId])=>Boolean(selectiveId)),(0,switchMap.w)(([selectiveId])=>this.multiCartFacade.getCart(selectiveId)),(0,shareReplay.d)({bufferSize:1,refCount:!0}))),this.selectiveCart$}getEntries(){return this.getSelectiveCartId().pipe((0,switchMap.w)(selectiveId=>this.multiCartFacade.getEntries(selectiveId)))}isStable(){return this.getSelectiveCartId().pipe((0,switchMap.w)(selectiveId=>this.multiCartFacade.isStable(selectiveId)))}addEntry(productCode,quantity){this.getSelectiveIdWithUserId().subscribe(([selectiveId,userId])=>{this.multiCartFacade.addEntry(userId,selectiveId,productCode,quantity)})}removeEntry(entry){this.getSelectiveIdWithUserId().subscribe(([selectiveId,userId])=>{this.multiCartFacade.removeEntry(userId,selectiveId,entry.entryNumber)})}updateEntry(entryNumber,quantity){this.getSelectiveIdWithUserId().subscribe(([selectiveId,userId])=>{this.multiCartFacade.updateEntry(userId,selectiveId,entryNumber,quantity)})}getEntry(productCode){return this.getSelectiveCartId().pipe((0,switchMap.w)(selectiveId=>this.multiCartFacade.getEntry(selectiveId,productCode)))}getSelectiveCartId(){return this.multiCartFacade.getCartIdByType(spartacus_cart_base_root.EI.SELECTIVE)}getSelectiveIdWithUserId(){return this.getSelectiveCartId().pipe((0,distinctUntilChanged.x)(),(0,withLatestFrom.M)(this.userIdService.getUserId()),(0,take.q)(1))}}__name(SelectiveCartService,"SelectiveCartService"),SelectiveCartService.\u0275fac=__name(function(t){return new(t||SelectiveCartService)(core.LFG(spartacus_user_profile_root.aT),core.LFG(spartacus_cart_base_root.WT),core.LFG(spartacus_core.Do$),core.LFG(spartacus_core.XBV))},"SelectiveCartService_Factory"),SelectiveCartService.\u0275prov=core.Yz7({token:SelectiveCartService,factory:SelectiveCartService.\u0275fac});const facadeProviders=[ActiveCartService,{provide:spartacus_cart_base_root.bu,useExisting:ActiveCartService},CartVoucherService,{provide:spartacus_cart_base_root.LN,useExisting:CartVoucherService},MultiCartService,{provide:spartacus_cart_base_root.WT,useExisting:MultiCartService},SelectiveCartService,{provide:spartacus_cart_base_root.Oo,useExisting:SelectiveCartService},CartValidationService,{provide:spartacus_cart_base_root.mU,useExisting:CartValidationService}];class BadCartRequestHandler extends spartacus_core.kck{constructor(){super(...arguments),this.responseStatus=spartacus_core.sdw.BAD_REQUEST}getPriority(){return 0}hasMatch(errorResponse){return super.hasMatch(errorResponse)&&this.getErrors(errorResponse).some(isCartError)}handleError(request,response){this.handleCartNotFoundError(request,response),this.handleOtherCartErrors(request,response)}handleCartNotFoundError(_request,response){this.getErrors(response).filter(e=>isCartNotFoundError(e)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.cartNotFound"},spartacus_core.xUg.MSG_TYPE_ERROR)})}handleOtherCartErrors(_request,response){this.getErrors(response).filter(e=>"notFound"!==e.reason||"cart"!==e.subjectType).forEach(error=>{this.globalMessageService.add(error.message?error.message:{key:"httpHandlers.otherCartErrors"},spartacus_core.xUg.MSG_TYPE_ERROR)})}getErrors(response){return(response.error?.errors||[]).filter(error=>"JaloObjectNoLongerValidError"!==error.type)}}__name(BadCartRequestHandler,"BadCartRequestHandler"),BadCartRequestHandler.\u0275fac=function(){let \u0275BadCartRequestHandler_BaseFactory;return __name(function(t){return(\u0275BadCartRequestHandler_BaseFactory||(\u0275BadCartRequestHandler_BaseFactory=core.n5z(BadCartRequestHandler)))(t||BadCartRequestHandler)},"BadCartRequestHandler_Factory")}(),BadCartRequestHandler.\u0275prov=core.Yz7({token:BadCartRequestHandler,factory:BadCartRequestHandler.\u0275fac,providedIn:"root"});class BadVoucherRequestHandler extends spartacus_core.kck{constructor(){super(...arguments),this.responseStatus=spartacus_core.sdw.BAD_REQUEST}getPriority(){return 0}hasMatch(errorResponse){return super.hasMatch(errorResponse)&&this.getErrors(errorResponse).some(isVoucherError)}handleError(request,response){this.handleVoucherExceededError(request,response),this.handleVoucherInvalidError(request,response)}handleVoucherExceededError(_request,response){this.getErrors(response).filter(e=>voucherExceededError(e)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.voucherExceeded"},spartacus_core.xUg.MSG_TYPE_ERROR)})}handleVoucherInvalidError(_request,response){this.getErrors(response).filter(e=>voucherInvalidError(e)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.invalidCodeProvided"},spartacus_core.xUg.MSG_TYPE_ERROR)})}getErrors(response){return(response.error?.errors||[]).filter(error=>"JaloObjectNoLongerValidError"!==error.type)}}__name(BadVoucherRequestHandler,"BadVoucherRequestHandler"),BadVoucherRequestHandler.\u0275fac=function(){let \u0275BadVoucherRequestHandler_BaseFactory;return __name(function(t){return(\u0275BadVoucherRequestHandler_BaseFactory||(\u0275BadVoucherRequestHandler_BaseFactory=core.n5z(BadVoucherRequestHandler)))(t||BadVoucherRequestHandler)},"BadVoucherRequestHandler_Factory")}(),BadVoucherRequestHandler.\u0275prov=core.Yz7({token:BadVoucherRequestHandler,factory:BadVoucherRequestHandler.\u0275fac,providedIn:"root"});class MultiCartStoreModule{}__name(MultiCartStoreModule,"MultiCartStoreModule"),MultiCartStoreModule.\u0275fac=__name(function(t){return new(t||MultiCartStoreModule)},"MultiCartStoreModule_Factory"),MultiCartStoreModule.\u0275mod=core.oAB({type:MultiCartStoreModule}),MultiCartStoreModule.\u0275inj=core.cJS({providers:[multiCartReducerProvider],imports:[common.ez,spartacus_core.vUS,ngrx_store.Aw.forFeature("cart",multiCartReducerToken,{metaReducers:multiCartMetaReducers}),ngrx_effects.sQ.forFeature(effects)]});class CartBaseCoreModule{}__name(CartBaseCoreModule,"CartBaseCoreModule"),CartBaseCoreModule.\u0275fac=__name(function(t){return new(t||CartBaseCoreModule)},"CartBaseCoreModule_Factory"),CartBaseCoreModule.\u0275mod=core.oAB({type:CartBaseCoreModule}),CartBaseCoreModule.\u0275inj=core.cJS({providers:[CartConnector,CartEntryConnector,CartVoucherConnector,CartValidationConnector,...facadeProviders,{provide:spartacus_core.kck,useExisting:BadCartRequestHandler,multi:!0},{provide:spartacus_core.kck,useExisting:BadVoucherRequestHandler,multi:!0}],imports:[CartEventModule,MultiCartStoreModule,CartPersistenceModule,CartPageEventModule]});const CART_VALIDATION_NORMALIZER=new core.OlP("CartValidationNormalizer");class CartConfigService{constructor(config){this.config=config}isSelectiveCartEnabled(){return Boolean(this.config?.cart?.selectiveCart?.enabled)}isCartValidationEnabled(){return Boolean(this.config?.cart?.validation?.enabled)}}__name(CartConfigService,"CartConfigService"),CartConfigService.\u0275fac=__name(function(t){return new(t||CartConfigService)(core.LFG(spartacus_cart_base_root.qB))},"CartConfigService_Factory"),CartConfigService.\u0275prov=core.Yz7({token:CartConfigService,factory:CartConfigService.\u0275fac,providedIn:"root"});class CartValidationGuard{constructor(cartValidationService,semanticPathService,router2,globalMessageService,activeCartService,cartValidationStateService,cartConfigService){this.cartValidationService=cartValidationService,this.semanticPathService=semanticPathService,this.router=router2,this.globalMessageService=globalMessageService,this.activeCartService=activeCartService,this.cartValidationStateService=cartValidationStateService,this.cartConfigService=cartConfigService,this.GLOBAL_MESSAGE_TIMEOUT=1e4}canActivate(){return this.cartConfigService.isCartValidationEnabled()?this.cartValidationService.validateCart().pipe((0,withLatestFrom.M)(this.activeCartService.getEntries()),(0,map.U)(([cartModificationList,cartEntries])=>{if(this.cartValidationStateService.updateValidationResultAndRoutingId(cartModificationList.cartModifications??[]),void 0!==cartModificationList.cartModifications&&0!==cartModificationList.cartModifications.length){let validationResultMessage;const modification=cartModificationList.cartModifications[0];return validationResultMessage=1===cartEntries.length&&cartEntries[0].product?.code===modification.entry?.product?.code&&modification.statusCode===spartacus_cart_base_root.v$.NO_STOCK?{key:"validation.cartEntryRemoved",params:{name:modification.entry?.product?.name}}:{key:"validation.cartEntriesChangeDuringCheckout"},this.globalMessageService.add(validationResultMessage,spartacus_core.xUg.MSG_TYPE_ERROR,this.GLOBAL_MESSAGE_TIMEOUT),this.activeCartService.reloadActiveCart(),this.router.parseUrl(this.semanticPathService.get("cart")??"")}return!0})):(0,of.of)(!0)}}__name(CartValidationGuard,"CartValidationGuard"),CartValidationGuard.\u0275fac=__name(function(t){return new(t||CartValidationGuard)(core.LFG(spartacus_cart_base_root.mU),core.LFG(spartacus_core.hCH),core.LFG(router.F0),core.LFG(spartacus_core.IWp),core.LFG(spartacus_cart_base_root.bu),core.LFG(CartValidationStateService),core.LFG(CartConfigService))},"CartValidationGuard_Factory"),CartValidationGuard.\u0275prov=core.Yz7({token:CartValidationGuard,factory:CartValidationGuard.\u0275fac,providedIn:"root"});class ProductImportInfoService{constructor(actionsSubject){this.actionsSubject=actionsSubject}getResults(cartId){return this.actionsSubject.pipe((0,ngrx_effects.l4)("[Cart-entry] Add Entry Success","[Cart-entry] Add Entry Fail"),(0,filter.h)(action=>action.payload.cartId===cartId),(0,map.U)(action=>this.mapMessages(action)))}mapMessages(action){const{productCode}=action.payload;if(action instanceof CartAddEntrySuccess){const{quantity,quantityAdded,entry,statusCode}=action.payload;if(statusCode===spartacus_cart_base_root.QX.LOW_STOCK)return{productCode,statusCode,productName:entry?.product?.name,quantity,quantityAdded};if(statusCode===spartacus_cart_base_root.QX.SUCCESS||statusCode===spartacus_cart_base_root.QX.NO_STOCK)return{productCode,statusCode,productName:entry?.product?.name}}else if(action instanceof CartAddEntryFail){const{error}=action.payload;if("UnknownIdentifierError"===error?.details[0]?.type)return{productCode,statusCode:spartacus_cart_base_root.QX.UNKNOWN_IDENTIFIER}}return(0,core.X6Q)()&&console.warn("Unrecognized cart add entry action type while mapping messages",action),{productCode,statusCode:spartacus_cart_base_root.QX.UNKNOWN_ERROR}}}__name(ProductImportInfoService,"ProductImportInfoService"),ProductImportInfoService.\u0275fac=__name(function(t){return new(t||ProductImportInfoService)(core.LFG(ngrx_store.UO))},"ProductImportInfoService_Factory"),ProductImportInfoService.\u0275prov=core.Yz7({token:ProductImportInfoService,factory:ProductImportInfoService.\u0275fac,providedIn:"root"})},3926:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{WishListModule:()=>WishListModule});var core=__webpack_require__(305),common=__webpack_require__(9318),router=__webpack_require__(8258),spartacus_core=__webpack_require__(9345),spartacus_storefront=__webpack_require__(3525),spartacus_cart_wish_list_root=__webpack_require__(3599);const _c1=__name(function(a1){return{cxRoute:"product",params:a1}},"_c1");function WishListItemComponent_div_6_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",13)(1,"a",14),core.ALo(2,"cxUrl"),core._uU(3),core.qZA()()),2&rf){const ctx_r0=core.oxw();core.xp6(1),core.Q6J("routerLink",core.lcZ(2,2,core.VKq(4,_c1,ctx_r0.cartEntry.product))),core.xp6(2),core.Oqu(null==ctx_r0.cartEntry.product?null:ctx_r0.cartEntry.product.name)}}function WishListItemComponent_div_7_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",15),core._uU(1),core.ALo(2,"cxTranslate"),core.qZA()),2&rf){const ctx_r1=core.oxw();core.xp6(1),core.AsE(" ",core.lcZ(2,2,"cartItems.id")," ",null==ctx_r1.cartEntry.product?null:ctx_r1.cartEntry.product.code," ")}}function WishListItemComponent_ng_container_8_div_1_div_1_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",19),core._uU(1),core.qZA()),2&rf){const variant_r9=core.oxw().$implicit;core.xp6(1),core.AsE(" ",variant_r9.name,": ",variant_r9.value," ")}}function WishListItemComponent_ng_container_8_div_1_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",17),core.YNc(1,WishListItemComponent_ng_container_8_div_1_div_1_Template,2,2,"div",18),core.qZA()),2&rf){const variant_r9=ctx.$implicit;core.xp6(1),core.Q6J("ngIf",variant_r9.name&&variant_r9.value)}}function WishListItemComponent_ng_container_8_Template(rf,ctx){if(1&rf&&(core.ynx(0),core.YNc(1,WishListItemComponent_ng_container_8_div_1_Template,2,1,"div",16),core.BQk()),2&rf){const ctx_r2=core.oxw();core.xp6(1),core.Q6J("ngForOf",null==ctx_r2.cartEntry.product||null==ctx_r2.cartEntry.product.baseOptions[0]||null==ctx_r2.cartEntry.product.baseOptions[0].selected?null:ctx_r2.cartEntry.product.baseOptions[0].selected.variantOptionQualifiers)}}function WishListItemComponent_td_9_div_4_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",23),core._uU(1),core.qZA()),2&rf){const ctx_r12=core.oxw(2);core.xp6(1),core.hij(" ",null==ctx_r12.cartEntry.basePrice?null:ctx_r12.cartEntry.basePrice.formattedValue," ")}}function WishListItemComponent_td_9_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"td",20)(1,"div",21),core._uU(2),core.ALo(3,"cxTranslate"),core.qZA(),core.YNc(4,WishListItemComponent_td_9_div_4_Template,2,1,"div",22),core.qZA()),2&rf){const ctx_r3=core.oxw();core.xp6(2),core.hij(" ",core.lcZ(3,2,"cartItems.itemPrice")," "),core.xp6(2),core.Q6J("ngIf",ctx_r3.cartEntry.basePrice)}}function WishListItemComponent_ng_container_11_Template(rf,ctx){1&rf&&core.GkF(0,24)}function WishListItemComponent_ng_template_12_Template(rf,ctx){1&rf&&(core.TgZ(0,"span",25),core._uU(1),core.ALo(2,"cxTranslate"),core.qZA()),2&rf&&(core.xp6(1),core.hij(" ",core.lcZ(2,1,"addToCart.outOfStock")," "))}function WishListItemComponent_button_14_Template(rf,ctx){if(1&rf){const _r14=core.EpF();core.TgZ(0,"button",26),core.NdJ("click",__name(function(){core.CHM(_r14);const ctx_r13=core.oxw();return core.KtG(ctx_r13.removeEntry(ctx_r13.cartEntry))},"WishListItemComponent_button_14_Template_button_click_0_listener")),core.ALo(1,"cxTranslate"),core._uU(2),core.ALo(3,"cxTranslate"),core.qZA()}if(2&rf){const ctx_r7=core.oxw();core.Q6J("cxAtMessage",core.lcZ(1,3,"wishlist.itemRemoved"))("disabled",ctx_r7.isLoading),core.xp6(2),core.hij(" ",core.lcZ(3,5,"common.remove")," ")}}function WishListComponent_ng_container_0_table_1_tr_16_Template(rf,ctx){if(1&rf){const _r8=core.EpF();core.TgZ(0,"tr",11),core.NdJ("remove",__name(function($event){core.CHM(_r8);const ctx_r7=core.oxw(3);return core.KtG(ctx_r7.removeEntry($event))},"WishListComponent_ng_container_0_table_1_tr_16_Template_tr_remove_0_listener")),core.ALo(1,"async"),core.qZA()}if(2&rf){const entry_r6=ctx.$implicit,ctx_r5=core.oxw(3);core.Q6J("cartEntry",entry_r6)("isLoading",core.lcZ(1,2,ctx_r5.loading$))}}function WishListComponent_ng_container_0_table_1_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"table",3)(1,"caption",4),core._uU(2),core.ALo(3,"cxTranslate"),core.qZA(),core.TgZ(4,"thead")(5,"tr",5)(6,"th",6),core._uU(7),core.ALo(8,"cxTranslate"),core.qZA(),core.TgZ(9,"th",7),core._uU(10),core.ALo(11,"cxTranslate"),core.qZA(),core.TgZ(12,"th",8),core._uU(13),core.ALo(14,"cxTranslate"),core.qZA()()(),core.TgZ(15,"tbody",9),core.YNc(16,WishListComponent_ng_container_0_table_1_tr_16_Template,2,4,"tr",10),core.qZA()()),2&rf){const wishList_r3=core.oxw().ngIf;core.xp6(2),core.hij(" ",core.lcZ(3,5,"wishlist.caption")," "),core.xp6(5),core.hij(" ",core.lcZ(8,7,"cartItems.description")," "),core.xp6(3),core.hij(" ",core.lcZ(11,9,"cartItems.itemPrice")," "),core.xp6(3),core.hij(" ",core.lcZ(14,11,"cartItems.actions")," "),core.xp6(3),core.Q6J("ngForOf",null==wishList_r3?null:wishList_r3.entries)}}function WishListComponent_ng_container_0_Template(rf,ctx){if(1&rf&&(core.ynx(0),core.YNc(1,WishListComponent_ng_container_0_table_1_Template,17,13,"table",2),core.BQk()),2&rf){const wishList_r3=ctx.ngIf;core.oxw();const _r1=core.MAs(3);core.xp6(1),core.Q6J("ngIf",(null==wishList_r3||null==wishList_r3.entries?null:wishList_r3.entries.length)>0)("ngIfElse",_r1)}}function WishListComponent_ng_template_2_Template(rf,ctx){1&rf&&(core.TgZ(0,"h2"),core._uU(1),core.ALo(2,"cxTranslate"),core.qZA()),2&rf&&(core.xp6(1),core.Oqu(core.lcZ(2,1,"wishlist.empty")))}__name(WishListItemComponent_div_6_Template,"WishListItemComponent_div_6_Template"),__name(WishListItemComponent_div_7_Template,"WishListItemComponent_div_7_Template"),__name(WishListItemComponent_ng_container_8_div_1_div_1_Template,"WishListItemComponent_ng_container_8_div_1_div_1_Template"),__name(WishListItemComponent_ng_container_8_div_1_Template,"WishListItemComponent_ng_container_8_div_1_Template"),__name(WishListItemComponent_ng_container_8_Template,"WishListItemComponent_ng_container_8_Template"),__name(WishListItemComponent_td_9_div_4_Template,"WishListItemComponent_td_9_div_4_Template"),__name(WishListItemComponent_td_9_Template,"WishListItemComponent_td_9_Template"),__name(WishListItemComponent_ng_container_11_Template,"WishListItemComponent_ng_container_11_Template"),__name(WishListItemComponent_ng_template_12_Template,"WishListItemComponent_ng_template_12_Template"),__name(WishListItemComponent_button_14_Template,"WishListItemComponent_button_14_Template"),__name(WishListComponent_ng_container_0_table_1_tr_16_Template,"WishListComponent_ng_container_0_table_1_tr_16_Template"),__name(WishListComponent_ng_container_0_table_1_Template,"WishListComponent_ng_container_0_table_1_Template"),__name(WishListComponent_ng_container_0_Template,"WishListComponent_ng_container_0_Template"),__name(WishListComponent_ng_template_2_Template,"WishListComponent_ng_template_2_Template");class WishListItemComponent{constructor(productListItemContextSource){this.productListItemContextSource=productListItemContextSource,this.isLoading=!1,this.remove=new core.vpe}ngOnChanges(changes){changes?.cartEntry&&this.productListItemContextSource.product$.next(this.cartEntry.product)}removeEntry(item){this.remove.emit(item)}}__name(WishListItemComponent,"WishListItemComponent"),WishListItemComponent.\u0275fac=__name(function(t){return new(t||WishListItemComponent)(core.Y36(spartacus_storefront.e1w))},"WishListItemComponent_Factory"),WishListItemComponent.\u0275cmp=core.Xpm({type:WishListItemComponent,selectors:[["","cx-wish-list-item",""],["cx-wish-list-item"]],inputs:{isLoading:"isLoading",cartEntry:"cartEntry"},outputs:{remove:"remove"},features:[core._Bn([spartacus_storefront.e1w,{provide:spartacus_storefront.Z6X,useExisting:spartacus_storefront.e1w}]),core.TTD],attrs:["cx-wish-list-item",""],decls:15,vars:12,consts:[["role","cell"],[1,"cx-table-item-container"],["tabindex","-1",3,"routerLink"],["format","thumbnail",3,"container"],[1,"cx-info"],["class","cx-name",4,"ngIf"],["class","cx-code",4,"ngIf"],[4,"ngIf"],["role","cell","class","cx-price",4,"ngIf"],["role","cell",1,"cx-actions"],["cxInnerComponentsHost","",4,"ngIf"],["outOfStock",""],["class","link cx-action-link cx-remove-btn",3,"cxAtMessage","disabled","click",4,"ngIf"],[1,"cx-name"],[1,"cx-link",3,"routerLink"],[1,"cx-code"],["class","cx-property",4,"ngFor","ngForOf"],[1,"cx-property"],["class","cx-label",4,"ngIf"],[1,"cx-label"],["role","cell",1,"cx-price"],[1,"cx-mobile-header"],["class","cx-value",4,"ngIf"],[1,"cx-value"],["cxInnerComponentsHost",""],[1,"cx-out-of-stock"],[1,"link","cx-action-link","cx-remove-btn",3,"cxAtMessage","disabled","click"]],template:__name(function(rf,ctx){1&rf&&(core.TgZ(0,"td",0)(1,"div",1)(2,"a",2),core.ALo(3,"cxUrl"),core._UZ(4,"cx-media",3),core.qZA(),core.TgZ(5,"div",4),core.YNc(6,WishListItemComponent_div_6_Template,4,6,"div",5),core.YNc(7,WishListItemComponent_div_7_Template,3,4,"div",6),core.qZA()(),core.YNc(8,WishListItemComponent_ng_container_8_Template,2,1,"ng-container",7),core.qZA(),core.YNc(9,WishListItemComponent_td_9_Template,5,4,"td",8),core.TgZ(10,"td",9),core.YNc(11,WishListItemComponent_ng_container_11_Template,1,0,"ng-container",10),core.YNc(12,WishListItemComponent_ng_template_12_Template,3,3,"ng-template",null,11,core.W1O),core.YNc(14,WishListItemComponent_button_14_Template,4,7,"button",12),core.qZA()),2&rf&&(core.xp6(2),core.Q6J("routerLink",core.lcZ(3,8,core.VKq(10,_c1,ctx.cartEntry.product))),core.xp6(2),core.Q6J("container",null==ctx.cartEntry.product||null==ctx.cartEntry.product.images?null:ctx.cartEntry.product.images.PRIMARY),core.xp6(2),core.Q6J("ngIf",null==ctx.cartEntry.product?null:ctx.cartEntry.product.name),core.xp6(1),core.Q6J("ngIf",null==ctx.cartEntry.product?null:ctx.cartEntry.product.code),core.xp6(1),core.Q6J("ngIf",null==ctx.cartEntry.product||null==ctx.cartEntry.product.baseOptions?null:ctx.cartEntry.product.baseOptions.length),core.xp6(1),core.Q6J("ngIf",ctx.cartEntry.basePrice),core.xp6(2),core.Q6J("ngIf",ctx.cartEntry.updateable),core.xp6(3),core.Q6J("ngIf",ctx.cartEntry.updateable))},"WishListItemComponent_Template"),dependencies:[spartacus_storefront.cgP,common.sg,common.O5,spartacus_storefront.R7z,spartacus_storefront.ik0,router.rH,spartacus_core.X$D,spartacus_core.l2T],encapsulation:2,changeDetection:0});class WishListComponent{constructor(wishListFacade){this.wishListFacade=wishListFacade,this.wishList$=this.wishListFacade.getWishList(),this.loading$=this.wishListFacade.getWishListLoading()}removeEntry(item){this.wishListFacade.removeEntry(item)}}__name(WishListComponent,"WishListComponent"),WishListComponent.\u0275fac=__name(function(t){return new(t||WishListComponent)(core.Y36(spartacus_cart_wish_list_root.qs))},"WishListComponent_Factory"),WishListComponent.\u0275cmp=core.Xpm({type:WishListComponent,selectors:[["cx-wish-list"]],decls:4,vars:3,consts:[[4,"ngIf"],["emptyWishList",""],["role","table",4,"ngIf","ngIfElse"],["role","table"],[1,"cx-visually-hidden"],["role","row",1,"cx-item-list-header","cx-wish-list-header"],["role","columnheader",1,"cx-item-list-desc"],["role","columnheader",1,"cx-item-list-price"],["role","columnheader",1,"cx-item-list-actions"],[1,"cx-item-list-items"],["cx-wish-list-item","","role","row","class","cx-item-list-row cx-wish-list-item-row",3,"cartEntry","isLoading","remove",4,"ngFor","ngForOf"],["cx-wish-list-item","","role","row",1,"cx-item-list-row","cx-wish-list-item-row",3,"cartEntry","isLoading","remove"]],template:__name(function(rf,ctx){1&rf&&(core.YNc(0,WishListComponent_ng_container_0_Template,2,2,"ng-container",0),core.ALo(1,"async"),core.YNc(2,WishListComponent_ng_template_2_Template,3,3,"ng-template",null,1,core.W1O)),2&rf&&core.Q6J("ngIf",core.lcZ(1,1,ctx.wishList$))},"WishListComponent_Template"),dependencies:[common.sg,common.O5,WishListItemComponent,common.Ov,spartacus_core.X$D],encapsulation:2});class WishListComponentsModule{}__name(WishListComponentsModule,"WishListComponentsModule"),WishListComponentsModule.\u0275fac=__name(function(t){return new(t||WishListComponentsModule)},"WishListComponentsModule_Factory"),WishListComponentsModule.\u0275mod=core.oAB({type:WishListComponentsModule}),WishListComponentsModule.\u0275inj=core.cJS({providers:[(0,spartacus_core.i51)({cmsComponents:{WishListComponent:{component:WishListComponent,data:{composition:{inner:["ProductAddToCartComponent"]}},guards:[spartacus_core.a1M]}}})],imports:[spartacus_storefront.p$5,common.ez,spartacus_core.LUR,spartacus_storefront.Td$,spartacus_storefront.cOq,spartacus_storefront._Gt,router.Bz,spartacus_storefront.fsT,spartacus_core.bhT]});var spartacus_cart_base_root=__webpack_require__(405),combineLatest=__webpack_require__(85),from=__webpack_require__(6904),empty=__webpack_require__(4614),distinctUntilChanged=__webpack_require__(3029),tap=__webpack_require__(5171),filter=__webpack_require__(2026),switchMap=__webpack_require__(3714),map=__webpack_require__(6466),withLatestFrom=__webpack_require__(9320),take=__webpack_require__(5426),catchError=__webpack_require__(2155),concatMap=__webpack_require__(6942),spartacus_cart_base_core=__webpack_require__(3834),ngrx_store=__webpack_require__(7776),spartacus_user_account_root=__webpack_require__(2945),ngrx_effects=__webpack_require__(8468);const CREATE_WISH_LIST_SUCCESS="[Wish List] Create Wish List Success",LOAD_WISH_LIST_SUCCESS="[Wish List] Load Wish List Success";class CreateWishList{constructor(payload){this.payload=payload,this.type="[Wish List] Create Wish List"}}__name(CreateWishList,"CreateWishList");class CreateWishListSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(spartacus_cart_base_core.N4,payload.cartId),this.payload=payload,this.type=CREATE_WISH_LIST_SUCCESS}}__name(CreateWishListSuccess,"CreateWishListSuccess");class CreateWishListFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(spartacus_cart_base_core.N4,payload.cartId,payload.error),this.payload=payload,this.type="[Wish List] Create Wish List Fail"}}__name(CreateWishListFail,"CreateWishListFail");class LoadWishList extends spartacus_core.kPG.EntityLoadAction{constructor(payload){super(spartacus_cart_base_core.N4,payload.cartId),this.payload=payload,this.type="[Wish List] Load Wish List"}}__name(LoadWishList,"LoadWishList");class LoadWishListSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(spartacus_cart_base_core.N4,payload.cartId),this.payload=payload,this.type=LOAD_WISH_LIST_SUCCESS}}__name(LoadWishListSuccess,"LoadWishListSuccess");class LoadWishListFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(spartacus_cart_base_core.N4,payload.cartId,payload.error),this.payload=payload,this.type="[Wish List] Load Wish List Fail"}}__name(LoadWishListFail,"LoadWishListFail");function getWishlistName(customerId){return`wishlist${customerId}`}__name(getWishlistName,"getWishlistName");class WishListService{constructor(store,userAccountFacade,multiCartFacade,userIdService){this.store=store,this.userAccountFacade=userAccountFacade,this.multiCartFacade=multiCartFacade,this.userIdService=userIdService}createWishList(userId,name,description){this.store.dispatch(new CreateWishList({userId,name,description}))}getWishList(){return(0,combineLatest.aj)([this.getWishListId(),this.userAccountFacade.get(),this.userIdService.getUserId()]).pipe((0,distinctUntilChanged.x)(),(0,tap.b)(([wishListId,user,userId])=>{!Boolean(wishListId)&&userId!==spartacus_core.Fds&&user?.customerId&&this.loadWishList(userId,user.customerId)}),(0,filter.h)(([wishListId])=>Boolean(wishListId)),(0,switchMap.w)(([wishListId])=>this.multiCartFacade.getCart(wishListId)))}loadWishList(userId,customerId){this.store.dispatch(new LoadWishList({userId,cartId:getWishlistName(customerId)}))}addEntry(productCode){this.getWishListIdWithUserId().subscribe(([wishListId,userId])=>this.multiCartFacade.addEntry(userId,wishListId,productCode,1))}removeEntry(entry){this.getWishListIdWithUserId().subscribe(([wishListId,userId])=>this.multiCartFacade.removeEntry(userId,wishListId,entry.entryNumber))}getWishListLoading(){return this.getWishListId().pipe((0,switchMap.w)(wishListId=>this.multiCartFacade.isStable(wishListId).pipe((0,map.U)(stable=>!stable))))}getWishListId(){return this.multiCartFacade.getCartIdByType(spartacus_cart_base_root.EI.WISH_LIST)}getWishListIdWithUserId(){return this.getWishListId().pipe((0,distinctUntilChanged.x)(),(0,withLatestFrom.M)(this.userIdService.getUserId(),this.userAccountFacade.get()),(0,tap.b)(([wishListId,userId,user])=>{!Boolean(wishListId)&&user?.customerId&&this.loadWishList(userId,user.customerId)}),(0,filter.h)(([wishListId])=>Boolean(wishListId)),(0,map.U)(([wishListId,userId])=>[wishListId,userId]),(0,take.q)(1))}}__name(WishListService,"WishListService"),WishListService.\u0275fac=__name(function(t){return new(t||WishListService)(core.LFG(ngrx_store.yh),core.LFG(spartacus_user_account_root.gf),core.LFG(spartacus_cart_base_root.WT),core.LFG(spartacus_core.XBV))},"WishListService_Factory"),WishListService.\u0275prov=core.Yz7({token:WishListService,factory:WishListService.\u0275fac});const facadeProviders=[WishListService,{provide:spartacus_cart_wish_list_root.qs,useExisting:WishListService}];class WishListEffects{constructor(actions$,cartConnector,userIdService,store){this.actions$=actions$,this.cartConnector=cartConnector,this.userIdService=userIdService,this.store=store,this.createWishList$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Wish List] Create Wish List"),(0,map.U)(action=>action.payload),(0,switchMap.w)(payload=>this.cartConnector.create(payload.userId).pipe((0,switchMap.w)(cart=>this.cartConnector.save(payload.userId,cart.code??"",payload.name,payload.description).pipe((0,switchMap.w)(savedCart=>[new CreateWishListSuccess({cart:savedCart,cartId:(0,spartacus_cart_base_core.T6)(savedCart,payload.userId)})]),(0,catchError.K)(error=>(0,from.D)([new CreateWishListFail({cartId:cart.code??"",error:(0,spartacus_core.cxH)(error)})])))))))),this.loadWishList$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Wish List] Load Wish List"),(0,map.U)(action=>action.payload),(0,concatMap.b)(payload=>{const{userId,cartId}=payload;return this.cartConnector.loadAll(userId).pipe((0,switchMap.w)(carts=>{const wishListName=cartId,wishList=carts.find(cart=>cart.name===wishListName),actions=[];return actions.push(wishList?new LoadWishListSuccess({cart:wishList,cartId:(0,spartacus_cart_base_core.T6)(wishList,userId)}):new CreateWishList({userId,name:wishListName})),actions.push(new spartacus_cart_base_core.$.RemoveCart({cartId:wishListName})),actions}),(0,catchError.K)(error=>(0,from.D)([new LoadWishListFail({cartId,error:(0,spartacus_core.cxH)(error)})])))}))),this.resetWishList$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(spartacus_core.dO9.LANGUAGE_CHANGE,spartacus_core.dO9.CURRENCY_CHANGE),(0,withLatestFrom.M)(this.userIdService.getUserId(),this.store.pipe((0,filter.h)(store2=>!!store2.cart),(0,ngrx_store.Ys)(spartacus_cart_base_core.F5.getCartIdByTypeFactory(spartacus_cart_base_root.EI.WISH_LIST)))),(0,switchMap.w)(([,userId,wishListId])=>Boolean(wishListId)?this.cartConnector.load(userId,wishListId).pipe((0,switchMap.w)(wishList=>[new LoadWishListSuccess({cart:wishList??{},cartId:(0,spartacus_cart_base_core.T6)(wishList,userId)})]),(0,catchError.K)(error=>(0,from.D)([new LoadWishListFail({cartId:wishListId,error:(0,spartacus_core.cxH)(error)})]))):empty.E))),this.setWishListId$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(CREATE_WISH_LIST_SUCCESS,LOAD_WISH_LIST_SUCCESS),(0,map.U)(action=>{switch(action.type){case CREATE_WISH_LIST_SUCCESS:case LOAD_WISH_LIST_SUCCESS:return new spartacus_cart_base_core.$.SetCartTypeIndex({cartType:spartacus_cart_base_root.EI.WISH_LIST,cartId:action.meta.entityId})}}),(0,filter.h)(spartacus_core.pTN))),this.setWishListData$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(CREATE_WISH_LIST_SUCCESS,LOAD_WISH_LIST_SUCCESS),(0,map.U)(action=>{switch(action.type){case CREATE_WISH_LIST_SUCCESS:case LOAD_WISH_LIST_SUCCESS:return new spartacus_cart_base_core.$.SetCartData({cart:action.payload.cart,cartId:action.payload.cartId})}}),(0,filter.h)(spartacus_core.pTN)))}}__name(WishListEffects,"WishListEffects"),WishListEffects.\u0275fac=__name(function(t){return new(t||WishListEffects)(core.LFG(ngrx_effects.eX),core.LFG(spartacus_cart_base_core.CQ),core.LFG(spartacus_core.XBV),core.LFG(ngrx_store.yh))},"WishListEffects_Factory"),WishListEffects.\u0275prov=core.Yz7({token:WishListEffects,factory:WishListEffects.\u0275fac});const effects=[WishListEffects];class WishListStoreModule{}__name(WishListStoreModule,"WishListStoreModule"),WishListStoreModule.\u0275fac=__name(function(t){return new(t||WishListStoreModule)},"WishListStoreModule_Factory"),WishListStoreModule.\u0275mod=core.oAB({type:WishListStoreModule}),WishListStoreModule.\u0275inj=core.cJS({imports:[ngrx_effects.sQ.forFeature(effects)]});class WishListCoreModule{}__name(WishListCoreModule,"WishListCoreModule"),WishListCoreModule.\u0275fac=__name(function(t){return new(t||WishListCoreModule)},"WishListCoreModule_Factory"),WishListCoreModule.\u0275mod=core.oAB({type:WishListCoreModule}),WishListCoreModule.\u0275inj=core.cJS({providers:[...facadeProviders],imports:[WishListStoreModule]});class WishListModule{}__name(WishListModule,"WishListModule"),WishListModule.\u0275fac=__name(function(t){return new(t||WishListModule)},"WishListModule_Factory"),WishListModule.\u0275mod=core.oAB({type:WishListModule}),WishListModule.\u0275inj=core.cJS({imports:[WishListComponentsModule,WishListCoreModule]})}};