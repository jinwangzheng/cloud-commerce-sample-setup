"use strict";(self.webpackChunkb2bspastore=self.webpackChunkb2bspastore||[]).push([[222],{3222:(ee,p,i)=>{i.r(p),i.d(p,{OrganizationUserRegistrationModule:()=>V});var e=i(4650),u=i(610),g=i(6895),a=i(4006),f=i(7039),s=i(4947),c=i(9144),y=i(1086),C=i(591),b=i(2654),h=i(2994),L=i(2198),x=i(7545),T=i(2986),N=i(6538),v=i(7772);const d=function(r){return{ariaLabel:r}};function M(r,o){if(1&r&&(e.TgZ(0,"label")(1,"span",4),e._uU(2),e.ALo(3,"cxTranslate"),e.qZA(),e._UZ(4,"ng-select",24),e.ALo(5,"cxTranslate"),e.ALo(6,"cxTranslate"),e._UZ(7,"cx-form-errors",8),e.qZA()),2&r){const t=e.oxw().ngIf,n=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,7,"userRegistrationForm.fields.country.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(5,9,"userRegistrationForm.fields.country.placeholder")),e.Q6J("searchable",!0)("clearable",!1)("items",t)("cxNgSelectA11y",e.VKq(13,d,e.lcZ(6,11,"userRegistrationForm.fields.country.label"))),e.xp6(3),e.Q6J("control",n.registerForm.get("country.isocode"))}}function O(r,o){if(1&r&&(e.ynx(0,22),e.YNc(1,M,8,15,"label",23),e.BQk()),2&r){const t=o.ngIf;e.xp6(1),e.Q6J("ngIf",0!==t.length)}}function S(r,o){if(1&r&&(e.TgZ(0,"label")(1,"span",4),e._uU(2),e.ALo(3,"cxTranslate"),e.qZA(),e._UZ(4,"ng-select",26),e.ALo(5,"cxTranslate"),e.ALo(6,"cxTranslate"),e._UZ(7,"cx-form-errors",8),e.qZA()),2&r){const t=e.oxw().ngIf,n=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,7,"userRegistrationForm.fields.state.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(5,9,"userRegistrationForm.fields.state.placeholder")),e.Q6J("searchable",!0)("clearable",!1)("items",t)("cxNgSelectA11y",e.VKq(13,d,e.lcZ(6,11,"userRegistrationForm.fields.state.label"))),e.xp6(3),e.Q6J("control",n.registerForm.get("region.isocode"))}}function _(r,o){if(1&r&&(e.ynx(0,25),e.YNc(1,S,8,15,"label",23),e.BQk()),2&r){const t=o.ngIf;e.xp6(1),e.Q6J("ngIf",0!==t.length)}}const q=function(){return{cxRoute:"login"}};function I(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"section"),e._UZ(1,"div",2),e.ALo(2,"cxTranslate"),e.TgZ(3,"form",3),e.NdJ("ngSubmit",function(){e.CHM(t);const l=e.oxw();return e.KtG(l.submit())}),e.TgZ(4,"label")(5,"span",4),e._uU(6),e.ALo(7,"cxTranslate"),e.qZA(),e._UZ(8,"ng-select",5),e.ALo(9,"async"),e.ALo(10,"cxTranslate"),e.ALo(11,"cxTranslate"),e.qZA(),e.TgZ(12,"label")(13,"span",6),e._uU(14),e.ALo(15,"cxTranslate"),e.qZA(),e._UZ(16,"input",7),e.ALo(17,"cxTranslate"),e._UZ(18,"cx-form-errors",8),e.qZA(),e.TgZ(19,"label")(20,"span",6),e._uU(21),e.ALo(22,"cxTranslate"),e.qZA(),e._UZ(23,"input",9),e.ALo(24,"cxTranslate"),e._UZ(25,"cx-form-errors",8),e.qZA(),e.TgZ(26,"label")(27,"span",6),e._uU(28),e.ALo(29,"cxTranslate"),e.qZA(),e._UZ(30,"input",10),e.ALo(31,"cxTranslate"),e._UZ(32,"cx-form-errors",8),e.qZA(),e.TgZ(33,"label")(34,"span",6),e._uU(35),e.ALo(36,"cxTranslate"),e.qZA(),e._UZ(37,"input",11),e.ALo(38,"cxTranslate"),e._UZ(39,"cx-form-errors",8),e.qZA(),e.YNc(40,O,2,1,"ng-container",12),e.ALo(41,"async"),e.TgZ(42,"label")(43,"span",4),e._uU(44),e.ALo(45,"cxTranslate"),e.qZA(),e._UZ(46,"input",13),e.ALo(47,"cxTranslate"),e._UZ(48,"cx-form-errors",8),e.qZA(),e.TgZ(49,"label")(50,"span",4),e._uU(51),e.ALo(52,"cxTranslate"),e.qZA(),e._UZ(53,"input",14),e.ALo(54,"cxTranslate"),e._UZ(55,"cx-form-errors",8),e.qZA(),e.TgZ(56,"label")(57,"span",4),e._uU(58),e.ALo(59,"cxTranslate"),e.qZA(),e._UZ(60,"input",15),e.ALo(61,"cxTranslate"),e._UZ(62,"cx-form-errors",8),e.qZA(),e.TgZ(63,"label")(64,"span",4),e._uU(65),e.ALo(66,"cxTranslate"),e.qZA(),e._UZ(67,"input",16),e.ALo(68,"cxTranslate"),e._UZ(69,"cx-form-errors",8),e.qZA(),e.YNc(70,_,2,1,"ng-container",17),e.ALo(71,"async"),e.TgZ(72,"label")(73,"span",4),e._uU(74),e.ALo(75,"cxTranslate"),e.qZA(),e._UZ(76,"input",18),e.ALo(77,"cxTranslate"),e._UZ(78,"cx-form-errors",8),e.qZA(),e.TgZ(79,"label")(80,"span",4),e._uU(81),e.ALo(82,"cxTranslate"),e.qZA(),e._UZ(83,"textarea",19),e.ALo(84,"cxTranslate"),e._UZ(85,"cx-form-errors",8),e.qZA(),e.TgZ(86,"button",20),e._uU(87),e.ALo(88,"cxTranslate"),e.qZA(),e.TgZ(89,"a",21),e.ALo(90,"cxUrl"),e._uU(91),e.ALo(92,"cxTranslate"),e.qZA()()()}if(2&r){const t=e.oxw();e.xp6(1),e.uIk("aria-label",e.lcZ(2,43,"common.loaded")),e.xp6(2),e.Q6J("formGroup",t.registerForm),e.xp6(3),e.Oqu(e.lcZ(7,45,"userRegistrationForm.fields.titleCode.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(10,49,"userRegistrationForm.fields.titleCode.placeholder")),e.Q6J("searchable",!1)("clearable",!1)("items",e.lcZ(9,47,t.titles$))("cxNgSelectA11y",e.VKq(103,d,e.lcZ(11,51,"userRegistrationForm.fields.titleCode.label"))),e.xp6(6),e.Oqu(e.lcZ(15,53,"userRegistrationForm.fields.firstName.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(17,55,"userRegistrationForm.fields.firstName.placeholder")),e.xp6(2),e.Q6J("control",t.registerForm.get("firstName")),e.xp6(3),e.Oqu(e.lcZ(22,57,"userRegistrationForm.fields.lastName.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(24,59,"userRegistrationForm.fields.lastName.placeholder")),e.xp6(2),e.Q6J("control",t.registerForm.get("lastName")),e.xp6(3),e.Oqu(e.lcZ(29,61,"userRegistrationForm.fields.companyName.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(31,63,"userRegistrationForm.fields.companyName.placeholder")),e.xp6(2),e.Q6J("control",t.registerForm.get("companyName")),e.xp6(3),e.Oqu(e.lcZ(36,65,"userRegistrationForm.fields.email.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(38,67,"userRegistrationForm.fields.email.placeholder")),e.xp6(2),e.Q6J("control",t.registerForm.get("email")),e.xp6(1),e.Q6J("ngIf",e.lcZ(41,69,t.countries$)),e.xp6(4),e.Oqu(e.lcZ(45,71,"userRegistrationForm.fields.addressLine.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(47,73,"userRegistrationForm.fields.addressLine.placeholder")),e.xp6(2),e.Q6J("control",t.registerForm.get("line1")),e.xp6(3),e.Oqu(e.lcZ(52,75,"userRegistrationForm.fields.secondAddressLine.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(54,77,"userRegistrationForm.fields.secondAddressLine.placeholder")),e.xp6(2),e.Q6J("control",t.registerForm.get("line2")),e.xp6(3),e.Oqu(e.lcZ(59,79,"userRegistrationForm.fields.city.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(61,81,"userRegistrationForm.fields.city.label")),e.xp6(2),e.Q6J("control",t.registerForm.get("town")),e.xp6(3),e.Oqu(e.lcZ(66,83,"userRegistrationForm.fields.postalCode.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(68,85,"userRegistrationForm.fields.postalCode.placeholder")),e.xp6(2),e.Q6J("control",t.registerForm.get("postalCode")),e.xp6(1),e.Q6J("ngIf",e.lcZ(71,87,t.regions$)),e.xp6(4),e.Oqu(e.lcZ(75,89,"userRegistrationForm.fields.phoneNumber.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(77,91,"userRegistrationForm.fields.phoneNumber.placeholder")),e.xp6(2),e.Q6J("control",t.registerForm.get("phoneNumber")),e.xp6(3),e.Oqu(e.lcZ(82,93,"userRegistrationForm.fields.message.label")),e.xp6(2),e.s9C("placeholder",e.lcZ(84,95,"userRegistrationForm.fields.message.placeholder")),e.xp6(2),e.Q6J("control",t.registerForm.get("message")),e.xp6(2),e.hij(" ",e.lcZ(88,97,"userRegistrationForm.formSubmitButtonLabel")," "),e.xp6(2),e.Q6J("routerLink",e.lcZ(90,99,e.DdM(105,q))),e.xp6(2),e.Oqu(e.lcZ(92,101,"userRegistrationForm.goToLoginButtonLabel"))}}function z(r,o){1&r&&(e.TgZ(0,"div",27),e._UZ(1,"cx-spinner"),e.qZA())}let R=(()=>{class r{buildForm(){return this.formBuilder.group({titleCode:[null],firstName:["",a.kI.required],lastName:["",a.kI.required],companyName:["",a.kI.required],email:["",[a.kI.required,c.kal.emailValidator]],country:this.formBuilder.group({isocode:[null]}),line1:[""],line2:[""],town:[""],region:this.formBuilder.group({isocode:[null]}),postalCode:[""],phoneNumber:[""],message:[""]})}get form(){return this._form}get countryControl(){return this.form.get("country.isocode")}get regionControl(){return this.form.get("region.isocode")}constructor(t,n,l,m,P,X,K,W){this.userRegisterFacade=t,this.userAddressService=n,this.organizationUserRegistrationFacade=l,this.translationService=m,this.globalMessageService=P,this.authConfigService=X,this.routingService=K,this.formBuilder=W,this._form=this.buildForm()}getTitles(){return this.userRegisterFacade.getTitles()}getCountries(){return this.userAddressService.getDeliveryCountries().pipe((0,h.b)(t=>{0===Object.keys(t).length&&this.userAddressService.loadDeliveryCountries()}))}getRegions(){return this.countryControl?.valueChanges.pipe((0,L.h)(n=>!!n),(0,x.w)(n=>(this.regionControl?.reset(),this.userAddressService.getRegions(n))))??(0,y.of)([])}buildMessageContent(t){return this.translationService.translate("userRegistrationForm.messageToApproverTemplate",{phoneNumber:t.get("phoneNumber")?.value,addressLine:t.get("line1")?.value,secondAddressLine:t.get("line2")?.value,city:t.get("city")?.value,state:t.get("region")?.get("isocode")?.value,postalCode:t.get("postalCode")?.value,country:t.get("country")?.get("isocode")?.value,companyName:t.get("companyName")?.value,message:t.get("message")?.value})}displayGlobalMessage(){return this.globalMessageService.add({key:"userRegistrationForm.successFormSubmitMessage"},s.xUg.MSG_TYPE_CONFIRMATION)}redirectToLogin(){this.authConfigService.getOAuthFlow()===s.C8C.ResourceOwnerPasswordFlow&&this.routingService.go({cxRoute:"login"})}registerUser(t){return this.buildMessageContent(t).pipe((0,T.q)(1),(0,x.w)(n=>this.organizationUserRegistrationFacade.registerUser({titleCode:t.get("titleCode")?.value,firstName:t.get("firstName")?.value,lastName:t.get("lastName")?.value,email:t.get("email")?.value,message:n})),(0,h.b)(()=>{this.displayGlobalMessage(),this.redirectToLogin(),t.reset()}))}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(N.zm),e.LFG(s.kFJ),e.LFG(v._n),e.LFG(s.D7D),e.LFG(s.IWp),e.LFG(s.dSP),e.LFG(s.Znh),e.LFG(a.qu))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),J=(()=>{class r{constructor(t){this.userRegistrationFormService=t,this.titles$=this.userRegistrationFormService.getTitles(),this.countries$=this.userRegistrationFormService.getCountries(),this.regions$=this.userRegistrationFormService.getRegions(),this.registerForm=this.userRegistrationFormService.form,this.isLoading$=new C.X(!1),this.subscriptions=new b.w}submit(){this.registerForm.valid?(this.isLoading$.next(!0),this.subscriptions.add(this.userRegistrationFormService.registerUser(this.registerForm).subscribe({complete:()=>this.isLoading$.next(!1),error:()=>this.isLoading$.next(!1)}))):this.registerForm.markAllAsTouched()}ngOnDestroy(){this.subscriptions.unsubscribe()}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(R))},r.\u0275cmp=e.Xpm({type:r,selectors:[["cx-user-registration-form"]],decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["loading",""],["role","status"],[3,"formGroup","ngSubmit"],[1,"label-content"],["id","title-code-select","formControlName","titleCode","bindLabel","name","bindValue","code",3,"searchable","clearable","items","placeholder","cxNgSelectA11y"],[1,"label-content","required"],["required","true","type","text","name","firstname","formControlName","firstName",1,"form-control",3,"placeholder"],[3,"control"],["required","true","type","text","name","lastname","formControlName","lastName",1,"form-control",3,"placeholder"],["required","true","type","text","name","companyName","formControlName","companyName",1,"form-control",3,"placeholder"],["required","true","type","email","name","email","formControlName","email",1,"form-control",3,"placeholder"],["formGroupName","country",4,"ngIf"],["type","text","formControlName","line1",1,"form-control",3,"placeholder"],["type","text","formControlName","line2",1,"form-control",3,"placeholder"],["type","text","formControlName","town",1,"form-control",3,"placeholder"],["type","text","formControlName","postalCode",1,"form-control",3,"placeholder"],["formGroupName","region",4,"ngIf"],["type","tel","formControlName","phoneNumber",1,"form-control",3,"placeholder"],["formControlName","message","rows","5",1,"form-control",3,"placeholder"],["type","submit",1,"btn","btn-block","btn-primary"],[1,"cx-login-link","btn-link",3,"routerLink"],["formGroupName","country"],[4,"ngIf"],["id","country-select","formControlName","isocode","bindLabel","name","bindValue","isocode",1,"country-select",3,"searchable","clearable","items","placeholder","cxNgSelectA11y"],["formGroupName","region"],["formControlName","isocode","bindLabel","name","bindValue","isocode","id","region-select",1,"region-select",3,"searchable","clearable","items","placeholder","cxNgSelectA11y"],[1,"cx-spinner"]],template:function(t,n){if(1&t&&(e.YNc(0,I,93,106,"section",0),e.ALo(1,"async"),e.YNc(2,z,2,0,"ng-template",null,1,e.W1O)),2&t){const l=e.MAs(3);e.Q6J("ngIf",!e.lcZ(1,2,n.isLoading$))("ngIfElse",l)}},dependencies:[g.O5,a._Y,a.Fj,a.JJ,a.JL,a.Q7,a.sg,a.u,a.x0,u.rH,c.ORR,c.Ahv,f.w9,c.VnX,g.Ov,s.l2T,s.X$D],encapsulation:2,changeDetection:0}),r})(),D=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({providers:[R],imports:[g.ez,a.UX,u.Bz,s.bhT,s.LUR,c.Fme,c.Fym,f.A0,c.LcC,s.pEA.withConfig({cmsComponents:{OrganizationUserRegistrationComponent:{component:J,guards:[s.aOY]}}})]}),r})(),G=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[u.Bz,D]}),r})();const E=new e.OlP("OrganizationUserRegistrationSerializer");class F{}let Z=(()=>{class r{constructor(t){this.adapter=t}registerUser(t){return this.adapter.registerUser(t)}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(F))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac}),r})(),U=(()=>{class r{constructor(t,n){this.userRegistrationConnector=t,this.command=n,this.registerOrganizationUserCommand=this.command.create(l=>this.userRegistrationConnector.registerUser(l.userData))}registerUser(t){return this.registerOrganizationUserCommand.execute({userData:t})}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(Z),e.LFG(s.VDr))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac}),r})();const Q=[U,{provide:v._n,useExisting:U}];let w=(()=>{class r extends s.kck{constructor(){super(...arguments),this.responseStatus=s.sdw.CONFLICT}handleError(t,n){t&&this.getErrors(n)?.length&&this.globalMessageService.add({key:"userRegistrationForm.httpHandlers.conflict"},s.xUg.MSG_TYPE_ERROR)}getErrors(t){return t.error?.errors.filter(n=>"AlreadyExistsError"===n?.type)}getPriority(){return 0}}return r.\u0275fac=function(){let o;return function(n){return(o||(o=e.n5z(r)))(n||r)}}(),r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),B=(()=>{class r{static forRoot(){return{ngModule:r,providers:[...Q,Z,{provide:s.kck,useExisting:w,multi:!0}]}}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({}),r})();var A=i(529),Y=i(1737),k=i(7221);let $=(()=>{class r{constructor(t,n,l){this.http=t,this.occEndpoints=n,this.converter=l}registerUser(t){const n=this.getOrganizationUserRegistrationEndpoint();let l=new A.WM({"Content-Type":"application/json"});return l=s.Fox.createHeader(s._Re,!0,l),t=this.converter.convert(t,E),this.http.post(n,t,{headers:l}).pipe((0,k.K)(m=>(0,Y._)((0,s.cxH)(m))))}getOrganizationUserRegistrationEndpoint(){return this.occEndpoints.buildUrl("organizationUserRegistration")}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(A.eN),e.LFG(s.Lz0),e.LFG(s.IXI))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const j={backend:{occ:{endpoints:{organizationUserRegistration:"/orgUsers"}}}};let H=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({providers:[(0,s.i51)(j),{provide:F,useExisting:$}],imports:[g.ez]}),r})(),V=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[B.forRoot(),G,H]}),r})()}}]);