"use strict";var __defProp=Object.defineProperty,__name=(target,value)=>__defProp(target,"name",{value,configurable:!0});exports.id=718,exports.ids=[718,453],exports.modules={3137:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D:()=>debounce});var _innerSubscribe__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5814);function debounce(durationSelector){return source=>source.lift(new DebounceOperator(durationSelector))}__name(debounce,"debounce");class DebounceOperator{constructor(durationSelector){this.durationSelector=durationSelector}call(subscriber,source){return source.subscribe(new DebounceSubscriber(subscriber,this.durationSelector))}}__name(DebounceOperator,"DebounceOperator");class DebounceSubscriber extends _innerSubscribe__WEBPACK_IMPORTED_MODULE_0__.Ds{constructor(destination,durationSelector){super(destination),this.durationSelector=durationSelector,this.hasValue=!1}_next(value){try{const result=this.durationSelector.call(this,value);result&&this._tryNext(value,result)}catch(err){this.destination.error(err)}}_complete(){this.emitValue(),this.destination.complete()}_tryNext(value,duration){let subscription=this.durationSubscription;this.value=value,this.hasValue=!0,subscription&&(subscription.unsubscribe(),this.remove(subscription)),subscription=(0,_innerSubscribe__WEBPACK_IMPORTED_MODULE_0__.ft)(duration,new _innerSubscribe__WEBPACK_IMPORTED_MODULE_0__.IY(this)),subscription&&!subscription.closed&&this.add(this.durationSubscription=subscription)}notifyNext(){this.emitValue()}notifyComplete(){this.emitValue()}emitValue(){if(this.hasValue){const value=this.value,subscription=this.durationSubscription;subscription&&(this.durationSubscription=void 0,subscription.unsubscribe(),this.remove(subscription)),this.value=void 0,this.hasValue=!1,super._next(value)}}}__name(DebounceSubscriber,"DebounceSubscriber")},7453:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AddToCartComponent:()=>AddToCartComponent,AddToCartModule:()=>AddToCartModule});var _angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(305),_angular_forms__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3070),_spartacus_cart_base_root__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(405),_spartacus_core__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(7093),_spartacus_storefront__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(3525),rxjs_operators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6466),rxjs_operators__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2026),rxjs_operators__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(5426),_angular_common__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(9318);function AddToCartComponent_form_0_div_1_cx_item_counter_5_Template(rf,ctx){if(1&rf&&_angular_core__WEBPACK_IMPORTED_MODULE_0__._UZ(0,"cx-item-counter",9),2&rf){const ctx_r4=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(3);_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("max",ctx_r4.maxQuantity)("control",ctx_r4.addToCartForm.get("quantity"))}}function AddToCartComponent_form_0_div_1_span_7_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(0,"span"),_angular_core__WEBPACK_IMPORTED_MODULE_0__._uU(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA()),2&rf){const ctx_r5=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(3);_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Oqu(ctx_r5.getInventory())}}function AddToCartComponent_form_0_div_1_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(0,"div",5)(1,"label"),_angular_core__WEBPACK_IMPORTED_MODULE_0__._uU(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(3,"cxTranslate"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(4,"div",6),_angular_core__WEBPACK_IMPORTED_MODULE_0__.YNc(5,AddToCartComponent_form_0_div_1_cx_item_counter_5_Template,1,2,"cx-item-counter",7),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(6,"span",8),_angular_core__WEBPACK_IMPORTED_MODULE_0__.YNc(7,AddToCartComponent_form_0_div_1_span_7_Template,2,1,"span",3),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(8,"async"),_angular_core__WEBPACK_IMPORTED_MODULE_0__._uU(9),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(10,"cxTranslate"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(11,"cxTranslate"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA()()()),2&rf){const ctx_r1=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Oqu(_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(3,4,"addToCart.quantity")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(3),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngIf",ctx_r1.hasStock),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngIf",_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(8,6,ctx_r1.showInventory$)),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.hij(" ",ctx_r1.hasStock?_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(10,8,"addToCart.inStock"):_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(11,10,"addToCart.outOfStock"),"")}}function AddToCartComponent_form_0_ng_container_2_ng_template_1_Template(rf,ctx){}function AddToCartComponent_form_0_ng_container_2_Template(rf,ctx){if(1&rf){const _r8=_angular_core__WEBPACK_IMPORTED_MODULE_0__.EpF();_angular_core__WEBPACK_IMPORTED_MODULE_0__.ynx(0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.YNc(1,AddToCartComponent_form_0_ng_container_2_ng_template_1_Template,0,0,"ng-template",10),_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("cxComponentRefChange",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r8);const ctx_r7=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r7.pickupOptionCompRef=$event)},"AddToCartComponent_form_0_ng_container_2_Template_ng_template_cxComponentRefChange_1_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.BQk()}if(2&rf){const ctx_r2=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("cxOutlet",ctx_r2.CartOutlets.ADD_TO_CART_PICKUP_OPTION)("cxComponentRef",ctx_r2.pickupOptionCompRef)}}function AddToCartComponent_form_0_button_3_span_1_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(0,"span",14),_angular_core__WEBPACK_IMPORTED_MODULE_0__._UZ(1,"cx-icon",15),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA()),2&rf){const ctx_r9=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(3);_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("type",ctx_r9.iconTypes.REPEAT)}}function AddToCartComponent_form_0_button_3_Template(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(0,"button",11),_angular_core__WEBPACK_IMPORTED_MODULE_0__.YNc(1,AddToCartComponent_form_0_button_3_span_1_Template,2,1,"span",12),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(2,"cxTranslate"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(3,"span",13),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(4,"cxTranslate"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(5,"cxTranslate"),_angular_core__WEBPACK_IMPORTED_MODULE_0__._uU(6),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ALo(7,"cxTranslate"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA()()),2&rf){const ctx_r3=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);let tmp_4_0,tmp_5_0;_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngClass",null!=ctx_r3.options&&ctx_r3.options.displayAddToCart?"btn btn-tertiary":"btn btn-primary btn-block")("disabled",ctx_r3.quantity<=0||ctx_r3.quantity>ctx_r3.maxQuantity),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngIf",(null==ctx_r3.options?null:ctx_r3.options.addToCartString)===_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(2,6,"addToCart.buyItAgain")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngClass",(null==ctx_r3.options?null:ctx_r3.options.addToCartString)===_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(5,10,"addToCart.buyItAgain")?"buyItAgainLink":""),_angular_core__WEBPACK_IMPORTED_MODULE_0__.uIk("aria-label",null!==(tmp_4_0=null==ctx_r3.options?null:ctx_r3.options.addToCartString)&&void 0!==tmp_4_0?tmp_4_0:_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(4,8,"addToCart.addToCart")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(3),_angular_core__WEBPACK_IMPORTED_MODULE_0__.hij(" ",null!==(tmp_5_0=null==ctx_r3.options?null:ctx_r3.options.addToCartString)&&void 0!==tmp_5_0?tmp_5_0:_angular_core__WEBPACK_IMPORTED_MODULE_0__.lcZ(7,12,"addToCart.addToCart")," ")}}function AddToCartComponent_form_0_Template(rf,ctx){if(1&rf){const _r11=_angular_core__WEBPACK_IMPORTED_MODULE_0__.EpF();_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(0,"form",1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("submit",__name(function(){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r10=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw();return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r10.addToCart())},"AddToCartComponent_form_0_Template_form_submit_0_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.YNc(1,AddToCartComponent_form_0_div_1_Template,12,12,"div",2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.YNc(2,AddToCartComponent_form_0_ng_container_2_Template,2,2,"ng-container",3),_angular_core__WEBPACK_IMPORTED_MODULE_0__.YNc(3,AddToCartComponent_form_0_button_3_Template,8,14,"button",4),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA()}if(2&rf){const ctx_r0=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw();_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("formGroup",ctx_r0.addToCartForm),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngIf",ctx_r0.showQuantity),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngIf",ctx_r0.hasStock),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngIf",ctx_r0.hasStock)}}__name(AddToCartComponent_form_0_div_1_cx_item_counter_5_Template,"AddToCartComponent_form_0_div_1_cx_item_counter_5_Template"),__name(AddToCartComponent_form_0_div_1_span_7_Template,"AddToCartComponent_form_0_div_1_span_7_Template"),__name(AddToCartComponent_form_0_div_1_Template,"AddToCartComponent_form_0_div_1_Template"),__name(AddToCartComponent_form_0_ng_container_2_ng_template_1_Template,"AddToCartComponent_form_0_ng_container_2_ng_template_1_Template"),__name(AddToCartComponent_form_0_ng_container_2_Template,"AddToCartComponent_form_0_ng_container_2_Template"),__name(AddToCartComponent_form_0_button_3_span_1_Template,"AddToCartComponent_form_0_button_3_span_1_Template"),__name(AddToCartComponent_form_0_button_3_Template,"AddToCartComponent_form_0_button_3_Template"),__name(AddToCartComponent_form_0_Template,"AddToCartComponent_form_0_Template");class AddToCartComponent{constructor(currentProductService,cd,activeCartService,component,eventService,productListItemContext){this.currentProductService=currentProductService,this.cd=cd,this.activeCartService=activeCartService,this.component=component,this.eventService=eventService,this.productListItemContext=productListItemContext,this.showQuantity=!0,this.hasStock=!1,this.inventoryThreshold=!1,this.showInventory$=this.component?.data$.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_1__.U)(data=>data.inventoryDisplay)),this.quantity=1,this.addToCartForm=new _angular_forms__WEBPACK_IMPORTED_MODULE_2__.nJ({quantity:new _angular_forms__WEBPACK_IMPORTED_MODULE_2__.p4(1,{updateOn:"blur"})}),this.CartOutlets=_spartacus_cart_base_root__WEBPACK_IMPORTED_MODULE_3__.oC,this.iconTypes=_spartacus_storefront__WEBPACK_IMPORTED_MODULE_4__.e1G}ngOnInit(){this.product?(this.productCode=this.product.code??"",this.setStockInfo(this.product),this.cd.markForCheck()):this.productCode?(this.quantity=1,this.hasStock=!0,this.cd.markForCheck()):this.subscription=(this.productListItemContext?this.productListItemContext.product$:this.currentProductService.getProduct()).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.h)(_spartacus_core__WEBPACK_IMPORTED_MODULE_6__.jWE)).subscribe(product=>{this.productCode=product.code??"",this.setStockInfo(product),this.cd.markForCheck()})}setStockInfo(product){this.quantity=1,this.hasStock=Boolean("outOfStock"!==product.stock?.stockLevelStatus),this.inventoryThreshold=product.stock?.isValueRounded??!1,this.hasStock&&product.stock?.stockLevel&&(this.maxQuantity=product.stock.stockLevel),this.productListItemContext&&(this.showQuantity=!1)}getInventory(){if(this.hasStock){const quantityDisplay=this.maxQuantity?this.maxQuantity.toString():"";return this.inventoryThreshold?quantityDisplay+"+":quantityDisplay}return""}updateCount(value){this.quantity=value}addToCart(){const quantity=this.addToCartForm.get("quantity")?.value;!this.productCode||quantity<=0||(this.pickupOptionCompRef instanceof _angular_core__WEBPACK_IMPORTED_MODULE_0__.UuU&&this.pickupOptionCompRef.instance.intendedPickupLocation$.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_7__.q)(1)).subscribe(intendedPickupLocation=>{this.pickupStore="pickup"===intendedPickupLocation?.pickupOption?intendedPickupLocation.name:void 0}),this.activeCartService.getEntries().pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_7__.q)(1)).subscribe(cartEntries=>{this.activeCartService.addEntry(this.productCode,quantity,this.pickupStore),this.eventService.dispatch(this.createCartUiEventAddToCart(this.productCode,quantity,cartEntries.length,this.pickupStore))}))}createCartUiEventAddToCart(productCode,quantity,numberOfEntriesBeforeAdd,storeName){const newEvent=new _spartacus_cart_base_root__WEBPACK_IMPORTED_MODULE_3__.wj;return newEvent.productCode=productCode,newEvent.quantity=quantity,newEvent.numberOfEntriesBeforeAdd=numberOfEntriesBeforeAdd,newEvent.pickupStoreName=storeName,newEvent}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}__name(AddToCartComponent,"AddToCartComponent"),AddToCartComponent.\u0275fac=__name(function(t){return new(t||AddToCartComponent)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.Y36(_spartacus_storefront__WEBPACK_IMPORTED_MODULE_4__.pHG),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Y36(_angular_core__WEBPACK_IMPORTED_MODULE_0__.sBO),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Y36(_spartacus_cart_base_root__WEBPACK_IMPORTED_MODULE_3__.bu),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Y36(_spartacus_storefront__WEBPACK_IMPORTED_MODULE_4__.exf),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Y36(_spartacus_core__WEBPACK_IMPORTED_MODULE_6__.POd),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Y36(_spartacus_storefront__WEBPACK_IMPORTED_MODULE_4__.Z6X,8))},"AddToCartComponent_Factory"),AddToCartComponent.\u0275cmp=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Xpm({type:AddToCartComponent,selectors:[["cx-add-to-cart"]],inputs:{productCode:"productCode",showQuantity:"showQuantity",options:"options",pickupStore:"pickupStore",product:"product"},decls:1,vars:1,consts:[[3,"formGroup","submit",4,"ngIf"],[3,"formGroup","submit"],["class","quantity",4,"ngIf"],[4,"ngIf"],["type","submit",3,"ngClass","disabled",4,"ngIf"],[1,"quantity"],[1,"cx-counter-stock"],[3,"max","control",4,"ngIf"],[1,"info"],[3,"max","control"],[3,"cxOutlet","cxComponentRef","cxComponentRefChange"],["type","submit",3,"ngClass","disabled"],["class","repeat-icon",4,"ngIf"],[3,"ngClass"],[1,"repeat-icon"],[3,"type"]],template:__name(function(rf,ctx){1&rf&&_angular_core__WEBPACK_IMPORTED_MODULE_0__.YNc(0,AddToCartComponent_form_0_Template,4,4,"form",0),2&rf&&_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngIf",ctx.productCode)},"AddToCartComponent_Template"),dependencies:[_angular_common__WEBPACK_IMPORTED_MODULE_8__.mk,_angular_common__WEBPACK_IMPORTED_MODULE_8__.O5,_angular_forms__WEBPACK_IMPORTED_MODULE_2__._Y,_angular_forms__WEBPACK_IMPORTED_MODULE_2__.JL,_angular_forms__WEBPACK_IMPORTED_MODULE_2__.sg,_spartacus_storefront__WEBPACK_IMPORTED_MODULE_4__.oJW,_spartacus_storefront__WEBPACK_IMPORTED_MODULE_4__.odZ,_spartacus_storefront__WEBPACK_IMPORTED_MODULE_4__.$3S,_angular_common__WEBPACK_IMPORTED_MODULE_8__.Ov,_spartacus_core__WEBPACK_IMPORTED_MODULE_6__.X$D],encapsulation:2,changeDetection:0});class AddToCartModule{}__name(AddToCartModule,"AddToCartModule"),AddToCartModule.\u0275fac=__name(function(t){return new(t||AddToCartModule)},"AddToCartModule_Factory"),AddToCartModule.\u0275mod=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oAB({type:AddToCartModule}),AddToCartModule.\u0275inj=_angular_core__WEBPACK_IMPORTED_MODULE_0__.cJS({providers:[(0,_spartacus_core__WEBPACK_IMPORTED_MODULE_6__.i51)({cmsComponents:{ProductAddToCartComponent:{component:AddToCartComponent,data:{inventoryDisplay:!1}}}})],imports:[_angular_common__WEBPACK_IMPORTED_MODULE_8__.ez,_angular_forms__WEBPACK_IMPORTED_MODULE_2__.UX,_spartacus_core__WEBPACK_IMPORTED_MODULE_6__.LUR,_spartacus_storefront__WEBPACK_IMPORTED_MODULE_4__.QX1,_spartacus_storefront__WEBPACK_IMPORTED_MODULE_4__.Td$,_spartacus_storefront__WEBPACK_IMPORTED_MODULE_4__.f5$]})},3834:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{YA:()=>CART_VALIDATION_NORMALIZER,$:()=>cartGroup_actions,YW:()=>CartAdapter,Jp:()=>CartBaseCoreModule,r_:()=>CartConfigService,CQ:()=>CartConnector,vI:()=>CartEntryAdapter,n5:()=>CartValidationAdapter,i4:()=>CartValidationGuard,Eu:()=>CartVoucherAdapter,N4:()=>MULTI_CART_DATA,F5:()=>multiCartGroup_selectors,Qx:()=>ProductImportInfoService,T6:()=>getCartIdByUserId,xb:()=>isEmpty,F7:()=>isSelectiveCart});var core=__webpack_require__(305),spartacus_core=__webpack_require__(7093),ngrx_store=__webpack_require__(7776),spartacus_cart_base_root=__webpack_require__(405),map=__webpack_require__(6466),concatMap=__webpack_require__(6942),catchError=__webpack_require__(2155),mergeMap=__webpack_require__(7505),groupBy=__webpack_require__(5677),switchMap=__webpack_require__(3714),withLatestFrom=__webpack_require__(9320),filter=__webpack_require__(2026),distinctUntilChanged=__webpack_require__(3029);function distinctUntilKeyChanged(key,compare){return(0,distinctUntilChanged.x)((x,y)=>compare?compare(x[key],y[key]):x[key]===y[key])}__name(distinctUntilKeyChanged,"distinctUntilKeyChanged");var tap=__webpack_require__(5171),take=__webpack_require__(5426),switchMapTo=__webpack_require__(6399),shareReplay=__webpack_require__(1753),pairwise=__webpack_require__(5872),debounce=__webpack_require__(3137),from=__webpack_require__(6904),of=__webpack_require__(5202),Subscription=__webpack_require__(1765),using=__webpack_require__(9156),combineLatest=__webpack_require__(85),ReplaySubject=__webpack_require__(8834),timer=__webpack_require__(6424),empty=__webpack_require__(4614),ngrx_effects=__webpack_require__(8468),spartacus_storefront=__webpack_require__(3525),spartacus_user_profile_root=__webpack_require__(8518),common=__webpack_require__(9318),router=__webpack_require__(8258);const MULTI_CART_DATA="[Multi Cart] Multi Cart Data";class CartAddEntry extends spartacus_core.kPG.EntityProcessesIncrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Add Entry"}}__name(CartAddEntry,"CartAddEntry");class CartAddEntrySuccess extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Add Entry Success"}}__name(CartAddEntrySuccess,"CartAddEntrySuccess");class CartAddEntryFail extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Add Entry Fail"}}__name(CartAddEntryFail,"CartAddEntryFail");class CartRemoveEntry extends spartacus_core.kPG.EntityProcessesIncrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Remove Entry"}}__name(CartRemoveEntry,"CartRemoveEntry");class CartRemoveEntrySuccess extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Remove Entry Success"}}__name(CartRemoveEntrySuccess,"CartRemoveEntrySuccess");class CartRemoveEntryFail extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Remove Entry Fail"}}__name(CartRemoveEntryFail,"CartRemoveEntryFail");class CartUpdateEntry extends spartacus_core.kPG.EntityProcessesIncrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Update Entry"}}__name(CartUpdateEntry,"CartUpdateEntry");class CartUpdateEntrySuccess extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Update Entry Success"}}__name(CartUpdateEntrySuccess,"CartUpdateEntrySuccess");class CartUpdateEntryFail extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-entry] Update Entry Fail"}}__name(CartUpdateEntryFail,"CartUpdateEntryFail");const CART_ADD_VOUCHER="[Cart-voucher] Add Cart Vouchers",CART_ADD_VOUCHER_SUCCESS="[Cart-voucher] Add Cart Voucher Success",CART_REMOVE_VOUCHER="[Cart-voucher] Remove Cart Voucher";class CartAddVoucher extends spartacus_core.kPG.EntityLoadAction{constructor(payload){super(spartacus_core.BzF,"addVoucher"),this.payload=payload,this.type=CART_ADD_VOUCHER}}__name(CartAddVoucher,"CartAddVoucher");class CartAddVoucherFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(spartacus_core.BzF,"addVoucher",payload.error),this.payload=payload,this.type="[Cart-voucher] Add Cart Voucher Fail"}}__name(CartAddVoucherFail,"CartAddVoucherFail");class CartAddVoucherSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(spartacus_core.BzF,"addVoucher"),this.payload=payload,this.type=CART_ADD_VOUCHER_SUCCESS}}__name(CartAddVoucherSuccess,"CartAddVoucherSuccess");class CartResetAddVoucher extends spartacus_core.kPG.EntityLoaderResetAction{constructor(){super(spartacus_core.BzF,"addVoucher"),this.type="[Cart-voucher] Reset Add Cart Voucher"}}__name(CartResetAddVoucher,"CartResetAddVoucher");class CartRemoveVoucher extends spartacus_core.kPG.EntityProcessesIncrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=CART_REMOVE_VOUCHER}}__name(CartRemoveVoucher,"CartRemoveVoucher");class CartRemoveVoucherFail extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-voucher] Remove Cart Voucher Fail"}}__name(CartRemoveVoucherFail,"CartRemoveVoucherFail");class CartRemoveVoucherSuccess extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart-voucher] Remove Cart Voucher Success"}}__name(CartRemoveVoucherSuccess,"CartRemoveVoucherSuccess");const CREATE_CART="[Cart] Create Cart",CREATE_CART_SUCCESS="[Cart] Create Cart Success",LOAD_CART="[Cart] Load Cart",LOAD_CART_SUCCESS="[Cart] Load Cart Success",LOAD_CARTS_SUCCESS="[Cart] Load Carts Success",REMOVE_CART="[Cart] Remove Cart",DELETE_CART="[Cart] Delete Cart",DELETE_CART_SUCCESS="[Cart] Delete Cart Success";class CreateCart extends spartacus_core.kPG.EntityLoadAction{constructor(payload){super(MULTI_CART_DATA,payload.tempCartId),this.payload=payload,this.type=CREATE_CART}}__name(CreateCart,"CreateCart");class CreateCartFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(MULTI_CART_DATA,payload.tempCartId),this.payload=payload,this.type="[Cart] Create Cart Fail"}}__name(CreateCartFail,"CreateCartFail");class CreateCartSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=CREATE_CART_SUCCESS}}__name(CreateCartSuccess,"CreateCartSuccess");class AddEmailToCart extends spartacus_core.kPG.EntityProcessesIncrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart] Add Email to Cart"}}__name(AddEmailToCart,"AddEmailToCart");class AddEmailToCartFail extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart] Add Email to Cart Fail"}}__name(AddEmailToCartFail,"AddEmailToCartFail");class AddEmailToCartSuccess extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type="[Cart] Add Email to Cart Success"}}__name(AddEmailToCartSuccess,"AddEmailToCartSuccess");class LoadCart extends spartacus_core.kPG.EntityLoadAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=LOAD_CART}}__name(LoadCart,"LoadCart");class LoadCartFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId,payload.error),this.payload=payload,this.type="[Cart] Load Cart Fail"}}__name(LoadCartFail,"LoadCartFail");class LoadCartSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=LOAD_CART_SUCCESS}}__name(LoadCartSuccess,"LoadCartSuccess");class LoadCartsSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(MULTI_CART_DATA,payload.map(cart=>cart?.code??"")),this.payload=payload,this.type=LOAD_CARTS_SUCCESS}}__name(LoadCartsSuccess,"LoadCartsSuccess");class MergeCart{constructor(payload){this.payload=payload,this.type="[Cart] Merge Cart"}}__name(MergeCart,"MergeCart");class MergeCartSuccess extends spartacus_core.kPG.EntityRemoveAction{constructor(payload){super(MULTI_CART_DATA,payload.oldCartId),this.payload=payload,this.type="[Cart] Merge Cart Success"}}__name(MergeCartSuccess,"MergeCartSuccess");class ResetCartDetails extends spartacus_core.kPG.ProcessesLoaderResetAction{constructor(){super(MULTI_CART_DATA),this.type="[Cart] Reset Cart Details"}}__name(ResetCartDetails,"ResetCartDetails");class RemoveCart extends spartacus_core.kPG.EntityRemoveAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=REMOVE_CART}}__name(RemoveCart,"RemoveCart");class DeleteCart{constructor(payload){this.payload=payload,this.type=DELETE_CART}}__name(DeleteCart,"DeleteCart");class DeleteCartSuccess extends spartacus_core.kPG.EntityRemoveAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=DELETE_CART_SUCCESS}}__name(DeleteCartSuccess,"DeleteCartSuccess");class DeleteCartFail{constructor(payload){this.payload=payload,this.type="[Cart] Delete Cart Fail"}}__name(DeleteCartFail,"DeleteCartFail");const CLEAR_CART_STATE="[Cart] Clear Cart State",SET_CART_TYPE_INDEX="[Cart] Set cart type index",SET_CART_DATA="[Cart] Set cart data";class CartProcessesIncrement extends spartacus_core.kPG.EntityProcessesIncrementAction{constructor(payload){super(MULTI_CART_DATA,payload),this.payload=payload,this.type="[Cart] Cart Processes Increment"}}__name(CartProcessesIncrement,"CartProcessesIncrement");class CartProcessesDecrement extends spartacus_core.kPG.EntityProcessesDecrementAction{constructor(payload){super(MULTI_CART_DATA,payload),this.payload=payload,this.type="[Cart] Cart Processes Decrement"}}__name(CartProcessesDecrement,"CartProcessesDecrement");class SetActiveCartId{constructor(payload){this.payload=payload,this.type="[Cart] Set Active Cart Id"}}__name(SetActiveCartId,"SetActiveCartId");class ClearCartState extends spartacus_core.kPG.EntityRemoveAllAction{constructor(){super(MULTI_CART_DATA),this.type=CLEAR_CART_STATE}}__name(ClearCartState,"ClearCartState");class SetCartTypeIndex{constructor(payload){this.payload=payload,this.type=SET_CART_TYPE_INDEX}}__name(SetCartTypeIndex,"SetCartTypeIndex");class SetCartData extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(MULTI_CART_DATA,payload.cartId),this.payload=payload,this.type=SET_CART_DATA}}__name(SetCartData,"SetCartData");var cartGroup_actions=Object.freeze({__proto__:null,ADD_EMAIL_TO_CART:"[Cart] Add Email to Cart",ADD_EMAIL_TO_CART_FAIL:"[Cart] Add Email to Cart Fail",ADD_EMAIL_TO_CART_SUCCESS:"[Cart] Add Email to Cart Success",AddEmailToCart,AddEmailToCartFail,AddEmailToCartSuccess,CART_ADD_ENTRY:"[Cart-entry] Add Entry",CART_ADD_ENTRY_FAIL:"[Cart-entry] Add Entry Fail",CART_ADD_ENTRY_SUCCESS:"[Cart-entry] Add Entry Success",CART_ADD_VOUCHER,CART_ADD_VOUCHER_FAIL:"[Cart-voucher] Add Cart Voucher Fail",CART_ADD_VOUCHER_SUCCESS,CART_PROCESSES_DECREMENT:"[Cart] Cart Processes Decrement",CART_PROCESSES_INCREMENT:"[Cart] Cart Processes Increment",CART_REMOVE_ENTRY:"[Cart-entry] Remove Entry",CART_REMOVE_ENTRY_FAIL:"[Cart-entry] Remove Entry Fail",CART_REMOVE_ENTRY_SUCCESS:"[Cart-entry] Remove Entry Success",CART_REMOVE_VOUCHER,CART_REMOVE_VOUCHER_FAIL:"[Cart-voucher] Remove Cart Voucher Fail",CART_REMOVE_VOUCHER_SUCCESS:"[Cart-voucher] Remove Cart Voucher Success",CART_RESET_ADD_VOUCHER:"[Cart-voucher] Reset Add Cart Voucher",CART_UPDATE_ENTRY:"[Cart-entry] Update Entry",CART_UPDATE_ENTRY_FAIL:"[Cart-entry] Update Entry Fail",CART_UPDATE_ENTRY_SUCCESS:"[Cart-entry] Update Entry Success",CLEAR_CART_STATE,CREATE_CART,CREATE_CART_FAIL:"[Cart] Create Cart Fail",CREATE_CART_SUCCESS,CartAddEntry,CartAddEntryFail,CartAddEntrySuccess,CartAddVoucher,CartAddVoucherFail,CartAddVoucherSuccess,CartProcessesDecrement,CartProcessesIncrement,CartRemoveEntry,CartRemoveEntryFail,CartRemoveEntrySuccess,CartRemoveVoucher,CartRemoveVoucherFail,CartRemoveVoucherSuccess,CartResetAddVoucher,CartUpdateEntry,CartUpdateEntryFail,CartUpdateEntrySuccess,ClearCartState,CreateCart,CreateCartFail,CreateCartSuccess,DELETE_CART,DELETE_CART_FAIL:"[Cart] Delete Cart Fail",DELETE_CART_SUCCESS,DeleteCart,DeleteCartFail,DeleteCartSuccess,LOAD_CART,LOAD_CARTS_SUCCESS,LOAD_CART_FAIL:"[Cart] Load Cart Fail",LOAD_CART_SUCCESS,LoadCart,LoadCartFail,LoadCartSuccess,LoadCartsSuccess,MERGE_CART:"[Cart] Merge Cart",MERGE_CART_SUCCESS:"[Cart] Merge Cart Success",MergeCart,MergeCartSuccess,REMOVE_CART,RESET_CART_DETAILS:"[Cart] Reset Cart Details",RemoveCart,ResetCartDetails,SET_ACTIVE_CART_ID:"[Cart] Set Active Cart Id",SET_CART_DATA,SET_CART_TYPE_INDEX,SetActiveCartId,SetCartData,SetCartTypeIndex});class CartEntryAdapter{}__name(CartEntryAdapter,"CartEntryAdapter");class CartEntryConnector{constructor(adapter){this.adapter=adapter}add(userId,cartId,productCode,quantity,pickupStore){return this.adapter.add(userId,cartId,productCode,quantity,pickupStore)}update(userId,cartId,entryNumber,qty,pickupStore,pickupToDelivery=!1){return this.adapter.update(userId,cartId,entryNumber,qty,pickupStore,pickupToDelivery)}remove(userId,cartId,entryNumber){return this.adapter.remove(userId,cartId,entryNumber)}}__name(CartEntryConnector,"CartEntryConnector"),CartEntryConnector.\u0275fac=__name(function(t){return new(t||CartEntryConnector)(core.LFG(CartEntryAdapter))},"CartEntryConnector_Factory"),CartEntryConnector.\u0275prov=core.Yz7({token:CartEntryConnector,factory:CartEntryConnector.\u0275fac,providedIn:"root"});class CartEntryEffects{constructor(actions$,cartEntryConnector){this.actions$=actions$,this.cartEntryConnector=cartEntryConnector,this.contextChange$=this.actions$.pipe((0,ngrx_effects.l4)(spartacus_core.dO9.CURRENCY_CHANGE,spartacus_core.dO9.LANGUAGE_CHANGE)),this.addEntry$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Cart-entry] Add Entry"),(0,map.U)(action=>action.payload),(0,concatMap.b)(payload=>this.cartEntryConnector.add(payload.userId,payload.cartId,payload.productCode,payload.quantity,payload.pickupStore).pipe((0,map.U)(cartModification=>new CartAddEntrySuccess({...payload,...cartModification})),(0,catchError.K)(error=>(0,from.D)([new CartAddEntryFail({...payload,error:(0,spartacus_core.cxH)(error)}),new LoadCart({cartId:payload.cartId,userId:payload.userId})])))),(0,spartacus_core.FM_)(this.contextChange$))),this.removeEntry$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Cart-entry] Remove Entry"),(0,map.U)(action=>action.payload),(0,concatMap.b)(payload=>this.cartEntryConnector.remove(payload.userId,payload.cartId,payload.entryNumber).pipe((0,map.U)(()=>new CartRemoveEntrySuccess({...payload})),(0,catchError.K)(error=>(0,from.D)([new CartRemoveEntryFail({...payload,error:(0,spartacus_core.cxH)(error)}),new LoadCart({cartId:payload.cartId,userId:payload.userId})])))),(0,spartacus_core.FM_)(this.contextChange$))),this.updateEntry$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Cart-entry] Update Entry"),(0,map.U)(action=>action.payload),(0,concatMap.b)(payload=>this.cartEntryConnector.update(payload.userId,payload.cartId,payload.entryNumber,payload.quantity,payload.pickupStore,payload.pickupToDelivery).pipe((0,map.U)(()=>new CartUpdateEntrySuccess({...payload})),(0,catchError.K)(error=>(0,from.D)([new CartUpdateEntryFail({...payload,error:(0,spartacus_core.cxH)(error)}),new LoadCart({cartId:payload.cartId,userId:payload.userId})])))),(0,spartacus_core.FM_)(this.contextChange$)))}}__name(CartEntryEffects,"CartEntryEffects"),CartEntryEffects.\u0275fac=__name(function(t){return new(t||CartEntryEffects)(core.LFG(ngrx_effects.eX),core.LFG(CartEntryConnector))},"CartEntryEffects_Factory"),CartEntryEffects.\u0275prov=core.Yz7({token:CartEntryEffects,factory:CartEntryEffects.\u0275fac});class CartVoucherAdapter{}__name(CartVoucherAdapter,"CartVoucherAdapter");class CartVoucherConnector{constructor(adapter){this.adapter=adapter}add(userId,cartId,voucherId){return this.adapter.add(userId,cartId,voucherId)}remove(userId,cartId,voucherId){return this.adapter.remove(userId,cartId,voucherId)}}__name(CartVoucherConnector,"CartVoucherConnector"),CartVoucherConnector.\u0275fac=__name(function(t){return new(t||CartVoucherConnector)(core.LFG(CartVoucherAdapter))},"CartVoucherConnector_Factory"),CartVoucherConnector.\u0275prov=core.Yz7({token:CartVoucherConnector,factory:CartVoucherConnector.\u0275fac,providedIn:"root"});class CartVoucherEffects{constructor(actions$,cartVoucherConnector,messageService){this.actions$=actions$,this.cartVoucherConnector=cartVoucherConnector,this.messageService=messageService,this.addCartVoucher$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(CART_ADD_VOUCHER),(0,map.U)(action=>action.payload),(0,mergeMap.zg)(payload=>this.cartVoucherConnector.add(payload.userId,payload.cartId,payload.voucherId).pipe((0,map.U)(()=>(this.showGlobalMessage("voucher.applyVoucherSuccess",payload.voucherId,spartacus_core.xUg.MSG_TYPE_CONFIRMATION),new CartAddVoucherSuccess({...payload}))),(0,catchError.K)(error=>(0,from.D)([new CartAddVoucherFail({...payload,error:(0,spartacus_core.cxH)(error)}),new CartProcessesDecrement(payload.cartId),new LoadCart({userId:payload.userId,cartId:payload.cartId})])))))),this.removeCartVoucher$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(CART_REMOVE_VOUCHER),(0,map.U)(action=>action.payload),(0,mergeMap.zg)(payload=>this.cartVoucherConnector.remove(payload.userId,payload.cartId,payload.voucherId).pipe((0,map.U)(()=>(this.showGlobalMessage("voucher.removeVoucherSuccess",payload.voucherId,spartacus_core.xUg.MSG_TYPE_INFO),new CartRemoveVoucherSuccess({userId:payload.userId,cartId:payload.cartId,voucherId:payload.voucherId}))),(0,catchError.K)(error=>(0,from.D)([new CartRemoveVoucherFail({error:(0,spartacus_core.cxH)(error),cartId:payload.cartId,userId:payload.userId,voucherId:payload.voucherId}),new LoadCart({userId:payload.userId,cartId:payload.cartId})]))))))}showGlobalMessage(text,param,messageType){this.messageService.add({key:text,params:{voucherCode:param}},messageType)}}function getCartIdByUserId(cart,userId){return userId===spartacus_core.Fds?cart?.guid??"":cart?.code??""}function isSelectiveCart(cartId=""){return cartId.startsWith("selectivecart")}function isCartNotFoundError(error){return"notFound"===error.reason&&"cart"===error.subjectType&&!isSelectiveCart(error.subject)}function voucherExceededError(error){return"coupon.already.redeemed"===error.message}function voucherInvalidError(error){return"coupon.invalid.code.provided"===error.message}function isVoucherError(error){return"VoucherOperationError"===error.type}function isCartError(error){return"CartError"===error.type||"CartAddressError"===error.type||"CartEntryError"===error.type||"CartEntryGroupError"===error.type}function isTempCartId(cartId){return cartId.startsWith("temp-")}function isEmpty(cart){return!cart||"object"==typeof cart&&0===Object.keys(cart).length}function isEmail(str){return!!str&&!!str.match(spartacus_core.QIJ)}function isJustLoggedIn(userId,previousUserId){return userId!==spartacus_core.Fds&&previousUserId!==userId}__name(CartVoucherEffects,"CartVoucherEffects"),CartVoucherEffects.\u0275fac=__name(function(t){return new(t||CartVoucherEffects)(core.LFG(ngrx_effects.eX),core.LFG(CartVoucherConnector),core.LFG(spartacus_core.IWp))},"CartVoucherEffects_Factory"),CartVoucherEffects.\u0275prov=core.Yz7({token:CartVoucherEffects,factory:CartVoucherEffects.\u0275fac}),__name(getCartIdByUserId,"getCartIdByUserId"),__name(isSelectiveCart,"isSelectiveCart"),__name(isCartNotFoundError,"isCartNotFoundError"),__name(voucherExceededError,"voucherExceededError"),__name(voucherInvalidError,"voucherInvalidError"),__name(isVoucherError,"isVoucherError"),__name(isCartError,"isCartError"),__name(isTempCartId,"isTempCartId"),__name(isEmpty,"isEmpty"),__name(isEmail,"isEmail"),__name(isJustLoggedIn,"isJustLoggedIn");const getMultiCartState=(0,ngrx_store.ZF)("cart"),getMultiCartEntities=(0,ngrx_store.P1)(getMultiCartState,state=>state.carts),getCartEntitySelectorFactory=__name(cartId=>(0,ngrx_store.P1)(getMultiCartEntities,state=>spartacus_core.kPG.entityProcessesLoaderStateSelector(state,cartId)),"getCartEntitySelectorFactory"),getCartSelectorFactory=__name(cartId=>(0,ngrx_store.P1)(getMultiCartEntities,state=>spartacus_core.kPG.entityValueSelector(state,cartId)),"getCartSelectorFactory"),getCartIsStableSelectorFactory=__name(cartId=>(0,ngrx_store.P1)(getMultiCartEntities,state=>spartacus_core.kPG.entityIsStableSelector(state,cartId)),"getCartIsStableSelectorFactory"),getCartHasPendingProcessesSelectorFactory=__name(cartId=>(0,ngrx_store.P1)(getMultiCartEntities,state=>spartacus_core.kPG.entityHasPendingProcessesSelector(state,cartId)),"getCartHasPendingProcessesSelectorFactory"),getCartEntriesSelectorFactory=__name(cartId=>(0,ngrx_store.P1)(getCartSelectorFactory(cartId),state=>state&&state.entries?state.entries:[]),"getCartEntriesSelectorFactory"),getCartEntrySelectorFactory=__name((cartId,productCode)=>(0,ngrx_store.P1)(getCartEntriesSelectorFactory(cartId),state=>state.find(entry=>entry.product?.code===productCode)),"getCartEntrySelectorFactory"),getCartsSelectorFactory=(0,ngrx_store.P1)(getMultiCartEntities,state=>Object.keys(state.entities).map(key=>spartacus_core.kPG.entityValueSelector(state,key))),getCartTypeIndex=(0,ngrx_store.P1)(getMultiCartState,state=>state.index),getCartIdByTypeFactory=__name(type=>(0,ngrx_store.P1)(getCartTypeIndex,state=>state&&state[type]),"getCartIdByTypeFactory");class CartAdapter{}__name(CartAdapter,"CartAdapter");class CartConnector{constructor(adapter){this.adapter=adapter}loadAll(userId){return this.adapter.loadAll(userId)}load(userId,cartId){return this.adapter.load(userId,cartId)}create(userId,oldCartId,toMergeCartGuid){return this.adapter.create(userId,oldCartId,toMergeCartGuid)}delete(userId,cartId){return this.adapter.delete(userId,cartId)}save(userId,cartId,saveCartName,saveCartDescription){return this.adapter.save(userId,cartId,saveCartName,saveCartDescription)}addEmail(userId,cartId,email){return this.adapter.addEmail(userId,cartId,email)}}__name(CartConnector,"CartConnector"),CartConnector.\u0275fac=__name(function(t){return new(t||CartConnector)(core.LFG(CartAdapter))},"CartConnector_Factory"),CartConnector.\u0275prov=core.Yz7({token:CartConnector,factory:CartConnector.\u0275fac,providedIn:"root"});class CartEffects{handleLoadCartError(payload,error){if(error?.error?.errors){if(error.error.errors.filter(err=>"invalid"===err.reason).length>0)return(0,of.of)(new LoadCart({...payload}));if(error.error.errors.filter(err=>isCartNotFoundError(err)||"UnknownResourceError"===err.reason).length>0)return(0,of.of)(new RemoveCart({cartId:payload.cartId}))}return(0,of.of)(new LoadCartFail({...payload,error:(0,spartacus_core.cxH)(error)}))}constructor(actions$,cartConnector,store){this.actions$=actions$,this.cartConnector=cartConnector,this.store=store,this.contextChange$=this.actions$.pipe((0,ngrx_effects.l4)(spartacus_core.dO9.CURRENCY_CHANGE,spartacus_core.dO9.LANGUAGE_CHANGE)),this.loadCart$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(LOAD_CART),(0,map.U)(action=>action.payload),(0,groupBy.v)(payload=>payload.cartId),(0,mergeMap.zg)(group$=>group$.pipe((0,switchMap.w)(payload=>(0,of.of)(payload).pipe((0,withLatestFrom.M)(this.store.pipe((0,ngrx_store.Ys)(getCartHasPendingProcessesSelectorFactory(payload.cartId)))))),(0,filter.h)(([_,hasPendingProcesses])=>!hasPendingProcesses),(0,map.U)(([payload])=>payload),(0,switchMap.w)(payload=>this.cartConnector.load(payload.userId,payload.cartId).pipe((0,mergeMap.zg)(cart=>{let actions=[];return cart?(actions.push(new LoadCartSuccess({...payload,cart,cartId:getCartIdByUserId(cart,payload.userId)})),payload.cartId===spartacus_core.gSv&&actions.push(new RemoveCart({cartId:spartacus_core.gSv}))):actions=[new LoadCartFail({...payload,error:{}})],actions}),(0,catchError.K)(error=>this.handleLoadCartError(payload,error)))))),(0,spartacus_core.FM_)(this.contextChange$))),this.createCart$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(CREATE_CART),(0,map.U)(action=>action.payload),(0,mergeMap.zg)(payload=>this.cartConnector.create(payload.userId,payload.oldCartId,payload.toMergeCartGuid).pipe((0,switchMap.w)(cart=>{const conditionalActions=[];return payload.oldCartId&&conditionalActions.push(new MergeCartSuccess({extraData:payload.extraData,userId:payload.userId,tempCartId:payload.tempCartId,cartId:getCartIdByUserId(cart,payload.userId),oldCartId:payload.oldCartId})),[new CreateCartSuccess({...payload,cart,cartId:getCartIdByUserId(cart,payload.userId)}),new RemoveCart({cartId:payload.tempCartId}),...conditionalActions]}),(0,catchError.K)(error=>(0,of.of)(new CreateCartFail({...payload,error:(0,spartacus_core.cxH)(error)}))))),(0,spartacus_core.FM_)(this.contextChange$))),this.mergeCart$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Cart] Merge Cart"),(0,map.U)(action=>action.payload),(0,switchMap.w)(payload=>this.cartConnector.load(payload.userId,spartacus_core.gSv).pipe((0,map.U)(currentCart=>{if(currentCart?.code!==payload.cartId)return new CreateCart({userId:payload.userId,oldCartId:payload.cartId,toMergeCartGuid:currentCart?currentCart.guid:void 0,extraData:payload.extraData,tempCartId:payload.tempCartId})}),(0,filter.h)(spartacus_core.pTN))),(0,spartacus_core.FM_)(this.contextChange$))),this.refresh$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(CART_ADD_VOUCHER_SUCCESS),(0,map.U)(action=>action.payload),(0,concatMap.b)(payload=>(0,from.D)([new CartProcessesDecrement(payload.cartId),new LoadCart({userId:payload.userId,cartId:payload.cartId})])))),this.refreshWithoutProcesses$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Cart-entry] Add Entry Success","[Cart-entry] Remove Entry Success","[Cart-entry] Update Entry Success","[Cart-voucher] Remove Cart Voucher Success"),(0,map.U)(action=>action.payload),(0,map.U)(payload=>new LoadCart({userId:payload.userId,cartId:payload.cartId})))),this.resetCartDetailsOnSiteContextChange$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(spartacus_core.dO9.LANGUAGE_CHANGE,spartacus_core.dO9.CURRENCY_CHANGE),(0,mergeMap.zg)(()=>[new ResetCartDetails]))),this.addEmail$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Cart] Add Email to Cart"),(0,map.U)(action=>action.payload),(0,mergeMap.zg)(payload=>this.cartConnector.addEmail(payload.userId,payload.cartId,payload.email).pipe((0,mergeMap.zg)(()=>[new AddEmailToCartSuccess({...payload}),new LoadCart({userId:payload.userId,cartId:payload.cartId})]),(0,catchError.K)(error=>(0,from.D)([new AddEmailToCartFail({...payload,error:(0,spartacus_core.cxH)(error)}),new LoadCart({userId:payload.userId,cartId:payload.cartId})])))),(0,spartacus_core.FM_)(this.contextChange$))),this.deleteCart$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(DELETE_CART),(0,map.U)(action=>action.payload),(0,mergeMap.zg)(payload=>this.cartConnector.delete(payload.userId,payload.cartId).pipe((0,map.U)(()=>new DeleteCartSuccess({...payload})),(0,catchError.K)(error=>(0,from.D)([new DeleteCartFail({...payload,error:(0,spartacus_core.cxH)(error)}),new LoadCart({...payload})]))))))}}__name(CartEffects,"CartEffects"),CartEffects.\u0275fac=__name(function(t){return new(t||CartEffects)(core.LFG(ngrx_effects.eX),core.LFG(CartConnector),core.LFG(ngrx_store.yh))},"CartEffects_Factory"),CartEffects.\u0275prov=core.Yz7({token:CartEffects,factory:CartEffects.\u0275fac});class MultiCartEffects{getActiveCartTypeOnLoad(action){if(action?.payload?.cartId===spartacus_core.gSv)return new SetCartTypeIndex({cartType:spartacus_cart_base_root.EI.ACTIVE,cartId:""})}getActiveCartTypeOnCreate(action){if(action?.payload?.extraData?.active)return new SetCartTypeIndex({cartType:spartacus_cart_base_root.EI.ACTIVE,cartId:action.meta.entityId})}constructor(actions$){this.actions$=actions$,this.processesIncrement$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(CART_ADD_VOUCHER),(0,map.U)(action=>action.payload),(0,map.U)(payload=>new CartProcessesIncrement(payload.cartId)))),this.setSelectiveId$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(LOAD_CART_SUCCESS),(0,map.U)(action=>{switch(action.type){case LOAD_CART_SUCCESS:{const payload=action.payload;if(isSelectiveCart(payload.cartId))return new SetCartTypeIndex({cartType:spartacus_cart_base_root.EI.SELECTIVE,cartId:payload.cartId});break}}}),(0,filter.h)(spartacus_core.pTN))),this.setActiveCartId$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(LOAD_CART_SUCCESS,LOAD_CART,CREATE_CART_SUCCESS,CREATE_CART,"[Cart] Set Active Cart Id"),(0,map.U)(action=>{switch(action.type){case LOAD_CART:return this.getActiveCartTypeOnLoad(action);case LOAD_CART_SUCCESS:if(action?.payload?.extraData?.active)return action.payload?.cart.saveTime?new SetCartTypeIndex({cartType:spartacus_cart_base_root.EI.ACTIVE,cartId:""}):new SetCartTypeIndex({cartType:spartacus_cart_base_root.EI.ACTIVE,cartId:action.meta.entityId});break;case CREATE_CART:return this.getActiveCartTypeOnCreate(action);case CREATE_CART_SUCCESS:return new SetCartTypeIndex({cartType:action?.payload?.extraData?.active?spartacus_cart_base_root.EI.ACTIVE:spartacus_cart_base_root.EI.NEW_CREATED,cartId:action.meta.entityId});case"[Cart] Set Active Cart Id":return new SetCartTypeIndex({cartType:spartacus_cart_base_root.EI.ACTIVE,cartId:action.payload})}}),(0,filter.h)(spartacus_core.pTN)))}}__name(MultiCartEffects,"MultiCartEffects"),MultiCartEffects.\u0275fac=__name(function(t){return new(t||MultiCartEffects)(core.LFG(ngrx_effects.eX))},"MultiCartEffects_Factory"),MultiCartEffects.\u0275prov=core.Yz7({token:MultiCartEffects,factory:MultiCartEffects.\u0275fac});const effects=[CartEntryEffects,CartVoucherEffects,CartEffects,MultiCartEffects],cartTypeIndexInitialState={[spartacus_cart_base_root.EI.ACTIVE]:""};function cartTypeIndexReducer(state=cartTypeIndexInitialState,action){switch(action.type){case SET_CART_TYPE_INDEX:return{...state,[action.payload.cartType]:action.payload.cartId};case REMOVE_CART:case DELETE_CART_SUCCESS:return action.payload?.cartId===state[spartacus_cart_base_root.EI.ACTIVE]?{...state,[spartacus_cart_base_root.EI.ACTIVE]:""}:state;case CLEAR_CART_STATE:return cartTypeIndexInitialState}return state}__name(cartTypeIndexReducer,"cartTypeIndexReducer");const cartEntitiesInitialState=void 0;function cartEntitiesReducer(state=cartEntitiesInitialState,action){switch(action.type){case LOAD_CARTS_SUCCESS:return action.payload;case LOAD_CART_SUCCESS:case CREATE_CART_SUCCESS:case SET_CART_DATA:return action.payload.cart}return state}function clearMultiCartState(reducer){return function(state,action){return action.type===spartacus_core.uQL.LOGOUT&&(state=void 0),reducer(state,action)}}__name(cartEntitiesReducer,"cartEntitiesReducer"),__name(clearMultiCartState,"clearMultiCartState");const multiCartMetaReducers=[clearMultiCartState],multiCartReducerToken=new core.OlP("MultiCartReducers");function getMultiCartReducers(){return{carts:spartacus_core.kPG.entityProcessesLoaderReducer(MULTI_CART_DATA,cartEntitiesReducer),index:cartTypeIndexReducer}}__name(getMultiCartReducers,"getMultiCartReducers");const multiCartReducerProvider={provide:multiCartReducerToken,useFactory:getMultiCartReducers};var multiCartGroup_selectors=Object.freeze({__proto__:null,getCartEntitySelectorFactory,getCartEntriesSelectorFactory,getCartEntrySelectorFactory,getCartHasPendingProcessesSelectorFactory,getCartIdByTypeFactory,getCartIsStableSelectorFactory,getCartSelectorFactory,getCartTypeIndex,getCartsSelectorFactory,getMultiCartEntities,getMultiCartState});class MultiCartStatePersistenceService{constructor(statePersistenceService,store,siteContextParamsService){this.statePersistenceService=statePersistenceService,this.store=store,this.siteContextParamsService=siteContextParamsService,this.subscription=new Subscription.w}initSync(){this.subscription.add(this.statePersistenceService.syncWithStorage({key:"cart",state$:this.getCartState(),context$:this.siteContextParamsService.getValues([spartacus_core.iEg]),storageType:spartacus_core.iHd.LOCAL_STORAGE,onRead:state=>this.onRead(state)}))}getCartState(){return this.store.pipe((0,filter.h)(store=>!!store.cart),(0,ngrx_store.Ys)(getMultiCartState),(0,filter.h)(state=>!!state),(0,map.U)(state=>state.index),distinctUntilKeyChanged("Active"),(0,map.U)(indexState=>({active:indexState[spartacus_cart_base_root.EI.ACTIVE]??""})))}onRead(state){this.store.dispatch(new ClearCartState),state?this.store.dispatch(new SetActiveCartId(state.active)):this.store.dispatch(new SetActiveCartId(""))}ngOnDestroy(){this.subscription.unsubscribe()}}function cartStatePersistenceFactory(cartStatePersistenceService,configInit){return __name(()=>configInit.getStable("context").pipe((0,tap.b)(()=>{cartStatePersistenceService.initSync()})).toPromise(),"result")}function uninitializeActiveCartMetaReducerFactory(){return __name(reducer=>(state,action)=>{const newState={...state};return"@ngrx/store/init"===action.type&&(newState.cart={...newState.cart,index:{[spartacus_cart_base_root.EI.ACTIVE]:void 0}}),reducer(newState,action)},"metaReducer")}__name(MultiCartStatePersistenceService,"MultiCartStatePersistenceService"),MultiCartStatePersistenceService.\u0275fac=__name(function(t){return new(t||MultiCartStatePersistenceService)(core.LFG(spartacus_core.WBb),core.LFG(ngrx_store.yh),core.LFG(spartacus_core.Qnj))},"MultiCartStatePersistenceService_Factory"),MultiCartStatePersistenceService.\u0275prov=core.Yz7({token:MultiCartStatePersistenceService,factory:MultiCartStatePersistenceService.\u0275fac,providedIn:"root"}),__name(cartStatePersistenceFactory,"cartStatePersistenceFactory"),__name(uninitializeActiveCartMetaReducerFactory,"uninitializeActiveCartMetaReducerFactory");class CartPersistenceModule{}__name(CartPersistenceModule,"CartPersistenceModule"),CartPersistenceModule.\u0275fac=__name(function(t){return new(t||CartPersistenceModule)},"CartPersistenceModule_Factory"),CartPersistenceModule.\u0275mod=core.oAB({type:CartPersistenceModule}),CartPersistenceModule.\u0275inj=core.cJS({providers:[{provide:spartacus_core.z4I,useFactory:cartStatePersistenceFactory,deps:[MultiCartStatePersistenceService,spartacus_core.yUt],multi:!0},{provide:ngrx_store.sr,useFactory:uninitializeActiveCartMetaReducerFactory,multi:!0}]});class CartValidationAdapter{}__name(CartValidationAdapter,"CartValidationAdapter");class CartValidationConnector{constructor(adapter){this.adapter=adapter}validate(cartId,userId){return this.adapter.validate(cartId,userId)}}__name(CartValidationConnector,"CartValidationConnector"),CartValidationConnector.\u0275fac=__name(function(t){return new(t||CartValidationConnector)(core.LFG(CartValidationAdapter))},"CartValidationConnector_Factory"),CartValidationConnector.\u0275prov=core.Yz7({token:CartValidationConnector,factory:CartValidationConnector.\u0275fac,providedIn:"root"});class CartEventBuilder{constructor(actionsSubject,event,activeCartService,stateEventService){this.actionsSubject=actionsSubject,this.event=event,this.activeCartService=activeCartService,this.stateEventService=stateEventService,this.register()}register(){this.registerCreateCart(),this.registerAddEntry(),this.registerRemoveEntry(),this.registerUpdateEntry(),this.registerDeleteCart(),this.registerAddCartVoucher(),this.registerRemoveCartVoucher(),this.registerMergeCartSuccess()}registerAddEntry(){this.registerMapped({action:"[Cart-entry] Add Entry",event:spartacus_cart_base_root.uP}),this.registerMapped({action:"[Cart-entry] Add Entry Success",event:spartacus_cart_base_root.VD}),this.registerMapped({action:"[Cart-entry] Add Entry Fail",event:spartacus_cart_base_root.K$})}registerRemoveEntry(){this.registerMapped({action:"[Cart-entry] Remove Entry Success",event:spartacus_cart_base_root.A7}),this.registerMapped({action:"[Cart-entry] Remove Entry Fail",event:spartacus_cart_base_root.dC})}registerUpdateEntry(){this.registerMapped({action:"[Cart-entry] Update Entry Success",event:spartacus_cart_base_root.X}),this.registerMapped({action:"[Cart-entry] Update Entry Fail",event:spartacus_cart_base_root.gI})}registerMergeCartSuccess(){this.registerMapped({action:"[Cart] Merge Cart Success",event:spartacus_cart_base_root.pA})}registerCreateCart(){this.stateEventService.register({action:CREATE_CART,event:spartacus_cart_base_root.su}),this.stateEventService.register({action:CREATE_CART_SUCCESS,event:spartacus_cart_base_root.cA}),this.stateEventService.register({action:"[Cart] Create Cart Fail",event:spartacus_cart_base_root.Cj})}registerDeleteCart(){this.stateEventService.register({action:DELETE_CART,event:spartacus_cart_base_root.aY,factory:action=>(0,spartacus_core.PjU)(spartacus_cart_base_root.aY,{...action.payload,cartCode:action.payload.cartId})}),this.stateEventService.register({action:DELETE_CART_SUCCESS,event:spartacus_cart_base_root.N0,factory:action=>(0,spartacus_core.PjU)(spartacus_cart_base_root.N0,{...action.payload,cartCode:action.payload.cartId})}),this.stateEventService.register({action:"[Cart] Delete Cart Fail",event:spartacus_cart_base_root.Ks,factory:action=>(0,spartacus_core.PjU)(spartacus_cart_base_root.Ks,{...action.payload,cartCode:action.payload.cartId})})}registerAddCartVoucher(){this.stateEventService.register({action:CART_ADD_VOUCHER,event:spartacus_cart_base_root.aT}),this.stateEventService.register({action:CART_ADD_VOUCHER_SUCCESS,event:spartacus_cart_base_root.Es}),this.stateEventService.register({action:"[Cart-voucher] Add Cart Voucher Fail",event:spartacus_cart_base_root.re})}registerRemoveCartVoucher(){this.stateEventService.register({action:CART_REMOVE_VOUCHER,event:spartacus_cart_base_root.uX}),this.stateEventService.register({action:"[Cart-voucher] Remove Cart Voucher Success",event:spartacus_cart_base_root.FC}),this.stateEventService.register({action:"[Cart-voucher] Remove Cart Voucher Fail",event:spartacus_cart_base_root.kd})}registerMapped(mapping){const eventStream$=this.getAction(mapping.action).pipe((0,switchMap.w)(action=>(0,of.of)(action).pipe((0,withLatestFrom.M)(this.activeCartService.getActive(),this.activeCartService.getActiveCartId()))),(0,filter.h)(([action,_activeCart,activeCartId])=>action.payload.cartId===activeCartId),(0,map.U)(([action,activeCart])=>(0,spartacus_core.PjU)(mapping.event,{...action.payload,cartCode:activeCart.code,entry:action.payload.entry?action.payload.entry:activeCart.entries?.[Number(action.payload.entryNumber)]})));return this.event.register(mapping.event,eventStream$)}getAction(actionType){return this.actionsSubject.pipe((0,ngrx_effects.l4)(...[].concat(actionType)))}}__name(CartEventBuilder,"CartEventBuilder"),CartEventBuilder.\u0275fac=__name(function(t){return new(t||CartEventBuilder)(core.LFG(ngrx_store.UO),core.LFG(spartacus_core.POd),core.LFG(spartacus_cart_base_root.bu),core.LFG(spartacus_core.vL$))},"CartEventBuilder_Factory"),CartEventBuilder.\u0275prov=core.Yz7({token:CartEventBuilder,factory:CartEventBuilder.\u0275fac,providedIn:"root"});class CartEventModule{constructor(_CartEventBuilder){}}__name(CartEventModule,"CartEventModule"),CartEventModule.\u0275fac=__name(function(t){return new(t||CartEventModule)(core.LFG(CartEventBuilder))},"CartEventModule_Factory"),CartEventModule.\u0275mod=core.oAB({type:CartEventModule}),CartEventModule.\u0275inj=core.cJS({});class CartPageEventBuilder{constructor(eventService){this.eventService=eventService,this.register()}register(){this.eventService.register(spartacus_cart_base_root.uB,this.buildCartPageEvent())}buildCartPageEvent(){return this.eventService.get(spartacus_storefront.z4w).pipe((0,filter.h)(navigationEvent=>"cart"===navigationEvent.semanticRoute),(0,map.U)(navigationEvent=>(0,spartacus_core.PjU)(spartacus_cart_base_root.uB,{navigation:navigationEvent})))}}__name(CartPageEventBuilder,"CartPageEventBuilder"),CartPageEventBuilder.\u0275fac=__name(function(t){return new(t||CartPageEventBuilder)(core.LFG(spartacus_core.POd))},"CartPageEventBuilder_Factory"),CartPageEventBuilder.\u0275prov=core.Yz7({token:CartPageEventBuilder,factory:CartPageEventBuilder.\u0275fac,providedIn:"root"});class CartPageEventModule{constructor(_cartPageEventBuilder){}}__name(CartPageEventModule,"CartPageEventModule"),CartPageEventModule.\u0275fac=__name(function(t){return new(t||CartPageEventModule)(core.LFG(CartPageEventBuilder))},"CartPageEventModule_Factory"),CartPageEventModule.\u0275mod=core.oAB({type:CartPageEventModule}),CartPageEventModule.\u0275inj=core.cJS({});class ActiveCartService{constructor(multiCartFacade,userIdService){this.multiCartFacade=multiCartFacade,this.userIdService=userIdService,this.subscription=new Subscription.w,this.activeCartId$=this.userIdService.getUserId().pipe((0,take.q)(1),(0,switchMapTo.c)(this.multiCartFacade.getCartIdByType(spartacus_cart_base_root.EI.ACTIVE)),(0,filter.h)(cartId=>void 0!==cartId),(0,map.U)(cartId=>""===cartId?spartacus_core.gSv:cartId)),this.cartEntity$=this.activeCartId$.pipe((0,switchMap.w)(cartId=>this.multiCartFacade.getCartEntity(cartId))),this.checkInitLoad=void 0,this.initActiveCart(),this.detectUserChange()}initActiveCart(){const cartValue$=this.cartEntity$.pipe((0,map.U)(cartEntity=>({cart:cartEntity.value,isStable:!cartEntity.loading&&0===cartEntity.processesCount,loaded:Boolean((cartEntity.error||cartEntity.success)&&!cartEntity.loading)})),(0,filter.h)(({isStable,cart})=>isStable||isEmpty(cart))),loading=cartValue$.pipe((0,withLatestFrom.M)(this.activeCartId$,this.userIdService.getUserId()),(0,tap.b)(([{cart,loaded,isStable},cartId,userId])=>{isStable&&isEmpty(cart)&&!loaded&&!isTempCartId(cartId)&&this.load(cartId,userId)}));this.activeCart$=(0,using.g)(()=>loading.subscribe(),()=>cartValue$).pipe((0,map.U)(({cart})=>cart||{}),(0,distinctUntilChanged.x)(),(0,shareReplay.d)({bufferSize:1,refCount:!0}))}detectUserChange(){this.subscription.add(this.userIdService.getUserId().pipe((0,pairwise.G)(),(0,withLatestFrom.M)(this.activeCartId$)).subscribe(([[previousUserId,userId],cartId])=>{isJustLoggedIn(userId,previousUserId)&&this.loadOrMerge(cartId,userId,previousUserId)}))}getActive(){return this.activeCart$}takeActive(){return this.isStable().pipe((0,filter.h)(isStable=>isStable),(0,switchMap.w)(()=>this.getActive()),(0,filter.h)(cart=>!!cart),(0,take.q)(1))}getActiveCartId(){return this.activeCart$.pipe((0,withLatestFrom.M)(this.userIdService.getUserId()),(0,map.U)(([cart,userId])=>getCartIdByUserId(cart,userId)),(0,distinctUntilChanged.x)())}takeActiveCartId(){return this.isStable().pipe((0,filter.h)(isStable=>isStable),(0,switchMap.w)(()=>this.getActiveCartId()),(0,filter.h)(cartId=>!!cartId),(0,take.q)(1))}getEntries(){return this.activeCartId$.pipe((0,switchMap.w)(cartId=>this.multiCartFacade.getEntries(cartId)),(0,distinctUntilChanged.x)())}getLastEntry(productCode){return this.activeCartId$.pipe((0,switchMap.w)(cartId=>this.multiCartFacade.getLastEntry(cartId,productCode)),(0,distinctUntilChanged.x)())}getLoading(){return this.cartEntity$.pipe((0,map.U)(cartEntity=>Boolean(cartEntity.loading)),(0,distinctUntilChanged.x)())}isStable(){return this.activeCartId$.pipe((0,switchMap.w)(cartId=>this.multiCartFacade.isStable(cartId)))}load(cartId,userId){userId===spartacus_core.Fds&&cartId===spartacus_core.gSv||this.multiCartFacade.loadCart({userId,cartId,extraData:{active:!0}})}loadOrMerge(cartId,userId,previousUserId){cartId===spartacus_core.gSv||previousUserId!==spartacus_core.Fds?this.multiCartFacade.loadCart({userId,cartId,extraData:{active:!0}}):Boolean((0,spartacus_core.P51)(this.isGuestCart()))?this.guestCartMerge(cartId):this.multiCartFacade.mergeToCurrentCart({userId,cartId,extraData:{active:!0}})}guestCartMerge(cartId){this.getEntries().pipe((0,take.q)(1)).subscribe(entries=>{this.multiCartFacade.deleteCart(cartId,spartacus_core.Fds),this.addEntriesGuestMerge(entries)})}addEntriesGuestMerge(cartEntries){const entriesToAdd=cartEntries.map(entry=>({productCode:entry.product?.code??"",quantity:entry.quantity??0}));this.requireLoadedCart(!0).pipe((0,withLatestFrom.M)(this.userIdService.getUserId())).subscribe(([cart,userId])=>{this.multiCartFacade.addEntries(userId,getCartIdByUserId(cart,userId),entriesToAdd)})}isCartCreating(cartState,cartId){return isTempCartId(cartId)&&(cartState.loading||cartState.success||cartState.error)}requireLoadedCart(forGuestMerge=!1){this.checkInitLoad=void 0===this.checkInitLoad;const cartSelector$=(forGuestMerge?this.cartEntity$.pipe((0,filter.h)(()=>!Boolean((0,spartacus_core.P51)(this.isGuestCart())))):this.cartEntity$).pipe((0,filter.h)(cartState=>!cartState.loading||!!this.checkInitLoad));return this.activeCartId$.pipe((0,withLatestFrom.M)(cartSelector$),(0,filter.h)(([cartId,cartState])=>!this.isCartCreating(cartState,cartId)),(0,map.U)(([,cartState])=>cartState),(0,take.q)(1),(0,withLatestFrom.M)(this.userIdService.getUserId()),(0,tap.b)(([cartState,userId])=>{isEmpty(cartState.value)&&userId!==spartacus_core.Fds&&!cartState.loading&&this.load(spartacus_core.gSv,userId),this.checkInitLoad=!1}),(0,switchMapTo.c)(cartSelector$),(0,withLatestFrom.M)(this.userIdService.getUserId()),(0,filter.h)(([cartState,userId])=>Boolean(userId===spartacus_core.Fds||cartState.success||cartState.error)),(0,take.q)(1),(0,tap.b)(([cartState,userId])=>{isEmpty(cartState.value)&&this.multiCartFacade.createCart({userId,extraData:{active:!0}})}),(0,switchMapTo.c)(cartSelector$),(0,filter.h)(cartState=>cartState.success||cartState.error),(0,withLatestFrom.M)(this.activeCartId$),(0,filter.h)(([cartState,cartId])=>!this.isCartCreating(cartState,cartId)),(0,map.U)(([cartState])=>cartState.value),(0,filter.h)(cart=>!isEmpty(cart)),(0,take.q)(1))}addEntry(productCode,quantity,pickupStore){this.requireLoadedCart().pipe((0,withLatestFrom.M)(this.userIdService.getUserId())).subscribe(([cart,userId])=>{this.multiCartFacade.addEntry(userId,getCartIdByUserId(cart,userId),productCode,quantity,pickupStore)})}removeEntry(entry){this.activeCartId$.pipe((0,withLatestFrom.M)(this.userIdService.getUserId()),(0,take.q)(1)).subscribe(([cartId,userId])=>{this.multiCartFacade.removeEntry(userId,cartId,entry.entryNumber)})}updateEntry(entryNumber,quantity,pickupStore,pickupToDelivery=!1){this.activeCartId$.pipe((0,withLatestFrom.M)(this.userIdService.getUserId()),(0,take.q)(1)).subscribe(([cartId,userId])=>{this.multiCartFacade.updateEntry(userId,cartId,entryNumber,quantity,pickupStore,pickupToDelivery)})}getEntry(productCode){return this.activeCartId$.pipe((0,switchMap.w)(cartId=>this.multiCartFacade.getEntry(cartId,productCode)),(0,distinctUntilChanged.x)())}addEmail(email){this.activeCartId$.pipe((0,withLatestFrom.M)(this.userIdService.getUserId()),(0,take.q)(1)).subscribe(([cartId,userId])=>{this.multiCartFacade.assignEmail(cartId,userId,email)})}getAssignedUser(){return this.activeCart$.pipe((0,map.U)(cart=>cart.user))}isGuestCart(cart){return cart?(0,of.of)(this.isCartUserGuest(cart)):this.activeCart$.pipe((0,map.U)(activeCart=>this.isCartUserGuest(activeCart)),(0,distinctUntilChanged.x)())}isCartUserGuest(cart){const cartUser=cart.user;return Boolean(cartUser&&(cartUser.name===spartacus_core.YI5||isEmail(cartUser.uid?.split("|").slice(1).join("|"))))}addEntries(cartEntries){const entriesToAdd=cartEntries.map(entry=>({productCode:entry.product?.code??"",quantity:entry.quantity??0}));this.requireLoadedCart().pipe((0,withLatestFrom.M)(this.userIdService.getUserId())).subscribe(([cart,userId])=>{cart&&this.multiCartFacade.addEntries(userId,getCartIdByUserId(cart,userId),entriesToAdd)})}reloadActiveCart(){(0,combineLatest.aj)([this.getActiveCartId(),this.userIdService.takeUserId()]).pipe((0,take.q)(1),(0,map.U)(([cartId,userId])=>{this.multiCartFacade.loadCart({cartId,userId,extraData:{active:!0}})})).subscribe()}hasPickupItems(){return this.getActive().pipe((0,map.U)(cart=>!!cart.pickupItemsQuantity&&cart.pickupItemsQuantity>0))}hasDeliveryItems(){return this.getActive().pipe((0,map.U)(cart=>!!cart.deliveryItemsQuantity&&cart.deliveryItemsQuantity>0))}getPickupEntries(){return this.getEntries().pipe((0,map.U)(entries=>entries.filter(entry=>void 0!==entry.deliveryPointOfService)))}getDeliveryEntries(){return this.getEntries().pipe((0,map.U)(entries=>entries.filter(entry=>void 0===entry.deliveryPointOfService)))}ngOnDestroy(){this.subscription.unsubscribe()}}__name(ActiveCartService,"ActiveCartService"),ActiveCartService.\u0275fac=__name(function(t){return new(t||ActiveCartService)(core.LFG(spartacus_cart_base_root.WT),core.LFG(spartacus_core.XBV))},"ActiveCartService_Factory"),ActiveCartService.\u0275prov=core.Yz7({token:ActiveCartService,factory:ActiveCartService.\u0275fac});class CartValidationStateService{constructor(routingService){this.routingService=routingService,this.NAVIGATION_SKIPS=2,this.navigationIdCount=0,this.subscription=new Subscription.w,this.cartValidationResult$=new ReplaySubject.t(1),this.checkForValidationResultClear$=this.routingService.getRouterState().pipe((0,withLatestFrom.M)(this.cartValidationResult$),(0,tap.b)(([routerState,cartModifications])=>{this.navigationIdCount+this.NAVIGATION_SKIPS<=routerState.navigationId&&cartModifications.length&&(this.cartValidationResult$.next([]),this.navigationIdCount=routerState.navigationId)})),this.setInitialState()}ngOnDestroy(){this.subscription.unsubscribe()}setInitialState(){this.setNavigationIdStep(),this.subscription.add(this.checkForValidationResultClear$.subscribe())}updateValidationResultAndRoutingId(cartModification){this.cartValidationResult$.next(cartModification),this.setNavigationIdStep()}setNavigationIdStep(){this.routingService.getRouterState().pipe((0,take.q)(1)).subscribe(routerState=>this.navigationIdCount=routerState.navigationId)}}__name(CartValidationStateService,"CartValidationStateService"),CartValidationStateService.\u0275fac=__name(function(t){return new(t||CartValidationStateService)(core.LFG(spartacus_core.Znh))},"CartValidationStateService_Factory"),CartValidationStateService.\u0275prov=core.Yz7({token:CartValidationStateService,factory:CartValidationStateService.\u0275fac,providedIn:"root"});class CartValidationService{constructor(cartValidationConnector,command,userIdService,activeCartFacade,cartValidationStateService){this.cartValidationConnector=cartValidationConnector,this.command=command,this.userIdService=userIdService,this.activeCartFacade=activeCartFacade,this.cartValidationStateService=cartValidationStateService,this.validateCartCommand=this.command.create(()=>(0,combineLatest.aj)([this.activeCartFacade.getActiveCartId(),this.userIdService.takeUserId(),this.activeCartFacade.isStable()]).pipe((0,filter.h)(([_,__,loaded])=>loaded),(0,take.q)(1),(0,switchMap.w)(([cartId,userId])=>this.cartValidationConnector.validate(cartId,userId))),{strategy:spartacus_core.flE.CancelPrevious})}validateCart(){return this.validateCartCommand.execute()}getValidationResults(){return this.cartValidationStateService.cartValidationResult$}}__name(CartValidationService,"CartValidationService"),CartValidationService.\u0275fac=__name(function(t){return new(t||CartValidationService)(core.LFG(CartValidationConnector),core.LFG(spartacus_core.VDr),core.LFG(spartacus_core.XBV),core.LFG(spartacus_cart_base_root.bu),core.LFG(CartValidationStateService))},"CartValidationService_Factory"),CartValidationService.\u0275prov=core.Yz7({token:CartValidationService,factory:CartValidationService.\u0275fac});class CartVoucherService{constructor(store,activeCartFacade,userIdService){this.store=store,this.activeCartFacade=activeCartFacade,this.userIdService=userIdService}addVoucher(voucherId,cartId){this.combineUserAndCartId(cartId).subscribe(([occUserId,cartIdentifier])=>this.store.dispatch(new CartAddVoucher({userId:occUserId,cartId:cartIdentifier,voucherId})))}removeVoucher(voucherId,cartId){this.combineUserAndCartId(cartId).subscribe(([occUserId,cartIdentifier])=>this.store.dispatch(new CartRemoveVoucher({userId:occUserId,cartId:cartIdentifier,voucherId})))}getAddVoucherResultError(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessErrorFactory("addVoucher")))}getAddVoucherResultSuccess(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessSuccessFactory("addVoucher")))}getAddVoucherResultLoading(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessLoadingFactory("addVoucher")))}resetAddVoucherProcessingState(){this.store.dispatch(new CartResetAddVoucher)}combineUserAndCartId(cartId){return cartId?this.userIdService.getUserId().pipe((0,take.q)(1),(0,map.U)(userId=>[userId,cartId])):(0,combineLatest.aj)([this.userIdService.getUserId(),this.activeCartFacade.getActiveCartId()]).pipe((0,take.q)(1))}}__name(CartVoucherService,"CartVoucherService"),CartVoucherService.\u0275fac=__name(function(t){return new(t||CartVoucherService)(core.LFG(ngrx_store.yh),core.LFG(spartacus_cart_base_root.bu),core.LFG(spartacus_core.XBV))},"CartVoucherService_Factory"),CartVoucherService.\u0275prov=core.Yz7({token:CartVoucherService,factory:CartVoucherService.\u0275fac});class MultiCartService{constructor(store,userIdService){this.store=store,this.userIdService=userIdService}getCart(cartId){return this.store.pipe((0,ngrx_store.Ys)(getCartSelectorFactory(cartId)))}getCarts(){return this.store.pipe((0,ngrx_store.Ys)(getCartsSelectorFactory))}getCartEntity(cartId){return this.store.pipe((0,ngrx_store.Ys)(getCartEntitySelectorFactory(cartId)))}isStable(cartId){return this.store.pipe((0,ngrx_store.Ys)(getCartIsStableSelectorFactory(cartId)),(0,debounce.D)(isStable=>isStable?(0,timer.H)(0):empty.E),(0,distinctUntilChanged.x)())}generateTempCartId(){return`temp-${Math.random().toString(36).substr(2,9)}`}createCart({userId,oldCartId,toMergeCartGuid,extraData}){const tempCartId=this.generateTempCartId();return this.store.dispatch(new CreateCart({extraData,userId,oldCartId,toMergeCartGuid,tempCartId})),this.getCartIdByType(extraData?.active?spartacus_cart_base_root.EI.ACTIVE:spartacus_cart_base_root.EI.NEW_CREATED).pipe((0,switchMap.w)(cartId=>this.getCart(cartId)),(0,filter.h)(spartacus_core.pTN))}mergeToCurrentCart({userId,cartId,extraData}){const tempCartId=this.generateTempCartId();this.store.dispatch(new MergeCart({userId,cartId,extraData,tempCartId}))}loadCart({cartId,userId,extraData}){this.store.dispatch(new LoadCart({userId,cartId,extraData}))}getEntries(cartId){return this.store.pipe((0,ngrx_store.Ys)(getCartEntriesSelectorFactory(cartId)))}getLastEntry(cartId,productCode){return this.store.pipe((0,ngrx_store.Ys)(getCartEntriesSelectorFactory(cartId)),(0,map.U)(entries=>{const filteredEntries=entries.filter(entry=>entry.product?.code===productCode);return filteredEntries?filteredEntries[filteredEntries.length-1]:void 0}))}addEntry(userId,cartId,productCode,quantity,pickupStore){this.store.dispatch(new CartAddEntry({userId,cartId,productCode,quantity,pickupStore}))}addEntries(userId,cartId,products){products.forEach(product=>{this.store.dispatch(new CartAddEntry({userId,cartId,productCode:product.productCode,quantity:product.quantity}))})}removeEntry(userId,cartId,entryNumber){this.store.dispatch(new CartRemoveEntry({userId,cartId,entryNumber:`${entryNumber}`}))}updateEntry(userId,cartId,entryNumber,quantity,pickupStore,pickupToDelivery=!1){void 0!==quantity&&quantity<=0?this.removeEntry(userId,cartId,entryNumber):this.store.dispatch(new CartUpdateEntry({userId,cartId,pickupStore,pickupToDelivery,entryNumber:`${entryNumber}`,quantity}))}getEntry(cartId,productCode){return this.store.pipe((0,ngrx_store.Ys)(getCartEntrySelectorFactory(cartId,productCode)))}assignEmail(cartId,userId,email){this.store.dispatch(new AddEmailToCart({userId,cartId,email}))}removeCart(cartId){this.store.dispatch(new RemoveCart({cartId}))}deleteCart(cartId,userId){this.store.dispatch(new DeleteCart({userId,cartId}))}reloadCart(cartId,extraData){this.userIdService.takeUserId().subscribe(userId=>this.store.dispatch(new LoadCart({userId,cartId,extraData})))}getCartIdByType(cartType){return this.store.pipe((0,ngrx_store.Ys)(getCartIdByTypeFactory(cartType)),(0,distinctUntilChanged.x)())}}__name(MultiCartService,"MultiCartService"),MultiCartService.\u0275fac=__name(function(t){return new(t||MultiCartService)(core.LFG(ngrx_store.yh),core.LFG(spartacus_core.XBV))},"MultiCartService_Factory"),MultiCartService.\u0275prov=core.Yz7({token:MultiCartService,factory:MultiCartService.\u0275fac});class SelectiveCartService{constructor(userProfileFacade,multiCartFacade,baseSiteService,userIdService){this.userProfileFacade=userProfileFacade,this.multiCartFacade=multiCartFacade,this.baseSiteService=baseSiteService,this.userIdService=userIdService}getCart(){return this.selectiveCart$||(this.selectiveCart$=(0,combineLatest.aj)([this.getSelectiveCartId(),this.userProfileFacade.get(),this.userIdService.getUserId(),this.baseSiteService.getActive()]).pipe((0,distinctUntilChanged.x)(),(0,tap.b)(([selectiveId,user,userId,activeBaseSite])=>{!Boolean(selectiveId)&&userId!==spartacus_core.Fds&&user?.customerId&&this.multiCartFacade.loadCart({userId,cartId:`selectivecart${activeBaseSite}${user.customerId}`})}),(0,filter.h)(([selectiveId])=>Boolean(selectiveId)),(0,switchMap.w)(([selectiveId])=>this.multiCartFacade.getCart(selectiveId)),(0,shareReplay.d)({bufferSize:1,refCount:!0}))),this.selectiveCart$}getEntries(){return this.getSelectiveCartId().pipe((0,switchMap.w)(selectiveId=>this.multiCartFacade.getEntries(selectiveId)))}isStable(){return this.getSelectiveCartId().pipe((0,switchMap.w)(selectiveId=>this.multiCartFacade.isStable(selectiveId)))}addEntry(productCode,quantity){this.getSelectiveIdWithUserId().subscribe(([selectiveId,userId])=>{this.multiCartFacade.addEntry(userId,selectiveId,productCode,quantity)})}removeEntry(entry){this.getSelectiveIdWithUserId().subscribe(([selectiveId,userId])=>{this.multiCartFacade.removeEntry(userId,selectiveId,entry.entryNumber)})}updateEntry(entryNumber,quantity){this.getSelectiveIdWithUserId().subscribe(([selectiveId,userId])=>{this.multiCartFacade.updateEntry(userId,selectiveId,entryNumber,quantity)})}getEntry(productCode){return this.getSelectiveCartId().pipe((0,switchMap.w)(selectiveId=>this.multiCartFacade.getEntry(selectiveId,productCode)))}getSelectiveCartId(){return this.multiCartFacade.getCartIdByType(spartacus_cart_base_root.EI.SELECTIVE)}getSelectiveIdWithUserId(){return this.getSelectiveCartId().pipe((0,distinctUntilChanged.x)(),(0,withLatestFrom.M)(this.userIdService.getUserId()),(0,take.q)(1))}}__name(SelectiveCartService,"SelectiveCartService"),SelectiveCartService.\u0275fac=__name(function(t){return new(t||SelectiveCartService)(core.LFG(spartacus_user_profile_root.aT),core.LFG(spartacus_cart_base_root.WT),core.LFG(spartacus_core.Do$),core.LFG(spartacus_core.XBV))},"SelectiveCartService_Factory"),SelectiveCartService.\u0275prov=core.Yz7({token:SelectiveCartService,factory:SelectiveCartService.\u0275fac});const facadeProviders=[ActiveCartService,{provide:spartacus_cart_base_root.bu,useExisting:ActiveCartService},CartVoucherService,{provide:spartacus_cart_base_root.LN,useExisting:CartVoucherService},MultiCartService,{provide:spartacus_cart_base_root.WT,useExisting:MultiCartService},SelectiveCartService,{provide:spartacus_cart_base_root.Oo,useExisting:SelectiveCartService},CartValidationService,{provide:spartacus_cart_base_root.mU,useExisting:CartValidationService}];class BadCartRequestHandler extends spartacus_core.kck{constructor(){super(...arguments),this.responseStatus=spartacus_core.sdw.BAD_REQUEST}getPriority(){return 0}hasMatch(errorResponse){return super.hasMatch(errorResponse)&&this.getErrors(errorResponse).some(isCartError)}handleError(request,response){this.handleCartNotFoundError(request,response),this.handleOtherCartErrors(request,response)}handleCartNotFoundError(_request,response){this.getErrors(response).filter(e=>isCartNotFoundError(e)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.cartNotFound"},spartacus_core.xUg.MSG_TYPE_ERROR)})}handleOtherCartErrors(_request,response){this.getErrors(response).filter(e=>"notFound"!==e.reason||"cart"!==e.subjectType).forEach(error=>{this.globalMessageService.add(error.message?error.message:{key:"httpHandlers.otherCartErrors"},spartacus_core.xUg.MSG_TYPE_ERROR)})}getErrors(response){return(response.error?.errors||[]).filter(error=>"JaloObjectNoLongerValidError"!==error.type)}}__name(BadCartRequestHandler,"BadCartRequestHandler"),BadCartRequestHandler.\u0275fac=function(){let \u0275BadCartRequestHandler_BaseFactory;return __name(function(t){return(\u0275BadCartRequestHandler_BaseFactory||(\u0275BadCartRequestHandler_BaseFactory=core.n5z(BadCartRequestHandler)))(t||BadCartRequestHandler)},"BadCartRequestHandler_Factory")}(),BadCartRequestHandler.\u0275prov=core.Yz7({token:BadCartRequestHandler,factory:BadCartRequestHandler.\u0275fac,providedIn:"root"});class BadVoucherRequestHandler extends spartacus_core.kck{constructor(){super(...arguments),this.responseStatus=spartacus_core.sdw.BAD_REQUEST}getPriority(){return 0}hasMatch(errorResponse){return super.hasMatch(errorResponse)&&this.getErrors(errorResponse).some(isVoucherError)}handleError(request,response){this.handleVoucherExceededError(request,response),this.handleVoucherInvalidError(request,response)}handleVoucherExceededError(_request,response){this.getErrors(response).filter(e=>voucherExceededError(e)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.voucherExceeded"},spartacus_core.xUg.MSG_TYPE_ERROR)})}handleVoucherInvalidError(_request,response){this.getErrors(response).filter(e=>voucherInvalidError(e)).forEach(()=>{this.globalMessageService.add({key:"httpHandlers.invalidCodeProvided"},spartacus_core.xUg.MSG_TYPE_ERROR)})}getErrors(response){return(response.error?.errors||[]).filter(error=>"JaloObjectNoLongerValidError"!==error.type)}}__name(BadVoucherRequestHandler,"BadVoucherRequestHandler"),BadVoucherRequestHandler.\u0275fac=function(){let \u0275BadVoucherRequestHandler_BaseFactory;return __name(function(t){return(\u0275BadVoucherRequestHandler_BaseFactory||(\u0275BadVoucherRequestHandler_BaseFactory=core.n5z(BadVoucherRequestHandler)))(t||BadVoucherRequestHandler)},"BadVoucherRequestHandler_Factory")}(),BadVoucherRequestHandler.\u0275prov=core.Yz7({token:BadVoucherRequestHandler,factory:BadVoucherRequestHandler.\u0275fac,providedIn:"root"});class MultiCartStoreModule{}__name(MultiCartStoreModule,"MultiCartStoreModule"),MultiCartStoreModule.\u0275fac=__name(function(t){return new(t||MultiCartStoreModule)},"MultiCartStoreModule_Factory"),MultiCartStoreModule.\u0275mod=core.oAB({type:MultiCartStoreModule}),MultiCartStoreModule.\u0275inj=core.cJS({providers:[multiCartReducerProvider],imports:[common.ez,spartacus_core.vUS,ngrx_store.Aw.forFeature("cart",multiCartReducerToken,{metaReducers:multiCartMetaReducers}),ngrx_effects.sQ.forFeature(effects)]});class CartBaseCoreModule{}__name(CartBaseCoreModule,"CartBaseCoreModule"),CartBaseCoreModule.\u0275fac=__name(function(t){return new(t||CartBaseCoreModule)},"CartBaseCoreModule_Factory"),CartBaseCoreModule.\u0275mod=core.oAB({type:CartBaseCoreModule}),CartBaseCoreModule.\u0275inj=core.cJS({providers:[CartConnector,CartEntryConnector,CartVoucherConnector,CartValidationConnector,...facadeProviders,{provide:spartacus_core.kck,useExisting:BadCartRequestHandler,multi:!0},{provide:spartacus_core.kck,useExisting:BadVoucherRequestHandler,multi:!0}],imports:[CartEventModule,MultiCartStoreModule,CartPersistenceModule,CartPageEventModule]});const CART_VALIDATION_NORMALIZER=new core.OlP("CartValidationNormalizer");class CartConfigService{constructor(config){this.config=config}isSelectiveCartEnabled(){return Boolean(this.config?.cart?.selectiveCart?.enabled)}isCartValidationEnabled(){return Boolean(this.config?.cart?.validation?.enabled)}}__name(CartConfigService,"CartConfigService"),CartConfigService.\u0275fac=__name(function(t){return new(t||CartConfigService)(core.LFG(spartacus_cart_base_root.qB))},"CartConfigService_Factory"),CartConfigService.\u0275prov=core.Yz7({token:CartConfigService,factory:CartConfigService.\u0275fac,providedIn:"root"});class CartValidationGuard{constructor(cartValidationService,semanticPathService,router2,globalMessageService,activeCartService,cartValidationStateService,cartConfigService){this.cartValidationService=cartValidationService,this.semanticPathService=semanticPathService,this.router=router2,this.globalMessageService=globalMessageService,this.activeCartService=activeCartService,this.cartValidationStateService=cartValidationStateService,this.cartConfigService=cartConfigService,this.GLOBAL_MESSAGE_TIMEOUT=1e4}canActivate(){return this.cartConfigService.isCartValidationEnabled()?this.cartValidationService.validateCart().pipe((0,withLatestFrom.M)(this.activeCartService.getEntries()),(0,map.U)(([cartModificationList,cartEntries])=>{if(this.cartValidationStateService.updateValidationResultAndRoutingId(cartModificationList.cartModifications??[]),void 0!==cartModificationList.cartModifications&&0!==cartModificationList.cartModifications.length){let validationResultMessage;const modification=cartModificationList.cartModifications[0];return validationResultMessage=1===cartEntries.length&&cartEntries[0].product?.code===modification.entry?.product?.code&&modification.statusCode===spartacus_cart_base_root.v$.NO_STOCK?{key:"validation.cartEntryRemoved",params:{name:modification.entry?.product?.name}}:{key:"validation.cartEntriesChangeDuringCheckout"},this.globalMessageService.add(validationResultMessage,spartacus_core.xUg.MSG_TYPE_ERROR,this.GLOBAL_MESSAGE_TIMEOUT),this.activeCartService.reloadActiveCart(),this.router.parseUrl(this.semanticPathService.get("cart")??"")}return!0})):(0,of.of)(!0)}}__name(CartValidationGuard,"CartValidationGuard"),CartValidationGuard.\u0275fac=__name(function(t){return new(t||CartValidationGuard)(core.LFG(spartacus_cart_base_root.mU),core.LFG(spartacus_core.hCH),core.LFG(router.F0),core.LFG(spartacus_core.IWp),core.LFG(spartacus_cart_base_root.bu),core.LFG(CartValidationStateService),core.LFG(CartConfigService))},"CartValidationGuard_Factory"),CartValidationGuard.\u0275prov=core.Yz7({token:CartValidationGuard,factory:CartValidationGuard.\u0275fac,providedIn:"root"});class ProductImportInfoService{constructor(actionsSubject){this.actionsSubject=actionsSubject}getResults(cartId){return this.actionsSubject.pipe((0,ngrx_effects.l4)("[Cart-entry] Add Entry Success","[Cart-entry] Add Entry Fail"),(0,filter.h)(action=>action.payload.cartId===cartId),(0,map.U)(action=>this.mapMessages(action)))}mapMessages(action){const{productCode}=action.payload;if(action instanceof CartAddEntrySuccess){const{quantity,quantityAdded,entry,statusCode}=action.payload;if(statusCode===spartacus_cart_base_root.QX.LOW_STOCK)return{productCode,statusCode,productName:entry?.product?.name,quantity,quantityAdded};if(statusCode===spartacus_cart_base_root.QX.SUCCESS||statusCode===spartacus_cart_base_root.QX.NO_STOCK)return{productCode,statusCode,productName:entry?.product?.name}}else if(action instanceof CartAddEntryFail){const{error}=action.payload;if("UnknownIdentifierError"===error?.details[0]?.type)return{productCode,statusCode:spartacus_cart_base_root.QX.UNKNOWN_IDENTIFIER}}return(0,core.X6Q)()&&console.warn("Unrecognized cart add entry action type while mapping messages",action),{productCode,statusCode:spartacus_cart_base_root.QX.UNKNOWN_ERROR}}}__name(ProductImportInfoService,"ProductImportInfoService"),ProductImportInfoService.\u0275fac=__name(function(t){return new(t||ProductImportInfoService)(core.LFG(ngrx_store.UO))},"ProductImportInfoService_Factory"),ProductImportInfoService.\u0275prov=core.Yz7({token:ProductImportInfoService,factory:ProductImportInfoService.\u0275fac,providedIn:"root"})},2718:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SavedCartModule:()=>SavedCartModule});var core=__webpack_require__(305),Subscription=__webpack_require__(1765),combineLatest=__webpack_require__(85),queue=__webpack_require__(6635),merge=__webpack_require__(6273),tap=__webpack_require__(5171),map=__webpack_require__(6466),take=__webpack_require__(5426),distinctUntilChanged=__webpack_require__(3029),filter=__webpack_require__(2026),switchMap=__webpack_require__(3714),shareReplay=__webpack_require__(1753),mapTo=__webpack_require__(8413),Subscriber=__webpack_require__(1397);function every(predicate,thisArg){return source=>source.lift(new EveryOperator(predicate,thisArg,source))}__name(every,"every");class EveryOperator{constructor(predicate,thisArg,source){this.predicate=predicate,this.thisArg=thisArg,this.source=source}call(observer,source){return source.subscribe(new EverySubscriber(observer,this.predicate,this.thisArg,this.source))}}__name(EveryOperator,"EveryOperator");class EverySubscriber extends Subscriber.L{constructor(destination,predicate,thisArg,source){super(destination),this.predicate=predicate,this.thisArg=thisArg,this.source=source,this.index=0,this.thisArg=thisArg||this}notifyComplete(everyValueMatch){this.destination.next(everyValueMatch),this.destination.complete()}_next(value){let result=!1;try{result=this.predicate.call(this.thisArg,value,this.index++,this.source)}catch(err){return void this.destination.error(err)}result||this.notifyComplete(!1)}_complete(){this.notifyComplete(!0)}}__name(EverySubscriber,"EverySubscriber");var observeOn=__webpack_require__(3988),debounce=__webpack_require__(3137),spartacus_cart_base_root=__webpack_require__(405),spartacus_core=__webpack_require__(7093),spartacus_storefront=__webpack_require__(3525),common=__webpack_require__(9318),router=__webpack_require__(8258),spartacus_cart_saved_cart_root=__webpack_require__(8109),spartacus_cart_base_components_add_to_cart=__webpack_require__(7453),spartacus_cart_base_core=__webpack_require__(3834),fesm2020_forms=__webpack_require__(3070);const _c0=["element"],_c1=__name(function(){return{cxRoute:"savedCarts"}},"_c1");function AddToSavedCartComponent_ng_container_0_Template(rf,ctx){if(1&rf){const _r4=core.EpF();core.ynx(0),core.TgZ(1,"div",1)(2,"a",2),core.ALo(3,"cxUrl"),core.TgZ(4,"span"),core._uU(5),core.ALo(6,"cxTranslate"),core.qZA()(),core.TgZ(7,"a",3,4),core.NdJ("click",__name(function(){const cart_r1=core.CHM(_r4).ngIf,ctx_r3=core.oxw();return core.KtG(ctx_r3.saveCart(cart_r1))},"AddToSavedCartComponent_ng_container_0_Template_a_click_7_listener")),core.ALo(9,"async"),core.TgZ(10,"span"),core._uU(11),core.ALo(12,"cxTranslate"),core.qZA()()(),core.BQk()}if(2&rf){const ctx_r0=core.oxw();core.xp6(2),core.Q6J("routerLink",core.lcZ(3,5,core.DdM(13,_c1))),core.xp6(3),core.Oqu(core.lcZ(6,7,"addToSavedCart.savedCarts")),core.xp6(2),core.ekj("disabled",core.lcZ(9,9,ctx_r0.disableSaveCartForLater$)),core.xp6(4),core.Oqu(core.lcZ(12,11,"addToSavedCart.saveCartForLater"))}}function SavedCartDetailsActionComponent_ng_container_0_Template(rf,ctx){if(1&rf){const _r5=core.EpF();core.ynx(0),core.TgZ(1,"div",1)(2,"div",2)(3,"button",3,4),core.NdJ("click",__name(function(){const cart_r1=core.CHM(_r5).ngIf,ctx_r4=core.oxw();return core.KtG(ctx_r4.openDialog(cart_r1,ctx_r4.savedCartFormType.DELETE))},"SavedCartDetailsActionComponent_ng_container_0_Template_button_click_3_listener")),core._uU(5),core.ALo(6,"cxTranslate"),core.qZA()(),core.TgZ(7,"div",2)(8,"button",5,4),core.NdJ("click",__name(function(){const cart_r1=core.CHM(_r5).ngIf,ctx_r6=core.oxw();return core.KtG(ctx_r6.openDialog(cart_r1,ctx_r6.savedCartFormType.RESTORE))},"SavedCartDetailsActionComponent_ng_container_0_Template_button_click_8_listener")),core._uU(10),core.ALo(11,"cxTranslate"),core.qZA()()(),core.BQk()}2&rf&&(core.xp6(5),core.hij(" ",core.lcZ(6,2,"savedCartDetails.deleteSavedCart")," "),core.xp6(5),core.hij(" ",core.lcZ(11,4,"savedCartList.makeCartActive")," "))}function SavedCartDetailsItemsComponent_ng_container_0_ng_container_1_ng_template_4_Template(rf,ctx){}__name(AddToSavedCartComponent_ng_container_0_Template,"AddToSavedCartComponent_ng_container_0_Template"),__name(SavedCartDetailsActionComponent_ng_container_0_Template,"SavedCartDetailsActionComponent_ng_container_0_Template"),__name(SavedCartDetailsItemsComponent_ng_container_0_ng_container_1_ng_template_4_Template,"SavedCartDetailsItemsComponent_ng_container_0_ng_container_1_ng_template_4_Template");const _c2=__name(function(a1,a2,a3){return{displayAddToCart:!0,addToCartString:a1,optionalBtn:a2,cartType:a3}},"_c2"),_c3=__name(function(a0,a1,a2,a3,a4){return{cartId:a0,cartIsLoading:a1,items:a2,promotionLocation:a3,options:a4}},"_c3");function SavedCartDetailsItemsComponent_ng_container_0_ng_container_1_Template(rf,ctx){if(1&rf&&(core.ynx(0),core._UZ(1,"div",4),core.ALo(2,"cxTranslate"),core.TgZ(3,"div",5),core.YNc(4,SavedCartDetailsItemsComponent_ng_container_0_ng_container_1_ng_template_4_Template,0,0,"ng-template",6),core.ALo(5,"async"),core.ALo(6,"async"),core.qZA(),core.BQk()),2&rf){const cart_r5=core.oxw().ngIf,ctx_r6=core.oxw(),_r3=core.MAs(5);core.xp6(1),core.uIk("aria-label",core.lcZ(2,3,"common.loaded")),core.xp6(3),core.Q6J("cxOutlet",ctx_r6.CartOutlets.CART_ITEM_LIST)("cxOutletContext",core.qbA(13,_c3,cart_r5.code,!core.lcZ(5,5,ctx_r6.cartLoaded$),cart_r5.entries,ctx_r6.CartLocation.SavedCart,core.kEZ(9,_c2,core.lcZ(6,7,ctx_r6.buyItAgainTranslation$),_r3,ctx_r6.CartType.SELECTIVE)))}}function SavedCartDetailsItemsComponent_ng_container_0_Template(rf,ctx){if(1&rf&&(core.ynx(0),core.YNc(1,SavedCartDetailsItemsComponent_ng_container_0_ng_container_1_Template,7,19,"ng-container",3),core.BQk()),2&rf){const cart_r5=ctx.ngIf;core.oxw();const _r1=core.MAs(3);core.xp6(1),core.Q6J("ngIf",(null==cart_r5||null==cart_r5.entries?null:cart_r5.entries.length)>0)("ngIfElse",_r1)}}function SavedCartDetailsItemsComponent_ng_template_2_Template(rf,ctx){1&rf&&(core.TgZ(0,"div",7),core._UZ(1,"cx-spinner"),core.qZA())}function SavedCartDetailsItemsComponent_ng_template_4_Template(rf,ctx){if(1&rf&&core._UZ(0,"cx-add-to-cart",8),2&rf){const ctx_r9=ctx.$implicit;core.Q6J("productCode",null==ctx_r9.item.product?null:ctx_r9.item.product.code)("product",ctx_r9.item.product)("showQuantity",!1)("options",ctx_r9.options)("pickupStore",null==ctx_r9.item.deliveryPointOfService?null:ctx_r9.item.deliveryPointOfService.name)}}function SavedCartDetailsOverviewComponent_ng_container_0_Template(rf,ctx){if(1&rf){const _r4=core.EpF();core.ynx(0),core.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),core._UZ(5,"cx-card",5),core.ALo(6,"async"),core.TgZ(7,"button",6,7),core.NdJ("click",__name(function(){const cart_r1=core.CHM(_r4).ngIf,ctx_r3=core.oxw();return core.KtG(ctx_r3.openDialog(cart_r1))},"SavedCartDetailsOverviewComponent_ng_container_0_Template_button_click_7_listener")),core.ALo(9,"cxTranslate"),core._UZ(10,"cx-icon",8),core.qZA()(),core.TgZ(11,"div",9),core._UZ(12,"cx-card",10),core.ALo(13,"async"),core.qZA()(),core.TgZ(14,"div",3),core._UZ(15,"cx-card",5),core.ALo(16,"async"),core.qZA(),core.TgZ(17,"div",3),core._UZ(18,"cx-card",5),core.ALo(19,"async"),core.ALo(20,"cxDate"),core._UZ(21,"cx-card",5),core.ALo(22,"async"),core.qZA(),core.TgZ(23,"div",3),core._UZ(24,"cx-card",5),core.ALo(25,"async"),core._UZ(26,"cx-card",5),core.ALo(27,"async"),core.qZA()()(),core.BQk()}if(2&rf){const cart_r1=ctx.ngIf,ctx_r0=core.oxw();core.xp6(5),core.Q6J("content",core.lcZ(6,11,ctx_r0.getCartName(null==cart_r1?null:cart_r1.name))),core.xp6(2),core.uIk("aria-label",core.lcZ(9,13,"savedCartDetails.editSavedCart")),core.xp6(3),core.Q6J("type",ctx_r0.iconTypes.PENCIL),core.xp6(2),core.Q6J("content",core.lcZ(13,15,ctx_r0.getCartDescription(null==cart_r1?null:cart_r1.description)))("truncateText",!0)("charactersLimit",30),core.xp6(3),core.Q6J("content",core.lcZ(16,17,ctx_r0.getCartId(null==cart_r1?null:cart_r1.code))),core.xp6(3),core.Q6J("content",core.lcZ(19,19,ctx_r0.getDateSaved(core.lcZ(20,21,null==cart_r1?null:cart_r1.saveTime)))),core.xp6(3),core.Q6J("content",core.lcZ(22,23,ctx_r0.getCartItems(null==cart_r1?null:cart_r1.totalItems))),core.xp6(3),core.Q6J("content",core.lcZ(25,25,ctx_r0.getCartQuantity(null==cart_r1?null:cart_r1.totalUnitCount))),core.xp6(2),core.Q6J("content",core.lcZ(27,27,ctx_r0.getCartTotal(null==cart_r1||null==cart_r1.totalPriceWithTax?null:cart_r1.totalPriceWithTax.formattedValue)))}}__name(SavedCartDetailsItemsComponent_ng_container_0_ng_container_1_Template,"SavedCartDetailsItemsComponent_ng_container_0_ng_container_1_Template"),__name(SavedCartDetailsItemsComponent_ng_container_0_Template,"SavedCartDetailsItemsComponent_ng_container_0_Template"),__name(SavedCartDetailsItemsComponent_ng_template_2_Template,"SavedCartDetailsItemsComponent_ng_template_2_Template"),__name(SavedCartDetailsItemsComponent_ng_template_4_Template,"SavedCartDetailsItemsComponent_ng_template_4_Template"),__name(SavedCartDetailsOverviewComponent_ng_container_0_Template,"SavedCartDetailsOverviewComponent_ng_container_0_Template");const _c4=__name(function(a0){return{savedCartId:a0}},"_c4"),_c5=__name(function(a1){return{cxRoute:"savedCartsDetails",params:a1}},"_c5");function SavedCartListComponent_ng_container_0_ng_container_1_ng_container_7_tr_22_Template(rf,ctx){if(1&rf){const _r12=core.EpF();core.TgZ(0,"tr",12),core.NdJ("click",__name(function(){const savedCart_r9=core.CHM(_r12).$implicit,ctx_r11=core.oxw(4);return core.KtG(ctx_r11.goToSavedCartDetails(savedCart_r9))},"SavedCartListComponent_ng_container_0_ng_container_1_ng_container_7_tr_22_Template_tr_click_0_listener")),core.TgZ(1,"td",13)(2,"div",14),core._uU(3),core.ALo(4,"cxTranslate"),core.qZA(),core.TgZ(5,"a",15),core.ALo(6,"cxUrl"),core._uU(7),core.qZA()(),core.TgZ(8,"td",16)(9,"div",14),core._uU(10),core.ALo(11,"cxTranslate"),core.qZA(),core.TgZ(12,"a",15),core.ALo(13,"cxUrl"),core._uU(14),core.qZA()(),core.TgZ(15,"td",17)(16,"div",14),core._uU(17),core.ALo(18,"cxTranslate"),core.qZA(),core.TgZ(19,"a",15),core.ALo(20,"cxUrl"),core._uU(21),core.ALo(22,"cxDate"),core.qZA()(),core.TgZ(23,"td",18)(24,"div",14),core._uU(25),core.ALo(26,"cxTranslate"),core.qZA(),core.TgZ(27,"a",15),core.ALo(28,"cxUrl"),core._uU(29),core.qZA()(),core.TgZ(30,"td",19)(31,"div",14),core._uU(32),core.ALo(33,"cxTranslate"),core.qZA(),core.TgZ(34,"a",15),core.ALo(35,"cxUrl"),core._uU(36),core.qZA()(),core.TgZ(37,"td",20),core._UZ(38,"div",14),core.TgZ(39,"button",21,22),core.NdJ("click",__name(function($event){const savedCart_r9=core.CHM(_r12).$implicit,ctx_r13=core.oxw(4);return core.KtG(ctx_r13.openDialog($event,savedCart_r9))},"SavedCartListComponent_ng_container_0_ng_container_1_ng_container_7_tr_22_Template_button_click_39_listener")),core._uU(41),core.ALo(42,"cxTranslate"),core.qZA()()()}if(2&rf){const savedCart_r9=ctx.$implicit;core.xp6(3),core.hij(" ",core.lcZ(4,16,"savedCartList.cartName")," "),core.xp6(2),core.Q6J("routerLink",core.lcZ(6,18,core.VKq(43,_c5,core.VKq(41,_c4,null==savedCart_r9?null:savedCart_r9.code)))),core.xp6(2),core.hij(" ",null==savedCart_r9?null:savedCart_r9.name,""),core.xp6(3),core.hij(" ",core.lcZ(11,20,"savedCartList.cartId")," "),core.xp6(2),core.Q6J("routerLink",core.lcZ(13,22,core.VKq(47,_c5,core.VKq(45,_c4,null==savedCart_r9?null:savedCart_r9.code)))),core.xp6(2),core.Oqu(null==savedCart_r9?null:savedCart_r9.code),core.xp6(3),core.hij(" ",core.lcZ(18,24,"savedCartList.dateSaved")," "),core.xp6(2),core.Q6J("routerLink",core.lcZ(20,26,core.VKq(51,_c5,core.VKq(49,_c4,null==savedCart_r9?null:savedCart_r9.code)))),core.xp6(2),core.Oqu(core.xi3(22,28,null==savedCart_r9?null:savedCart_r9.saveTime,"longDate")),core.xp6(4),core.hij(" ",core.lcZ(26,31,"savedCartList.quantity")," "),core.xp6(2),core.Q6J("routerLink",core.lcZ(28,33,core.VKq(55,_c5,core.VKq(53,_c4,null==savedCart_r9?null:savedCart_r9.code)))),core.xp6(2),core.hij(" ",null==savedCart_r9?null:savedCart_r9.totalUnitCount,""),core.xp6(3),core.hij(" ",core.lcZ(33,35,"savedCartList.total")," "),core.xp6(2),core.Q6J("routerLink",core.lcZ(35,37,core.VKq(59,_c5,core.VKq(57,_c4,null==savedCart_r9?null:savedCart_r9.code)))),core.xp6(2),core.hij(" ",null==savedCart_r9||null==savedCart_r9.totalPrice?null:savedCart_r9.totalPrice.formattedValue,""),core.xp6(5),core.hij(" ",core.lcZ(42,39,"savedCartList.makeCartActive")," ")}}function SavedCartListComponent_ng_container_0_ng_container_1_ng_container_7_Template(rf,ctx){if(1&rf&&(core.ynx(0),core.TgZ(1,"table",6)(2,"thead",7)(3,"th",8),core._uU(4),core.ALo(5,"cxTranslate"),core.qZA(),core.TgZ(6,"th",8),core._uU(7),core.ALo(8,"cxTranslate"),core.qZA(),core.TgZ(9,"th",8),core._uU(10),core.ALo(11,"cxTranslate"),core.qZA(),core.TgZ(12,"th",9),core._uU(13),core.ALo(14,"cxTranslate"),core.qZA(),core.TgZ(15,"th",10),core._uU(16),core.ALo(17,"cxTranslate"),core.qZA(),core.TgZ(18,"th",8),core._uU(19),core.ALo(20,"cxTranslate"),core.qZA()(),core.TgZ(21,"tbody"),core.YNc(22,SavedCartListComponent_ng_container_0_ng_container_1_ng_container_7_tr_22_Template,43,61,"tr",11),core.qZA()(),core.BQk()),2&rf){const savedCarts_r1=core.oxw(2).ngIf;core.xp6(4),core.hij(" ",core.lcZ(5,7,"savedCartList.cartName")," "),core.xp6(3),core.Oqu(core.lcZ(8,9,"savedCartList.cartId")),core.xp6(3),core.Oqu(core.lcZ(11,11,"savedCartList.dateSaved")),core.xp6(3),core.hij(" ",core.lcZ(14,13,"savedCartList.quantity")," "),core.xp6(3),core.hij(" ",core.lcZ(17,15,"savedCartList.total")," "),core.xp6(3),core.hij(" ",core.lcZ(20,17,"savedCartList.actions")," "),core.xp6(3),core.Q6J("ngForOf",savedCarts_r1)}}function SavedCartListComponent_ng_container_0_ng_container_1_ng_template_8_Template(rf,ctx){1&rf&&(core.TgZ(0,"div",23)(1,"div",24)(2,"div"),core._uU(3),core.ALo(4,"cxTranslate"),core.qZA()()()),2&rf&&(core.xp6(3),core.Oqu(core.lcZ(4,1,"savedCartList.notFound")))}__name(SavedCartListComponent_ng_container_0_ng_container_1_ng_container_7_tr_22_Template,"SavedCartListComponent_ng_container_0_ng_container_1_ng_container_7_tr_22_Template"),__name(SavedCartListComponent_ng_container_0_ng_container_1_ng_container_7_Template,"SavedCartListComponent_ng_container_0_ng_container_1_ng_container_7_Template"),__name(SavedCartListComponent_ng_container_0_ng_container_1_ng_template_8_Template,"SavedCartListComponent_ng_container_0_ng_container_1_ng_template_8_Template");const _c6=__name(function(a0){return{count:a0}},"_c6");function SavedCartListComponent_ng_container_0_ng_container_1_Template(rf,ctx){if(1&rf&&(core.ynx(0),core._UZ(1,"div",3),core.ALo(2,"cxTranslate"),core.TgZ(3,"div",4)(4,"h2"),core._uU(5),core.ALo(6,"cxTranslate"),core.qZA()(),core.YNc(7,SavedCartListComponent_ng_container_0_ng_container_1_ng_container_7_Template,23,19,"ng-container",1),core.YNc(8,SavedCartListComponent_ng_container_0_ng_container_1_ng_template_8_Template,5,3,"ng-template",null,5,core.W1O),core.BQk()),2&rf){const _r6=core.MAs(9),savedCarts_r1=core.oxw().ngIf;core.xp6(1),core.uIk("aria-label",core.lcZ(2,4,"common.loaded")),core.xp6(4),core.hij(" ",core.xi3(6,6,"savedCartList.savedCarts",core.VKq(9,_c6,savedCarts_r1.length))," "),core.xp6(2),core.Q6J("ngIf",(null==savedCarts_r1?null:savedCarts_r1.length)>0)("ngIfElse",_r6)}}function SavedCartListComponent_ng_container_0_ng_template_3_Template(rf,ctx){1&rf&&(core.TgZ(0,"div",25),core._UZ(1,"cx-spinner"),core.qZA())}function SavedCartListComponent_ng_container_0_Template(rf,ctx){if(1&rf&&(core.ynx(0),core.YNc(1,SavedCartListComponent_ng_container_0_ng_container_1_Template,10,11,"ng-container",1),core.ALo(2,"async"),core.YNc(3,SavedCartListComponent_ng_container_0_ng_template_3_Template,2,0,"ng-template",null,2,core.W1O),core.BQk()),2&rf){const _r3=core.MAs(4),ctx_r0=core.oxw();core.xp6(1),core.Q6J("ngIf",!core.lcZ(2,2,ctx_r0.isLoading$))("ngIfElse",_r3)}}function SavedCartFormDialogComponent_ng_container_0_ng_container_6_Template(rf,ctx){1&rf&&(core.ynx(0),core._uU(1),core.ALo(2,"cxTranslate"),core.BQk()),2&rf&&(core.xp6(1),core.hij(" ",core.lcZ(2,1,"savedCartDialog.editSavedCart")," "))}function SavedCartFormDialogComponent_ng_container_0_ng_container_7_Template(rf,ctx){1&rf&&(core.ynx(0),core._uU(1),core.ALo(2,"cxTranslate"),core.BQk()),2&rf&&(core.xp6(1),core.hij(" ",core.lcZ(2,1,"savedCartDialog.deleteSavedCart")," "))}function SavedCartFormDialogComponent_ng_container_0_ng_container_8_Template(rf,ctx){1&rf&&(core.ynx(0),core._uU(1),core.ALo(2,"cxTranslate"),core.BQk()),2&rf&&(core.xp6(1),core.hij(" ",core.lcZ(2,1,"savedCartDialog.saveForLater")," "))}function SavedCartFormDialogComponent_ng_container_0_ng_container_9_Template(rf,ctx){1&rf&&(core.ynx(0),core._uU(1),core.ALo(2,"cxTranslate"),core.BQk()),2&rf&&(core.xp6(1),core.hij(" ",core.lcZ(2,1,"savedCartDialog.restoreSavedCart")," "))}__name(SavedCartListComponent_ng_container_0_ng_container_1_Template,"SavedCartListComponent_ng_container_0_ng_container_1_Template"),__name(SavedCartListComponent_ng_container_0_ng_template_3_Template,"SavedCartListComponent_ng_container_0_ng_template_3_Template"),__name(SavedCartListComponent_ng_container_0_Template,"SavedCartListComponent_ng_container_0_Template"),__name(SavedCartFormDialogComponent_ng_container_0_ng_container_6_Template,"SavedCartFormDialogComponent_ng_container_0_ng_container_6_Template"),__name(SavedCartFormDialogComponent_ng_container_0_ng_container_7_Template,"SavedCartFormDialogComponent_ng_container_0_ng_container_7_Template"),__name(SavedCartFormDialogComponent_ng_container_0_ng_container_8_Template,"SavedCartFormDialogComponent_ng_container_0_ng_container_8_Template"),__name(SavedCartFormDialogComponent_ng_container_0_ng_container_9_Template,"SavedCartFormDialogComponent_ng_container_0_ng_container_9_Template");const _c7=__name(function(a0){return{name:a0}},"_c7");function SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_35_div_6_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",25)(1,"label")(2,"span",26),core._uU(3),core.ALo(4,"cxTranslate"),core.qZA(),core._UZ(5,"input",27),core.ALo(6,"cxTranslate"),core.qZA()()),2&rf){const ctx_r12=core.oxw(4);let tmp_1_0;core.xp6(3),core.hij(" ",core.lcZ(4,3,"savedCartDialog.nameOfCloneCart")," "),core.xp6(2),core.s9C("placeholder",core.xi3(6,5,"savedCartDialog.defaultCloneCartName",core.VKq(8,_c7,null==(tmp_1_0=ctx_r12.form.get("name"))?null:tmp_1_0.value))),core.Q6J("maxLength",ctx_r12.nameMaxLength)}}function SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_35_Template(rf,ctx){if(1&rf){const _r14=core.EpF();core.ynx(0),core.TgZ(1,"div",21)(2,"input",22),core.NdJ("change",__name(function(){core.CHM(_r14);const ctx_r13=core.oxw(3);return core.KtG(ctx_r13.toggleIsCloneSavedCart())},"SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_35_Template_input_change_2_listener")),core.qZA(),core.TgZ(3,"label",23),core._uU(4),core.ALo(5,"cxTranslate"),core.qZA()(),core.YNc(6,SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_35_div_6_Template,7,10,"div",24),core.BQk()}if(2&rf){const ctx_r8=core.oxw(3);core.xp6(2),core.Q6J("checked",ctx_r8.isCloneSavedCart),core.xp6(2),core.Oqu(core.lcZ(5,3,"savedCartDialog.keepCopySavedCart")),core.xp6(2),core.Q6J("ngIf",ctx_r8.isCloneSavedCart)}}function SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_41_button_1_Template(rf,ctx){if(1&rf){const _r17=core.EpF();core.TgZ(0,"button",29),core.NdJ("click",__name(function(){core.CHM(_r17);const ctx_r16=core.oxw(4);return core.KtG(ctx_r16.deleteCart(ctx_r16.cart.code))},"SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_41_button_1_Template_button_click_0_listener")),core.ALo(1,"cxTranslate"),core.ALo(2,"async"),core._uU(3),core.ALo(4,"cxTranslate"),core.qZA()}if(2&rf){const ctx_r15=core.oxw(4);core.Q6J("disabled",core.lcZ(2,5,ctx_r15.isDisableDeleteButton$)),core.uIk("aria-label",core.lcZ(1,3,"common.delete")),core.xp6(3),core.hij(" ",core.lcZ(4,7,"savedCartDialog.delete")," ")}}function SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_41_Template(rf,ctx){if(1&rf&&(core.ynx(0),core.YNc(1,SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_41_button_1_Template,5,9,"button",28),core.BQk()),2&rf){const ctx_r9=core.oxw(3);core.xp6(1),core.Q6J("ngIf",ctx_r9.cart.code)}}function SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_template_42_button_0_Template(rf,ctx){if(1&rf){const _r20=core.EpF();core.TgZ(0,"button",29),core.NdJ("click",__name(function(){core.CHM(_r20);const ctx_r19=core.oxw(4);return core.KtG(ctx_r19.restoreSavedCart(ctx_r19.cart.code))},"SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_template_42_button_0_Template_button_click_0_listener")),core.ALo(1,"async"),core.ALo(2,"cxTranslate"),core._uU(3),core.ALo(4,"cxTranslate"),core.qZA()}if(2&rf){const ctx_r18=core.oxw(4);core.Q6J("disabled",core.lcZ(1,3,ctx_r18.isDisableRestoreButton$)),core.uIk("aria-label",core.lcZ(2,5,"common.restore")),core.xp6(3),core.hij(" ",core.lcZ(4,7,"savedCartDialog.restore")," ")}}function SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_template_42_Template(rf,ctx){if(1&rf&&core.YNc(0,SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_template_42_button_0_Template,5,9,"button",28),2&rf){const ctx_r11=core.oxw(3);core.Q6J("ngIf",ctx_r11.cart.code)}}function SavedCartFormDialogComponent_ng_container_0_ng_container_16_Template(rf,ctx){if(1&rf){const _r22=core.EpF();core.ynx(0),core.TgZ(1,"p",13),core._uU(2),core.ALo(3,"cxTranslate"),core.qZA(),core.TgZ(4,"div",14)(5,"div",15)(6,"div",16),core._uU(7),core.ALo(8,"cxTranslate"),core.qZA(),core.TgZ(9,"div",17),core._uU(10),core.qZA()(),core.TgZ(11,"div",15)(12,"div",16),core._uU(13),core.ALo(14,"cxTranslate"),core.qZA(),core.TgZ(15,"div",17),core._uU(16),core.qZA()(),core.TgZ(17,"div",15)(18,"div",16),core._uU(19),core.ALo(20,"cxTranslate"),core.qZA(),core.TgZ(21,"div",17),core._uU(22),core.qZA()(),core.TgZ(23,"div",15)(24,"div",16),core._uU(25),core.ALo(26,"cxTranslate"),core.qZA(),core.TgZ(27,"div",17),core._uU(28),core.qZA()(),core.TgZ(29,"div",15)(30,"div",16),core._uU(31),core.ALo(32,"cxTranslate"),core.qZA(),core.TgZ(33,"div",17),core._uU(34),core.qZA()()(),core.YNc(35,SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_35_Template,7,5,"ng-container",0),core.TgZ(36,"div",18)(37,"button",19),core.NdJ("click",__name(function(){core.CHM(_r22);const ctx_r21=core.oxw(2);return core.KtG(ctx_r21.close("Close Save Cart Dialog"))},"SavedCartFormDialogComponent_ng_container_0_ng_container_16_Template_button_click_37_listener")),core.ALo(38,"cxTranslate"),core._uU(39),core.ALo(40,"cxTranslate"),core.qZA(),core.YNc(41,SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_41_Template,2,1,"ng-container",11),core.YNc(42,SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_template_42_Template,1,1,"ng-template",null,20,core.W1O),core.qZA(),core.BQk()}if(2&rf){const _r10=core.MAs(43),ctx_r5=core.oxw(2);core.xp6(2),core.hij(" ",core.lcZ(3,16,ctx_r5.layoutOption===ctx_r5.savedCartFormType.DELETE?"savedCartDialog.followingCartDelete":"savedCartDialog.followingCartRestore")," "),core.xp6(5),core.hij(" ",core.lcZ(8,18,"savedCartDialog.name")," "),core.xp6(3),core.hij(" ",null==ctx_r5.cart?null:ctx_r5.cart.name," "),core.xp6(3),core.hij(" ",core.lcZ(14,20,"savedCartDialog.id")," "),core.xp6(3),core.hij(" ",null==ctx_r5.cart?null:ctx_r5.cart.code," "),core.xp6(3),core.hij(" ",core.lcZ(20,22,"savedCartDialog.description")," "),core.xp6(3),core.hij(" ",null==ctx_r5.cart?null:ctx_r5.cart.description," "),core.xp6(3),core.hij(" ",core.lcZ(26,24,"savedCartDialog.quantity")," "),core.xp6(3),core.hij(" ",null==ctx_r5.cart?null:ctx_r5.cart.totalUnitCount," "),core.xp6(3),core.hij(" ",core.lcZ(32,26,"savedCartDialog.total")," "),core.xp6(3),core.hij(" ",null==ctx_r5.cart||null==ctx_r5.cart.totalPriceWithTax?null:ctx_r5.cart.totalPriceWithTax.formattedValue," "),core.xp6(1),core.Q6J("ngIf",ctx_r5.layoutOption===ctx_r5.savedCartFormType.RESTORE),core.xp6(2),core.uIk("aria-label",core.lcZ(38,28,"common.close")),core.xp6(2),core.hij(" ",core.lcZ(40,30,"savedCartDialog.cancel")," "),core.xp6(2),core.Q6J("ngIf",ctx_r5.layoutOption===ctx_r5.savedCartFormType.DELETE)("ngIfElse",_r10)}}function SavedCartFormDialogComponent_ng_container_0_ng_template_17_ng_container_0_Template(rf,ctx){1&rf&&(core.ynx(0),core.TgZ(1,"p",13),core._uU(2),core.ALo(3,"cxTranslate"),core.qZA(),core.BQk()),2&rf&&(core.xp6(2),core.hij(" ",core.lcZ(3,1,"savedCartDialog.itemsSavedForLater")," "))}function SavedCartFormDialogComponent_ng_container_0_ng_template_17_Template(rf,ctx){if(1&rf){const _r25=core.EpF();core.YNc(0,SavedCartFormDialogComponent_ng_container_0_ng_template_17_ng_container_0_Template,4,3,"ng-container",0),core.TgZ(1,"div",14),core.ynx(2),core.TgZ(3,"label")(4,"span",30),core._uU(5),core.ALo(6,"cxTranslate"),core.qZA(),core._UZ(7,"input",31)(8,"cx-form-errors",32),core.qZA(),core.BQk(),core.qZA(),core.TgZ(9,"div",14)(10,"label")(11,"span",30),core._uU(12),core.ALo(13,"cxTranslate"),core.TgZ(14,"span",33),core._uU(15),core.ALo(16,"cxTranslate"),core.qZA()(),core._UZ(17,"textarea",34)(18,"cx-form-errors",32),core.TgZ(19,"p",35),core._uU(20),core.ALo(21,"cxTranslate"),core.qZA()()(),core.TgZ(22,"div",18)(23,"button",36),core.NdJ("click",__name(function(){core.CHM(_r25);const ctx_r24=core.oxw(2);return core.KtG(ctx_r24.close("Close Save Cart Dialog"))},"SavedCartFormDialogComponent_ng_container_0_ng_template_17_Template_button_click_23_listener")),core.ALo(24,"cxTranslate"),core.ALo(25,"async"),core._uU(26),core.ALo(27,"cxTranslate"),core.qZA(),core.TgZ(28,"button",37),core.NdJ("click",__name(function(){core.CHM(_r25);const ctx_r26=core.oxw(2);return core.KtG(ctx_r26.saveOrEditCart(null==ctx_r26.cart?null:ctx_r26.cart.code))},"SavedCartFormDialogComponent_ng_container_0_ng_template_17_Template_button_click_28_listener")),core.ALo(29,"cxTranslate"),core.ALo(30,"async"),core._uU(31),core.ALo(32,"cxTranslate"),core.qZA()()}if(2&rf){const ctx_r7=core.oxw(2);core.Q6J("ngIf",ctx_r7.layoutOption===ctx_r7.savedCartFormType.SAVE),core.xp6(5),core.Oqu(core.lcZ(6,15,"savedCartDialog.savedCartName")),core.xp6(2),core.Q6J("maxLength",ctx_r7.nameMaxLength),core.xp6(1),core.Q6J("control",ctx_r7.form.get("name")),core.xp6(4),core.hij("",core.lcZ(13,17,"savedCartDialog.savedCartDescription")," "),core.xp6(3),core.hij(" (",core.lcZ(16,19,"savedCartDialog.optional"),") "),core.xp6(2),core.Q6J("maxLength",ctx_r7.descriptionMaxLength),core.xp6(1),core.Q6J("control",ctx_r7.form.get("description")),core.xp6(2),core.hij(" ",core.xi3(21,21,"savedCartDialog.charactersLeft",core.VKq(36,_c6,ctx_r7.descriptionsCharacterLeft))," "),core.xp6(3),core.Q6J("disabled",core.lcZ(25,26,ctx_r7.isLoading$)),core.uIk("aria-label",core.lcZ(24,24,"common.close")),core.xp6(3),core.hij(" ",core.lcZ(27,28,"savedCartDialog.cancel")," "),core.xp6(2),core.Q6J("disabled",core.lcZ(30,32,ctx_r7.isLoading$)),core.uIk("aria-label",core.lcZ(29,30,"common.save")),core.xp6(3),core.hij(" ",core.lcZ(32,34,"savedCartDialog.save")," ")}}function SavedCartFormDialogComponent_ng_container_0_Template(rf,ctx){if(1&rf){const _r28=core.EpF();core.ynx(0),core.TgZ(1,"div",1),core.NdJ("esc",__name(function(){core.CHM(_r28);const ctx_r27=core.oxw();return core.KtG(ctx_r27.close("Escape clicked"))},"SavedCartFormDialogComponent_ng_container_0_Template_div_esc_1_listener")),core.TgZ(2,"form",2)(3,"div",3),core.ynx(4,4),core.TgZ(5,"div",5),core.YNc(6,SavedCartFormDialogComponent_ng_container_0_ng_container_6_Template,3,3,"ng-container",6),core.YNc(7,SavedCartFormDialogComponent_ng_container_0_ng_container_7_Template,3,3,"ng-container",6),core.YNc(8,SavedCartFormDialogComponent_ng_container_0_ng_container_8_Template,3,3,"ng-container",6),core.YNc(9,SavedCartFormDialogComponent_ng_container_0_ng_container_9_Template,3,3,"ng-container",6),core.qZA(),core.BQk(),core.TgZ(10,"button",7),core.NdJ("click",__name(function(){core.CHM(_r28);const ctx_r29=core.oxw();return core.KtG(ctx_r29.close("Close Save Cart Dialog"))},"SavedCartFormDialogComponent_ng_container_0_Template_button_click_10_listener")),core.ALo(11,"async"),core.ALo(12,"cxTranslate"),core.TgZ(13,"span",8),core._UZ(14,"cx-icon",9),core.qZA()()(),core.TgZ(15,"div",10),core.YNc(16,SavedCartFormDialogComponent_ng_container_0_ng_container_16_Template,44,32,"ng-container",11),core.YNc(17,SavedCartFormDialogComponent_ng_container_0_ng_template_17_Template,33,38,"ng-template",null,12,core.W1O),core.qZA()()(),core.BQk()}if(2&rf){const _r6=core.MAs(18),ctx_r0=core.oxw();core.xp6(1),core.Q6J("cxFocus",ctx_r0.focusConfig),core.xp6(1),core.Q6J("formGroup",ctx_r0.form),core.xp6(2),core.Q6J("ngSwitch",ctx_r0.layoutOption),core.xp6(2),core.Q6J("ngSwitchCase",ctx_r0.savedCartFormType.EDIT),core.xp6(1),core.Q6J("ngSwitchCase",ctx_r0.savedCartFormType.DELETE),core.xp6(1),core.Q6J("ngSwitchCase",ctx_r0.savedCartFormType.SAVE),core.xp6(1),core.Q6J("ngSwitchCase",ctx_r0.savedCartFormType.RESTORE),core.xp6(1),core.Q6J("disabled",core.lcZ(11,12,ctx_r0.isLoading$)),core.uIk("aria-label",core.lcZ(12,14,"common.close")),core.xp6(4),core.Q6J("type",ctx_r0.iconTypes.CLOSE),core.xp6(2),core.Q6J("ngIf",ctx_r0.layoutOption===ctx_r0.savedCartFormType.DELETE||ctx_r0.layoutOption===ctx_r0.savedCartFormType.RESTORE)("ngIfElse",_r6)}}__name(SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_35_div_6_Template,"SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_35_div_6_Template"),__name(SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_35_Template,"SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_35_Template"),__name(SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_41_button_1_Template,"SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_41_button_1_Template"),__name(SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_41_Template,"SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_container_41_Template"),__name(SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_template_42_button_0_Template,"SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_template_42_button_0_Template"),__name(SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_template_42_Template,"SavedCartFormDialogComponent_ng_container_0_ng_container_16_ng_template_42_Template"),__name(SavedCartFormDialogComponent_ng_container_0_ng_container_16_Template,"SavedCartFormDialogComponent_ng_container_0_ng_container_16_Template"),__name(SavedCartFormDialogComponent_ng_container_0_ng_template_17_ng_container_0_Template,"SavedCartFormDialogComponent_ng_container_0_ng_template_17_ng_container_0_Template"),__name(SavedCartFormDialogComponent_ng_container_0_ng_template_17_Template,"SavedCartFormDialogComponent_ng_container_0_ng_template_17_Template"),__name(SavedCartFormDialogComponent_ng_container_0_Template,"SavedCartFormDialogComponent_ng_container_0_Template");class AddToSavedCartComponent{constructor(activeCartFacade,authService,routingService,vcr,launchDialogService){this.activeCartFacade=activeCartFacade,this.authService=authService,this.routingService=routingService,this.vcr=vcr,this.launchDialogService=launchDialogService,this.subscription=new Subscription.w,this.loggedIn=!1}ngOnInit(){this.cart$=(0,combineLatest.aj)([this.activeCartFacade.getActive(),this.authService.isUserLoggedIn()]).pipe((0,tap.b)(([_,loggedIn])=>this.loggedIn=loggedIn),(0,map.U)(([activeCart])=>activeCart)),this.disableSaveCartForLater$=this.cart$.pipe((0,map.U)(cart=>!cart.entries?.length))}saveCart(cart){this.subscription.add(this.disableSaveCartForLater$.subscribe(isDisabled=>{isDisabled||(this.loggedIn?this.openDialog(cart):this.routingService.go({cxRoute:"login"}))}))}openDialog(cart){const dialog=this.launchDialogService.openDialog("SAVED_CART",this.element,this.vcr,{cart,layoutOption:"save"});dialog&&this.subscription.add(dialog.pipe((0,take.q)(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}}__name(AddToSavedCartComponent,"AddToSavedCartComponent"),AddToSavedCartComponent.\u0275fac=__name(function(t){return new(t||AddToSavedCartComponent)(core.Y36(spartacus_cart_base_root.bu),core.Y36(spartacus_core.e80),core.Y36(spartacus_core.Znh),core.Y36(core.s_b),core.Y36(spartacus_storefront.Q3W))},"AddToSavedCartComponent_Factory"),AddToSavedCartComponent.\u0275cmp=core.Xpm({type:AddToSavedCartComponent,selectors:[["cx-add-to-saved-cart"]],viewQuery:__name(function(rf,ctx){if(1&rf&&core.Gf(_c0,5),2&rf){let _t;core.iGM(_t=core.CRH())&&(ctx.element=_t.first)}},"AddToSavedCartComponent_Query"),decls:2,vars:3,consts:[[4,"ngIf"],[1,"cx-add-to-saved-cart-container"],["cxAutoFocus","",1,"link","cx-action-link",3,"routerLink"],["tabindex","0","cxAutoFocus","",1,"link","cx-action-link",3,"click"],["element",""]],template:__name(function(rf,ctx){1&rf&&(core.YNc(0,AddToSavedCartComponent_ng_container_0_Template,13,14,"ng-container",0),core.ALo(1,"async")),2&rf&&core.Q6J("ngIf",core.lcZ(1,1,ctx.cart$))},"AddToSavedCartComponent_Template"),dependencies:[common.O5,router.rH,common.Ov,spartacus_core.X$D,spartacus_core.l2T],encapsulation:2,changeDetection:0});class AddToSavedCartModule{}__name(AddToSavedCartModule,"AddToSavedCartModule"),AddToSavedCartModule.\u0275fac=__name(function(t){return new(t||AddToSavedCartModule)},"AddToSavedCartModule_Factory"),AddToSavedCartModule.\u0275mod=core.oAB({type:AddToSavedCartModule}),AddToSavedCartModule.\u0275inj=core.cJS({providers:[(0,spartacus_core.i51)({cmsComponents:{AddToSavedCartsComponent:{component:AddToSavedCartComponent}}})],imports:[common.ez,router.Bz,spartacus_core.LUR,spartacus_core.bhT]});class SavedCartDetailsService{constructor(routingService,savedCartService){this.routingService=routingService,this.savedCartService=savedCartService,this.savedCartId$=this.routingService.getRouterState().pipe((0,map.U)(routingData=>routingData.state.params.savedCartId),(0,distinctUntilChanged.x)()),this.savedCart$=this.savedCartId$.pipe((0,filter.h)(cartId=>Boolean(cartId)),(0,tap.b)(savedCartId=>this.savedCartService.loadSavedCart(savedCartId)),(0,switchMap.w)(savedCartId=>this.savedCartService.get(savedCartId)),(0,shareReplay.d)({bufferSize:1,refCount:!0}))}getSavedCartId(){return this.savedCartId$}getCartDetails(){return this.savedCart$}}__name(SavedCartDetailsService,"SavedCartDetailsService"),SavedCartDetailsService.\u0275fac=__name(function(t){return new(t||SavedCartDetailsService)(core.LFG(spartacus_core.Znh),core.LFG(spartacus_cart_saved_cart_root.aD))},"SavedCartDetailsService_Factory"),SavedCartDetailsService.\u0275prov=core.Yz7({token:SavedCartDetailsService,factory:SavedCartDetailsService.\u0275fac,providedIn:"root"});class SavedCartDetailsActionComponent{constructor(savedCartDetailsService,vcr,launchDialogService){this.savedCartDetailsService=savedCartDetailsService,this.vcr=vcr,this.launchDialogService=launchDialogService,this.subscription=new Subscription.w,this.savedCartFormType=spartacus_cart_saved_cart_root.AE,this.savedCart$=this.savedCartDetailsService.getCartDetails()}openDialog(cart,type){const dialog=this.launchDialogService.openDialog("SAVED_CART",this.element,this.vcr,{cart,layoutOption:type});dialog&&this.subscription.add(dialog.pipe((0,take.q)(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}}__name(SavedCartDetailsActionComponent,"SavedCartDetailsActionComponent"),SavedCartDetailsActionComponent.\u0275fac=__name(function(t){return new(t||SavedCartDetailsActionComponent)(core.Y36(SavedCartDetailsService),core.Y36(core.s_b),core.Y36(spartacus_storefront.Q3W))},"SavedCartDetailsActionComponent_Factory"),SavedCartDetailsActionComponent.\u0275cmp=core.Xpm({type:SavedCartDetailsActionComponent,selectors:[["cx-saved-cart-details-action"]],viewQuery:__name(function(rf,ctx){if(1&rf&&core.Gf(_c0,5),2&rf){let _t;core.iGM(_t=core.CRH())&&(ctx.element=_t.first)}},"SavedCartDetailsActionComponent_Query"),decls:2,vars:3,consts:[[4,"ngIf"],[1,"cx-saved-cart-restore-btns","row"],[1,"col-xs-12","col-md-5","col-lg-4"],[1,"btn","btn-block","btn-secondary",3,"click"],["element",""],[1,"btn","btn-block","btn-primary",3,"click"]],template:__name(function(rf,ctx){1&rf&&(core.YNc(0,SavedCartDetailsActionComponent_ng_container_0_Template,12,6,"ng-container",0),core.ALo(1,"async")),2&rf&&core.Q6J("ngIf",core.lcZ(1,1,ctx.savedCart$))},"SavedCartDetailsActionComponent_Template"),dependencies:[common.O5,common.Ov,spartacus_core.X$D],encapsulation:2});class SavedCartDetailsItemsComponent{constructor(savedCartDetailsService,savedCartService,eventSercvice,globalMessageService,routingService,translation){this.savedCartDetailsService=savedCartDetailsService,this.savedCartService=savedCartService,this.eventSercvice=eventSercvice,this.globalMessageService=globalMessageService,this.routingService=routingService,this.translation=translation,this.subscription=new Subscription.w,this.CartOutlets=spartacus_cart_base_root.oC,this.CartType=spartacus_cart_base_root.EI,this.CartLocation=spartacus_cart_base_root.Bx,this.cartLoaded$=this.savedCartDetailsService.getSavedCartId().pipe((0,switchMap.w)(cartId=>this.savedCartService.isStable(cartId))),this.savedCart$=this.savedCartDetailsService.getCartDetails().pipe((0,tap.b)(cart=>{(cart?.entries??[]).length<=0&&cart?.code&&this.savedCartService.deleteSavedCart(cart.code)}))}ngOnInit(){this.subscription.add(this.eventSercvice.get(spartacus_cart_base_root.N0).pipe((0,take.q)(1),(0,mapTo.h)(!0)).subscribe(success=>this.onDeleteComplete(success))),this.buyItAgainTranslation$=this.translation.translate("addToCart.addToActiveCart")}onDeleteComplete(success){success&&(this.routingService.go({cxRoute:"savedCarts"}),this.globalMessageService.add({key:"savedCartDialog.deleteCartSuccess"},spartacus_core.xUg.MSG_TYPE_CONFIRMATION))}ngOnDestroy(){this.subscription?.unsubscribe()}}__name(SavedCartDetailsItemsComponent,"SavedCartDetailsItemsComponent"),SavedCartDetailsItemsComponent.\u0275fac=__name(function(t){return new(t||SavedCartDetailsItemsComponent)(core.Y36(SavedCartDetailsService),core.Y36(spartacus_cart_saved_cart_root.aD),core.Y36(spartacus_core.POd),core.Y36(spartacus_core.IWp),core.Y36(spartacus_core.Znh),core.Y36(spartacus_core.D7D))},"SavedCartDetailsItemsComponent_Factory"),SavedCartDetailsItemsComponent.\u0275cmp=core.Xpm({type:SavedCartDetailsItemsComponent,selectors:[["cx-saved-cart-details-items"]],decls:6,vars:3,consts:[[4,"ngIf"],["emptyCartItems",""],["addToCartBtn",""],[4,"ngIf","ngIfElse"],["role","status"],[1,"cart-details-wrapper"],[3,"cxOutlet","cxOutletContext"],[1,"cx-spinner"],[3,"productCode","product","showQuantity","options","pickupStore"]],template:__name(function(rf,ctx){1&rf&&(core.YNc(0,SavedCartDetailsItemsComponent_ng_container_0_Template,2,2,"ng-container",0),core.ALo(1,"async"),core.YNc(2,SavedCartDetailsItemsComponent_ng_template_2_Template,2,0,"ng-template",null,1,core.W1O),core.YNc(4,SavedCartDetailsItemsComponent_ng_template_4_Template,1,5,"ng-template",null,2,core.W1O)),2&rf&&core.Q6J("ngIf",core.lcZ(1,1,ctx.savedCart$))},"SavedCartDetailsItemsComponent_Template"),dependencies:[common.O5,spartacus_storefront.ORR,spartacus_storefront.$3S,spartacus_cart_base_components_add_to_cart.AddToCartComponent,common.Ov,spartacus_core.X$D],encapsulation:2,changeDetection:0});class SavedCartDetailsOverviewComponent{constructor(savedCartDetailsService,translation,vcr,launchDialogService){this.savedCartDetailsService=savedCartDetailsService,this.translation=translation,this.vcr=vcr,this.launchDialogService=launchDialogService,this.subscription=new Subscription.w,this.iconTypes=spartacus_storefront.e1G,this.savedCart$=this.savedCartDetailsService.getCartDetails()}getCartName(cartName){return this.translation.translate("savedCartDetails.cartName").pipe((0,filter.h)(()=>Boolean(cartName)),(0,map.U)(textTitle=>({title:textTitle,text:[cartName]})))}getCartDescription(cartDescription){return this.translation.translate("savedCartDetails.cartDescription").pipe((0,filter.h)(()=>Boolean(cartDescription)),(0,map.U)(textTitle=>({title:textTitle,text:[cartDescription]})))}getCartId(cartId){return this.translation.translate("savedCartDetails.cartId").pipe((0,filter.h)(()=>Boolean(cartId)),(0,map.U)(textTitle=>({title:textTitle,text:[cartId]})))}getDateSaved(saveTime){return this.translation.translate("savedCartDetails.dateSaved").pipe((0,filter.h)(()=>Boolean(saveTime)),(0,map.U)(textTitle=>({title:textTitle,text:[saveTime??""]})))}getCartItems(totalItems){return this.translation.translate("savedCartDetails.items").pipe((0,filter.h)(()=>Boolean(totalItems)),(0,map.U)(textTitle=>({title:textTitle,text:[totalItems.toString()]})))}getCartQuantity(totalUnitCount){return this.translation.translate("savedCartDetails.quantity").pipe((0,filter.h)(()=>Boolean(totalUnitCount)),(0,map.U)(textTitle=>({title:textTitle,text:[totalUnitCount.toString()]})))}getCartTotal(totalPriceWithTax){return this.translation.translate("savedCartDetails.total").pipe((0,filter.h)(()=>Boolean(totalPriceWithTax)),(0,map.U)(textTitle=>({title:textTitle,text:[totalPriceWithTax]})))}openDialog(cart){const dialog=this.launchDialogService.openDialog("SAVED_CART",this.element,this.vcr,{cart,layoutOption:"edit"});dialog&&this.subscription.add(dialog.pipe((0,take.q)(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}}__name(SavedCartDetailsOverviewComponent,"SavedCartDetailsOverviewComponent"),SavedCartDetailsOverviewComponent.\u0275fac=__name(function(t){return new(t||SavedCartDetailsOverviewComponent)(core.Y36(SavedCartDetailsService),core.Y36(spartacus_core.D7D),core.Y36(core.s_b),core.Y36(spartacus_storefront.Q3W))},"SavedCartDetailsOverviewComponent_Factory"),SavedCartDetailsOverviewComponent.\u0275cmp=core.Xpm({type:SavedCartDetailsOverviewComponent,selectors:[["cx-saved-cart-details-overview"]],viewQuery:__name(function(rf,ctx){if(1&rf&&core.Gf(_c0,5),2&rf){let _t;core.iGM(_t=core.CRH())&&(ctx.element=_t.first)}},"SavedCartDetailsOverviewComponent_Query"),decls:2,vars:3,consts:[[4,"ngIf"],[1,"cx-cart-summary"],[1,"container"],[1,"cx-summary-card"],[1,"cx-edit-container"],[3,"content"],[1,"cx-edit-cart",3,"click"],["element",""],[3,"type"],[1,"cx-card-description"],[3,"content","truncateText","charactersLimit"]],template:__name(function(rf,ctx){1&rf&&(core.YNc(0,SavedCartDetailsOverviewComponent_ng_container_0_Template,28,29,"ng-container",0),core.ALo(1,"async")),2&rf&&core.Q6J("ngIf",core.lcZ(1,1,ctx.savedCart$))},"SavedCartDetailsOverviewComponent_Template"),dependencies:[common.O5,spartacus_storefront.AkF,spartacus_storefront.oJW,common.Ov,spartacus_core.X$D,spartacus_core.dgE],encapsulation:2});class SavedCartDetailsModule{}__name(SavedCartDetailsModule,"SavedCartDetailsModule"),SavedCartDetailsModule.\u0275fac=__name(function(t){return new(t||SavedCartDetailsModule)},"SavedCartDetailsModule_Factory"),SavedCartDetailsModule.\u0275mod=core.oAB({type:SavedCartDetailsModule}),SavedCartDetailsModule.\u0275inj=core.cJS({imports:[common.ez,spartacus_core.LUR,spartacus_core.bhT,router.Bz,spartacus_storefront.dTQ,spartacus_storefront.cOq,spartacus_storefront.QX1,spartacus_storefront.Fme,spartacus_storefront.f5$,spartacus_cart_base_components_add_to_cart.AddToCartModule,spartacus_core.pEA.withConfig({cmsComponents:{SavedCartDetailsOverviewComponent:{component:SavedCartDetailsOverviewComponent,guards:[spartacus_core.a1M]},SavedCartDetailsItemsComponent:{component:SavedCartDetailsItemsComponent,guards:[spartacus_core.a1M]},SavedCartDetailsActionComponent:{component:SavedCartDetailsActionComponent,guards:[spartacus_core.a1M]}}})]});class SavedCartListComponent{constructor(routing,savedCartService,vcr,launchDialogService){this.routing=routing,this.savedCartService=savedCartService,this.vcr=vcr,this.launchDialogService=launchDialogService,this.subscription=new Subscription.w,this.savedCarts$=this.savedCartService.getList().pipe((0,map.U)(lists=>lists.sort((a,b)=>{const date1=a.saveTime?new Date(a.saveTime).getTime():(new Date).getTime();return(b.saveTime?new Date(b.saveTime).getTime():(new Date).getTime())-date1})))}ngOnInit(){this.isLoading$=this.savedCartService.getSavedCartListProcessLoading(),this.savedCartService.loadSavedCarts()}goToSavedCartDetails(cart){this.routing.go({cxRoute:"savedCartsDetails",params:{savedCartId:cart?.code}})}openDialog(event,cart){const dialog=this.launchDialogService.openDialog("SAVED_CART",this.restoreButton,this.vcr,{cart,layoutOption:spartacus_cart_saved_cart_root.AE.RESTORE});dialog&&this.subscription.add(dialog.pipe((0,take.q)(1)).subscribe()),event.stopPropagation()}ngOnDestroy(){this.savedCartService.clearSavedCarts(),this.savedCartService.clearSaveCart(),this.savedCartService.clearRestoreSavedCart(),this.subscription?.unsubscribe()}}__name(SavedCartListComponent,"SavedCartListComponent"),SavedCartListComponent.\u0275fac=__name(function(t){return new(t||SavedCartListComponent)(core.Y36(spartacus_core.Znh),core.Y36(spartacus_cart_saved_cart_root.aD),core.Y36(core.s_b),core.Y36(spartacus_storefront.Q3W))},"SavedCartListComponent_Factory"),SavedCartListComponent.\u0275cmp=core.Xpm({type:SavedCartListComponent,selectors:[["cx-saved-cart-list"]],viewQuery:__name(function(rf,ctx){if(1&rf&&core.Gf(_c0,5),2&rf){let _t;core.iGM(_t=core.CRH())&&(ctx.restoreButton=_t.first)}},"SavedCartListComponent_Query"),decls:2,vars:3,consts:[[4,"ngIf"],[4,"ngIf","ngIfElse"],["loading",""],["role","status"],[1,"cx-saved-cart-list-header"],["noSavedCarts",""],[1,"table","cx-saved-cart-list-table"],[1,"cx-saved-cart-list-thead-mobile"],["scope","col"],["scope","col",1,"cx-saved-cart-list-th-qty"],["scope","col",1,"cx-saved-cart-list-th-total"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"cx-saved-cart-list-cart-name"],[1,"cx-table-label-mobile","cx-saved-cart-list-label"],[1,"cx-saved-cart-list-value",3,"routerLink"],[1,"cx-saved-cart-list-cart-id"],[1,"cx-saved-cart-list-date-saved"],[1,"cx-saved-cart-list-quantity"],[1,"cx-saved-cart-list-total"],[1,"cx-saved-cart-list-make-cart-active"],[1,"btn","btn-tertiary","cx-saved-cart-make-active",3,"click"],["element",""],[1,"cx-saved-cart-list-no-saved-carts","row"],[1,"col-sm-12","col-md-6","col-lg-4"],[1,"cx-spinner"]],template:__name(function(rf,ctx){1&rf&&(core.YNc(0,SavedCartListComponent_ng_container_0_Template,5,4,"ng-container",0),core.ALo(1,"async")),2&rf&&core.Q6J("ngIf",core.lcZ(1,1,ctx.savedCarts$))},"SavedCartListComponent_Template"),dependencies:[common.sg,common.O5,router.rH,spartacus_storefront.ORR,common.Ov,spartacus_core.l2T,spartacus_core.X$D,spartacus_core.dgE],encapsulation:2,changeDetection:0});class SavedCartListModule{}__name(SavedCartListModule,"SavedCartListModule"),SavedCartListModule.\u0275fac=__name(function(t){return new(t||SavedCartListModule)},"SavedCartListModule_Factory"),SavedCartListModule.\u0275mod=core.oAB({type:SavedCartListModule}),SavedCartListModule.\u0275inj=core.cJS({providers:[(0,spartacus_core.i51)({cmsComponents:{AccountSavedCartHistoryComponent:{component:SavedCartListComponent,guards:[spartacus_core.a1M]}}})],imports:[common.ez,spartacus_core.bhT,router.Bz,spartacus_storefront.xuE,spartacus_core.LUR,spartacus_storefront.Fme]});class SavedCartOrderEntriesContext{constructor(importInfoService,userIdService,multiCartService,savedCartService,routingService){this.importInfoService=importInfoService,this.userIdService=userIdService,this.multiCartService=multiCartService,this.savedCartService=savedCartService,this.routingService=routingService,this.type=spartacus_cart_base_root.lM.SAVED_CART,this.savedCartId$=this.routingService.getRouterState().pipe((0,map.U)(routingData=>routingData.state.params.savedCartId),(0,distinctUntilChanged.x)())}addEntries(products){return this.add(products).pipe((0,switchMap.w)(cartId=>this.importInfoService.getResults(cartId)),(0,take.q)(products.length))}getEntries(){return this.savedCartId$.pipe((0,switchMap.w)(cartId=>this.savedCartService.get(cartId)),(0,map.U)(cart=>cart?.entries??[]))}add(products){return(0,combineLatest.aj)([this.userIdService.takeUserId(),this.savedCartId$]).pipe((0,tap.b)(([userId,cartId])=>this.multiCartService.addEntries(userId,cartId,products)),(0,map.U)(([_userId,cartId])=>cartId))}}__name(SavedCartOrderEntriesContext,"SavedCartOrderEntriesContext"),SavedCartOrderEntriesContext.\u0275fac=__name(function(t){return new(t||SavedCartOrderEntriesContext)(core.LFG(spartacus_cart_base_core.Qx),core.LFG(spartacus_core.XBV),core.LFG(spartacus_cart_base_root.WT),core.LFG(spartacus_cart_saved_cart_root.aD),core.LFG(spartacus_core.Znh))},"SavedCartOrderEntriesContext_Factory"),SavedCartOrderEntriesContext.\u0275prov=core.Yz7({token:SavedCartOrderEntriesContext,factory:SavedCartOrderEntriesContext.\u0275fac,providedIn:"root"});class NewSavedCartOrderEntriesContext{constructor(importInfoService,userIdService,multiCartService,savedCartService){this.importInfoService=importInfoService,this.userIdService=userIdService,this.multiCartService=multiCartService,this.savedCartService=savedCartService,this.type=spartacus_cart_base_root.lM.NEW_SAVED_CART}addEntries(products,savedCartInfo){return this.add(products,savedCartInfo).pipe((0,tap.b)(cartId=>{this.importInfoService.getResults(cartId).pipe((0,take.q)(products.length),every(productInfo=>productInfo.statusCode===spartacus_cart_base_root.QX.UNKNOWN_IDENTIFIER||productInfo.statusCode===spartacus_cart_base_root.QX.UNKNOWN_ERROR)).subscribe(isInvalid=>{isInvalid&&this.savedCartService.deleteSavedCart(cartId)})}),(0,switchMap.w)(cartId=>this.importInfoService.getResults(cartId)),(0,take.q)(products.length))}add(products,savedCartInfo){return this.userIdService.takeUserId().pipe((0,switchMap.w)(userId=>this.multiCartService.createCart({userId,extraData:{active:!1}}).pipe((0,map.U)(cart=>cart.code),(0,tap.b)(cartId=>{this.savedCartService.saveCart({cartId,saveCartName:savedCartInfo?.name,saveCartDescription:savedCartInfo?.description}),this.savedCartService.loadSavedCarts()}),(0,observeOn.QV)(queue.N),(0,debounce.D)(()=>this.savedCartService.getSaveCartProcessLoading().pipe((0,filter.h)(loading=>!loading))),(0,tap.b)(cartId=>this.multiCartService.addEntries(userId,cartId,products)))))}}__name(NewSavedCartOrderEntriesContext,"NewSavedCartOrderEntriesContext"),NewSavedCartOrderEntriesContext.\u0275fac=__name(function(t){return new(t||NewSavedCartOrderEntriesContext)(core.LFG(spartacus_cart_base_core.Qx),core.LFG(spartacus_core.XBV),core.LFG(spartacus_cart_base_root.WT),core.LFG(spartacus_cart_saved_cart_root.aD))},"NewSavedCartOrderEntriesContext_Factory"),NewSavedCartOrderEntriesContext.\u0275prov=core.Yz7({token:NewSavedCartOrderEntriesContext,factory:NewSavedCartOrderEntriesContext.\u0275fac,providedIn:"root"});class SavedCartFormDialogComponent{get descriptionsCharacterLeft(){return this.descriptionMaxLength-(this.form.get("description")?.value?.length||0)}handleClick(event){event.target.tagName===this.el.nativeElement.tagName&&this.close("Cross click")}constructor(launchDialogService,el,savedCartService,eventService,routingService,globalMessageService){this.launchDialogService=launchDialogService,this.el=el,this.savedCartService=savedCartService,this.eventService=eventService,this.routingService=routingService,this.globalMessageService=globalMessageService,this.subscription=new Subscription.w,this.savedCartFormType=spartacus_cart_saved_cart_root.AE,this.iconTypes=spartacus_storefront.e1G,this.descriptionMaxLength=250,this.nameMaxLength=50,this.isCloneSavedCart=!1,this.focusConfig={trap:!0,block:!0,autofocus:"button",focusOnEscape:!0}}ngOnInit(){this.resetSavedCartStates(),this.isLoading$=this.savedCartService.getSaveCartProcessLoading(),this.isDisableDeleteButton$=(0,merge.T)(this.eventService.get(spartacus_cart_base_root.aY).pipe((0,take.q)(1),(0,mapTo.h)(!0)),this.eventService.get(spartacus_cart_base_root.Ks).pipe((0,take.q)(1),(0,mapTo.h)(!1))),this.isDisableRestoreButton$=(0,combineLatest.aj)([this.savedCartService.getCloneSavedCartProcessLoading(),this.savedCartService.getRestoreSavedCartProcessLoading()]).pipe((0,map.U)(([isCloneLoading,isRestoreLoading])=>isCloneLoading||isRestoreLoading)),this.subscription.add(this.launchDialogService.data$.subscribe(data=>{this.cart=data.cart,this.layoutOption=data.layoutOption,this.build(this.cart)})),this.subscription.add(this.savedCartService.getSaveCartProcessSuccess().subscribe(success=>this.onComplete(success))),this.subscription.add(this.eventService.get(spartacus_cart_base_root.N0).pipe((0,take.q)(1),(0,mapTo.h)(!0)).subscribe(success=>this.onComplete(success))),this.subscription.add(this.savedCartService.getRestoreSavedCartProcessSuccess().subscribe(success=>this.onComplete(success)))}saveOrEditCart(cartId){if(this.form.invalid)this.form.markAllAsTouched(),spartacus_storefront.hfq.deepUpdateValueAndValidity(this.form);else{const name=this.form.get("name")?.value,description=this.form.get("description")?.value||"-";switch(this.layoutOption){case spartacus_cart_saved_cart_root.AE.SAVE:this.savedCartService.saveCart({cartId,saveCartName:name,saveCartDescription:description});break;case spartacus_cart_saved_cart_root.AE.EDIT:this.savedCartService.editSavedCart({cartId,saveCartName:name,saveCartDescription:description})}}}deleteCart(cartId){this.savedCartService.deleteSavedCart(cartId)}restoreSavedCart(cartId){this.isCloneSavedCart?this.savedCartService.cloneSavedCart(cartId,this.form.get("cloneName")?.value):this.savedCartService.restoreSavedCart(cartId)}close(reason){this.launchDialogService.closeDialog(reason)}onComplete(success){if(success)switch(this.layoutOption){case spartacus_cart_saved_cart_root.AE.DELETE:this.routingService.go({cxRoute:"savedCarts"}),this.globalMessageService.add({key:"savedCartDialog.deleteCartSuccess"},spartacus_core.xUg.MSG_TYPE_CONFIRMATION),this.close("Successfully deleted a saved cart");break;case spartacus_cart_saved_cart_root.AE.SAVE:this.close("Successfully saved cart"),this.savedCartService.clearSaveCart(),this.globalMessageService.add({key:"savedCartCartPage.messages.cartSaved",params:{cartName:this.form.get("name")?.value||this.cart?.code}},spartacus_core.xUg.MSG_TYPE_CONFIRMATION);break;case spartacus_cart_saved_cart_root.AE.EDIT:this.close("Successfully edited saved cart"),this.savedCartService.clearSaveCart(),this.globalMessageService.add({key:"savedCartDialog.editCartSuccess",params:{cartName:this.form.get("name")?.value||this.cart?.code}},spartacus_core.xUg.MSG_TYPE_CONFIRMATION);break;case spartacus_cart_saved_cart_root.AE.RESTORE:this.close("Successfully restored saved cart"),this.routingService.go({cxRoute:"savedCarts"}),this.resetSavedCartStates()}}toggleIsCloneSavedCart(){return this.isCloneSavedCart=!this.isCloneSavedCart}build(cart){const form=new fesm2020_forms.nJ({});form.setControl("name",new fesm2020_forms.p4("",[fesm2020_forms.kI.required,fesm2020_forms.kI.maxLength(this.nameMaxLength)])),form.setControl("description",new fesm2020_forms.p4("",[fesm2020_forms.kI.maxLength(this.descriptionMaxLength)])),form.setControl("isCloneSavedCart",new fesm2020_forms.p4("")),form.setControl("cloneName",new fesm2020_forms.p4("")),this.form=form,this.patchData(cart)}patchData(item){this.form.patchValue({...item})}resetSavedCartStates(){this.savedCartService.clearCloneSavedCart(),this.savedCartService.clearSaveCart(),this.savedCartService.clearRestoreSavedCart()}ngOnDestroy(){this.subscription?.unsubscribe(),this.close("close dialog")}}__name(SavedCartFormDialogComponent,"SavedCartFormDialogComponent"),SavedCartFormDialogComponent.\u0275fac=__name(function(t){return new(t||SavedCartFormDialogComponent)(core.Y36(spartacus_storefront.Q3W),core.Y36(core.SBq),core.Y36(spartacus_cart_saved_cart_root.aD),core.Y36(spartacus_core.POd),core.Y36(spartacus_core.Znh),core.Y36(spartacus_core.IWp))},"SavedCartFormDialogComponent_Factory"),SavedCartFormDialogComponent.\u0275cmp=core.Xpm({type:SavedCartFormDialogComponent,selectors:[["cx-saved-cart-form-dialog"]],hostBindings:__name(function(rf,ctx){1&rf&&core.NdJ("click",__name(function($event){return ctx.handleClick($event)},"SavedCartFormDialogComponent_click_HostBindingHandler"))},"SavedCartFormDialogComponent_HostBindings"),decls:1,vars:1,consts:[[4,"ngIf"],[1,"cx-saved-cart-form-dialog",3,"cxFocus","esc"],[1,"cx-saved-cart-form-container",3,"formGroup"],[1,"modal-header","cx-saved-cart-form-header"],[3,"ngSwitch"],[1,"cx-saved-cart-form-title","modal-title"],[4,"ngSwitchCase"],["type","button",1,"cx-saved-cart-form-close","close",3,"disabled","click"],["aria-hidden","true"],[3,"type"],[1,"cx-saved-cart-form-body"],[4,"ngIf","ngIfElse"],["saveAndEditCart",""],[1,"cx-saved-cart-form-subtitle"],[1,"cx-saved-cart-form-row"],[1,"cx-saved-cart-values-container"],[1,"cx-saved-cart-label"],[1,"cx-saved-cart-value"],[1,"cx-saved-cart-form-footer"],["type","button",1,"mr-2","btn","btn-secondary",3,"click"],["isRestoreSavedCart",""],[1,"cx-copy-saved-cart-row","form-check"],["id","cx-copy-saved-cart","type","checkbox",1,"cx-copy-saved-cart-input",3,"checked","change"],["for","cx-copy-saved-cart",1,"cx-copy-saved-cart-label"],["class","cx-copy-saved-cart-row",4,"ngIf"],[1,"cx-copy-saved-cart-row"],[1,"label-content"],["formControlName","cloneName","type","text",1,"form-control",3,"maxLength","placeholder"],["class","ml-2 btn btn-primary","type","button",3,"disabled","click",4,"ngIf"],["type","button",1,"ml-2","btn","btn-primary",3,"disabled","click"],[1,"cx-saved-carts-label","label-content"],["required","true","formControlName","name","required","","type","text",1,"form-control",3,"maxLength"],[3,"control"],[1,"cx-saved-carts-label-optional"],["formControlName","description","rows","5",1,"form-control",3,"maxLength"],[1,"cx-saved-carts-input-hint"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","button",1,"btn","btn-primary",3,"disabled","click"]],template:__name(function(rf,ctx){1&rf&&core.YNc(0,SavedCartFormDialogComponent_ng_container_0_Template,19,16,"ng-container",0),2&rf&&core.Q6J("ngIf",ctx.cart)},"SavedCartFormDialogComponent_Template"),dependencies:[common.O5,common.RF,common.n9,fesm2020_forms._Y,fesm2020_forms.Fj,fesm2020_forms.JJ,fesm2020_forms.JL,fesm2020_forms.Q7,fesm2020_forms.sg,fesm2020_forms.u,spartacus_storefront.Ahv,spartacus_storefront.oJW,spartacus_storefront.RRe,common.Ov,spartacus_core.X$D],encapsulation:2,changeDetection:0});const defaultSavedCartFormLayoutConfig={launch:{SAVED_CART:{inline:!0,component:SavedCartFormDialogComponent,dialogType:spartacus_storefront.Myk.DIALOG}}};class SavedCartFormDialogModule{}__name(SavedCartFormDialogModule,"SavedCartFormDialogModule"),SavedCartFormDialogModule.\u0275fac=__name(function(t){return new(t||SavedCartFormDialogModule)},"SavedCartFormDialogModule_Factory"),SavedCartFormDialogModule.\u0275mod=core.oAB({type:SavedCartFormDialogModule}),SavedCartFormDialogModule.\u0275inj=core.cJS({imports:[common.ez,fesm2020_forms.u5,fesm2020_forms.UX,spartacus_storefront.Fym,spartacus_core.LUR,spartacus_storefront.QX1,spartacus_storefront.oPH]});class SavedCartComponentsModule{}__name(SavedCartComponentsModule,"SavedCartComponentsModule"),SavedCartComponentsModule.\u0275fac=__name(function(t){return new(t||SavedCartComponentsModule)},"SavedCartComponentsModule_Factory"),SavedCartComponentsModule.\u0275mod=core.oAB({type:SavedCartComponentsModule}),SavedCartComponentsModule.\u0275inj=core.cJS({providers:[{provide:spartacus_cart_saved_cart_root.Fd,useExisting:SavedCartOrderEntriesContext},{provide:spartacus_cart_saved_cart_root.jk,useExisting:NewSavedCartOrderEntriesContext},(0,spartacus_core.i51)(defaultSavedCartFormLayoutConfig)],imports:[router.Bz,AddToSavedCartModule,SavedCartFormDialogModule,SavedCartListModule,SavedCartDetailsModule]});var ngrx_effects=__webpack_require__(8468),of=__webpack_require__(5202),empty=__webpack_require__(4614),withLatestFrom=__webpack_require__(9320),catchError=__webpack_require__(2155),startWith=__webpack_require__(3980),pluck=__webpack_require__(9235),ngrx_store=__webpack_require__(7776),spartacus_user_account_root=__webpack_require__(2945);class SavedCartAdapter{}__name(SavedCartAdapter,"SavedCartAdapter");class SavedCartConnector{constructor(adapter){this.adapter=adapter}get(userId,cartId){return this.adapter.load(userId,cartId)}getList(userId){return this.adapter.loadList(userId)}restoreSavedCart(userId,cartId){return this.adapter.restoreSavedCart(userId,cartId)}cloneSavedCart(userId,cartId,saveCartName){return this.adapter.cloneSavedCart(userId,cartId,saveCartName)}}__name(SavedCartConnector,"SavedCartConnector"),SavedCartConnector.\u0275fac=__name(function(t){return new(t||SavedCartConnector)(core.LFG(SavedCartAdapter))},"SavedCartConnector_Factory"),SavedCartConnector.\u0275prov=core.Yz7({token:SavedCartConnector,factory:SavedCartConnector.\u0275fac});const RESTORE_SAVED_CART="[Saved Cart] Restore Saved Cart",SAVE_CART="[Saved Cart] Save Cart",EDIT_SAVED_CART="[Saved Cart] Edit Saved Cart",CLONE_SAVED_CART="[Saved Cart] Clone Saved Cart";class LoadSavedCart extends spartacus_core.kPG.EntityLoadAction{constructor(payload){super(spartacus_cart_base_core.N4,payload.cartId),this.payload=payload,this.type="[Saved Cart] Load Saved Cart"}}__name(LoadSavedCart,"LoadSavedCart");class LoadSavedCartSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(spartacus_cart_base_core.N4,payload.cartId),this.payload=payload,this.type="[Saved Cart] Load Saved Cart Success"}}__name(LoadSavedCartSuccess,"LoadSavedCartSuccess");class LoadSavedCartFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(spartacus_cart_base_core.N4,payload.cartId,payload?.error),this.payload=payload,this.type="[Saved Cart] Load Saved Cart Fail"}}__name(LoadSavedCartFail,"LoadSavedCartFail");class LoadSavedCarts extends spartacus_core.kPG.EntityLoadAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-list"),this.payload=payload,this.type="[Saved Cart] Load Saved Carts"}}__name(LoadSavedCarts,"LoadSavedCarts");class LoadSavedCartsSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-list"),this.payload=payload,this.type="[Saved Cart] Load Saved Carts Success"}}__name(LoadSavedCartsSuccess,"LoadSavedCartsSuccess");class LoadSavedCartsFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-list",payload.error),this.payload=payload,this.type="[Saved Cart] Load Saved Carts Fail"}}__name(LoadSavedCartsFail,"LoadSavedCartsFail");class ClearSavedCarts extends spartacus_core.kPG.EntityLoaderResetAction{constructor(){super(spartacus_core.BzF,"saved-cart-list"),this.type="[Saved Cart] Clear Saved Carts"}}__name(ClearSavedCarts,"ClearSavedCarts");class RestoreSavedCart extends spartacus_core.kPG.EntityLoadAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-restore-cart"),this.payload=payload,this.type=RESTORE_SAVED_CART}}__name(RestoreSavedCart,"RestoreSavedCart");class RestoreSavedCartSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-restore-cart"),this.payload=payload,this.type="[Saved Cart] Restore Saved Cart Success"}}__name(RestoreSavedCartSuccess,"RestoreSavedCartSuccess");class RestoreSavedCartFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-restore-cart",payload.error),this.payload=payload,this.type="[Saved Cart] Restore Saved Cart Fail"}}__name(RestoreSavedCartFail,"RestoreSavedCartFail");class ClearRestoreSavedCart extends spartacus_core.kPG.EntityLoaderResetAction{constructor(){super(spartacus_core.BzF,"saved-cart-restore-cart"),this.type="[Saved Cart] Clear Restore Saved Cart"}}__name(ClearRestoreSavedCart,"ClearRestoreSavedCart");class SaveCart extends spartacus_core.kPG.EntityLoadAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-save-cart"),this.payload=payload,this.type=SAVE_CART}}__name(SaveCart,"SaveCart");class SaveCartSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-save-cart"),this.payload=payload,this.type="[Saved Cart] Save Cart Success"}}__name(SaveCartSuccess,"SaveCartSuccess");class SaveCartFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-save-cart",payload.error),this.payload=payload,this.type="[Saved Cart] Save Cart Fail"}}__name(SaveCartFail,"SaveCartFail");class ClearSaveCart extends spartacus_core.kPG.EntityLoaderResetAction{constructor(){super(spartacus_core.BzF,"saved-cart-save-cart"),this.type="[Saved Cart] Clear Save Cart"}}__name(ClearSaveCart,"ClearSaveCart");class EditSavedCart extends spartacus_core.kPG.EntityLoadAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-save-cart"),this.payload=payload,this.type=EDIT_SAVED_CART}}__name(EditSavedCart,"EditSavedCart");class EditSavedCartSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-save-cart"),this.payload=payload,this.type="[Saved Cart] Edit Saved Cart Success"}}__name(EditSavedCartSuccess,"EditSavedCartSuccess");class EditSavedCartFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-save-cart",payload.error),this.payload=payload,this.type="[Saved Cart] Edit Saved Cart Fail"}}__name(EditSavedCartFail,"EditSavedCartFail");class CloneSavedCart extends spartacus_core.kPG.EntityLoadAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-clone-cart"),this.payload=payload,this.type=CLONE_SAVED_CART}}__name(CloneSavedCart,"CloneSavedCart");class CloneSavedCartSuccess extends spartacus_core.kPG.EntitySuccessAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-clone-cart"),this.payload=payload,this.type="[Saved Cart] Clone Saved Cart Success"}}__name(CloneSavedCartSuccess,"CloneSavedCartSuccess");class CloneSavedCartFail extends spartacus_core.kPG.EntityFailAction{constructor(payload){super(spartacus_core.BzF,"saved-cart-clone-cart",payload.error),this.payload=payload,this.type="[Saved Cart] Clone Saved Cart Fail"}}__name(CloneSavedCartFail,"CloneSavedCartFail");class ClearCloneSavedCart extends spartacus_core.kPG.EntityLoaderResetAction{constructor(){super(spartacus_core.BzF,"saved-cart-clone-cart"),this.type="[Saved Cart] Clear Clone Saved Cart"}}__name(ClearCloneSavedCart,"ClearCloneSavedCart");class SavedCartEventBuilder{constructor(actionsSubject,eventService,stateEventService,multiCartService){this.actionsSubject=actionsSubject,this.eventService=eventService,this.stateEventService=stateEventService,this.multiCartService=multiCartService,this.register()}register(){this.registerRestoreSavedCartEvents(),this.registerSaveCartEvents(),this.registerEditSavedCartEvents(),this.registerCloneSavedCartEvents()}registerRestoreSavedCartEvents(){this.buildRestoreSavedCartEvents({action:RESTORE_SAVED_CART,event:spartacus_cart_saved_cart_root.$Q}),this.buildRestoreSavedCartEvents({action:"[Saved Cart] Restore Saved Cart Success",event:spartacus_cart_saved_cart_root.sY}),this.buildRestoreSavedCartEvents({action:"[Saved Cart] Restore Saved Cart Fail",event:spartacus_cart_saved_cart_root.Lr})}registerSaveCartEvents(){this.buildSaveCartSuccessEvent({action:"[Saved Cart] Save Cart Success",event:spartacus_cart_saved_cart_root.PN}),this.stateEventService.register({action:"[Saved Cart] Save Cart Fail",event:spartacus_cart_saved_cart_root.eV,factory:action=>(0,spartacus_core.PjU)(spartacus_cart_saved_cart_root.eV,{...action.payload,cartCode:action.payload.cartId})}),this.stateEventService.register({action:SAVE_CART,event:spartacus_cart_saved_cart_root.dE,factory:action=>(0,spartacus_core.PjU)(spartacus_cart_saved_cart_root.dE,{...action.payload,cartCode:action.payload.cartId})})}registerEditSavedCartEvents(){this.buildSaveCartSuccessEvent({action:"[Saved Cart] Edit Saved Cart Success",event:spartacus_cart_saved_cart_root.j$}),this.stateEventService.register({action:"[Saved Cart] Edit Saved Cart Fail",event:spartacus_cart_saved_cart_root.yt,factory:action=>(0,spartacus_core.PjU)(spartacus_cart_saved_cart_root.yt,{...action.payload,cartCode:action.payload.cartId})}),this.stateEventService.register({action:EDIT_SAVED_CART,event:spartacus_cart_saved_cart_root.Bi,factory:action=>(0,spartacus_core.PjU)(spartacus_cart_saved_cart_root.Bi,{...action.payload,cartCode:action.payload.cartId})})}registerCloneSavedCartEvents(){this.buildRestoreSavedCartEvents({action:CLONE_SAVED_CART,event:spartacus_cart_saved_cart_root.j4}),this.buildRestoreSavedCartEvents({action:"[Saved Cart] Clone Saved Cart Success",event:spartacus_cart_saved_cart_root.fT}),this.buildRestoreSavedCartEvents({action:"[Saved Cart] Clone Saved Cart Fail",event:spartacus_cart_saved_cart_root.gl})}buildRestoreSavedCartEvents(mapping){const eventStream$=this.getAction(mapping.action).pipe((0,switchMap.w)(action=>(0,of.of)(action).pipe((0,withLatestFrom.M)(this.multiCartService.getCart(action.payload.cartId)))),(0,map.U)(([action,cart])=>(0,spartacus_core.PjU)(mapping.event,{...action.payload,cartCode:cart.code,saveCartName:cart.name,saveCartDescription:cart.description,...cart.saveTime&&{saveTime:cart.saveTime}})));return this.eventService.register(mapping.event,eventStream$)}buildSaveCartSuccessEvent(mapping){const eventStream$=this.getAction(mapping.action).pipe((0,switchMap.w)(action=>(0,of.of)(action).pipe((0,withLatestFrom.M)(this.multiCartService.getCart(action.payload.cartId)))),(0,filter.h)(([,cart])=>Boolean(cart)),(0,map.U)(([action,cart])=>(0,spartacus_core.PjU)(mapping.event,{...action.payload,cartCode:cart.code,saveTime:cart.saveTime})));return this.eventService.register(mapping.event,eventStream$)}getAction(actionType){return this.actionsSubject.pipe((0,ngrx_effects.l4)(...[].concat(actionType)))}}__name(SavedCartEventBuilder,"SavedCartEventBuilder"),SavedCartEventBuilder.\u0275fac=__name(function(t){return new(t||SavedCartEventBuilder)(core.LFG(ngrx_store.UO),core.LFG(spartacus_core.POd),core.LFG(spartacus_core.vL$),core.LFG(spartacus_cart_base_root.WT))},"SavedCartEventBuilder_Factory"),SavedCartEventBuilder.\u0275prov=core.Yz7({token:SavedCartEventBuilder,factory:SavedCartEventBuilder.\u0275fac,providedIn:"root"});class SavedCartEventsModule{constructor(_savedCartEventBuilder){}}__name(SavedCartEventsModule,"SavedCartEventsModule"),SavedCartEventsModule.\u0275fac=__name(function(t){return new(t||SavedCartEventsModule)(core.LFG(SavedCartEventBuilder))},"SavedCartEventsModule_Factory"),SavedCartEventsModule.\u0275mod=core.oAB({type:SavedCartEventsModule}),SavedCartEventsModule.\u0275inj=core.cJS({});class SavedCartEffects{constructor(actions$,savedCartConnector,activeCartService,globalMessageService,cartConnector){this.actions$=actions$,this.savedCartConnector=savedCartConnector,this.activeCartService=activeCartService,this.globalMessageService=globalMessageService,this.cartConnector=cartConnector,this.loadSavedCart$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Saved Cart] Load Saved Cart"),(0,map.U)(action=>action.payload),(0,switchMap.w)(({userId,cartId})=>this.savedCartConnector.get(userId,cartId).pipe((0,switchMap.w)(savedCart=>[new spartacus_cart_base_core.$.LoadCartSuccess({userId,cartId,cart:savedCart}),new LoadSavedCartSuccess({userId,cartId})]),(0,catchError.K)(error=>(0,of.of)(new LoadSavedCartFail({userId,cartId,error:(0,spartacus_core.cxH)(error)}))))))),this.loadSavedCarts$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)("[Saved Cart] Load Saved Carts"),(0,map.U)(action=>action.payload),(0,switchMap.w)(({userId})=>this.savedCartConnector.getList(userId).pipe((0,switchMap.w)(savedCarts=>[new spartacus_cart_base_core.$.LoadCartsSuccess(savedCarts),new LoadSavedCartsSuccess({userId})]),(0,catchError.K)(error=>(0,of.of)(new LoadSavedCartsFail({userId,error:(0,spartacus_core.cxH)(error)}))))))),this.restoreSavedCart$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(RESTORE_SAVED_CART),(0,map.U)(action=>action.payload),(0,withLatestFrom.M)(this.activeCartService.getActive()),(0,switchMap.w)(([{userId,cartId},activeCart])=>{const actions=[];return(activeCart?.entries??[]).length>0&&activeCart.code&&actions.push(new EditSavedCart({userId,cartId:activeCart.code,saveCartName:"",saveCartDescription:""})),this.savedCartConnector.restoreSavedCart(userId,cartId).pipe((0,switchMap.w)(savedCart=>(this.globalMessageService.add({key:(activeCart?.entries??[]).length>0?"savedCartList.swapCartWithActiveCart":"savedCartList.swapCartNoActiveCart",params:{cartName:cartId,previousCartName:activeCart.code}},spartacus_core.xUg.MSG_TYPE_CONFIRMATION),[...actions,new spartacus_cart_base_core.$.LoadCartSuccess({userId,cartId,cart:savedCart,extraData:{active:!0}}),new RestoreSavedCartSuccess({userId,cartId})])),(0,catchError.K)(error=>(0,of.of)(new RestoreSavedCartFail({userId,cartId,error:(0,spartacus_core.cxH)(error)}))))}))),this.saveCart$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(SAVE_CART),(0,map.U)(action=>action.payload),(0,switchMap.w)(({userId,cartId,saveCartName,saveCartDescription})=>this.cartConnector.save(userId,cartId,saveCartName,saveCartDescription).pipe((0,switchMap.w)(savedCart=>[new spartacus_cart_base_core.$.ClearCartState,new spartacus_cart_base_core.$.LoadCartSuccess({userId,cartId,cart:savedCart}),new SaveCartSuccess({userId,cartId,saveCartName,saveCartDescription})]),(0,catchError.K)(error=>(0,of.of)(new SaveCartFail({userId,cartId,saveCartName,saveCartDescription,error:(0,spartacus_core.cxH)(error)}))))))),this.editSavedCart$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(EDIT_SAVED_CART),(0,map.U)(action=>action.payload),(0,switchMap.w)(({userId,cartId,saveCartName,saveCartDescription})=>this.cartConnector.save(userId,cartId,saveCartName,saveCartDescription).pipe((0,switchMap.w)(savedCart=>[new spartacus_cart_base_core.$.LoadCartSuccess({userId,cartId,cart:savedCart}),new EditSavedCartSuccess({userId,cartId,saveCartName,saveCartDescription})]),(0,catchError.K)(error=>(0,of.of)(new EditSavedCartFail({userId,cartId,saveCartName,saveCartDescription,error:(0,spartacus_core.cxH)(error)}))))))),this.cloneSavedCart$=(0,ngrx_effects.GW)(()=>this.actions$.pipe((0,ngrx_effects.l4)(CLONE_SAVED_CART),(0,map.U)(action=>action.payload),(0,switchMap.w)(({userId,cartId,saveCartName})=>this.savedCartConnector.cloneSavedCart(userId,cartId,saveCartName).pipe((0,switchMap.w)(_=>[new CloneSavedCartSuccess({userId,cartId,saveCartName}),new RestoreSavedCart({userId,cartId}),new LoadSavedCarts({userId})]),(0,catchError.K)(error=>(0,of.of)(new CloneSavedCartFail({userId,cartId,saveCartName,error:(0,spartacus_core.cxH)(error)})))))))}}__name(SavedCartEffects,"SavedCartEffects"),SavedCartEffects.\u0275fac=__name(function(t){return new(t||SavedCartEffects)(core.LFG(ngrx_effects.eX),core.LFG(SavedCartConnector),core.LFG(spartacus_cart_base_root.bu),core.LFG(spartacus_core.IWp),core.LFG(spartacus_cart_base_core.CQ))},"SavedCartEffects_Factory"),SavedCartEffects.\u0275prov=core.Yz7({token:SavedCartEffects,factory:SavedCartEffects.\u0275fac});const effects=[SavedCartEffects];class SavedCartStoreModule{}__name(SavedCartStoreModule,"SavedCartStoreModule"),SavedCartStoreModule.\u0275fac=__name(function(t){return new(t||SavedCartStoreModule)},"SavedCartStoreModule_Factory"),SavedCartStoreModule.\u0275mod=core.oAB({type:SavedCartStoreModule}),SavedCartStoreModule.\u0275inj=core.cJS({imports:[ngrx_effects.sQ.forFeature(effects)]});class SavedCartService{constructor(store,userIdService,userAccountFacade,multiCartService,eventService){this.store=store,this.userIdService=userIdService,this.userAccountFacade=userAccountFacade,this.multiCartService=multiCartService,this.eventService=eventService}loadSavedCart(cartId){this.userIdService.takeUserId(!0).subscribe(userId=>this.store.dispatch(new LoadSavedCart({userId,cartId})),()=>{})}get(cartId){return this.getSavedCart(cartId).pipe((0,observeOn.QV)(queue.N),(0,withLatestFrom.M)(this.eventService.get(spartacus_cart_base_root.aY).pipe((0,startWith.O)({}))),(0,filter.h)(([state,_event])=>!!state),(0,tap.b)(([state,event])=>{if(Object.keys(event).length>0)return empty.E;state.loading||state.success||state.error||this.loadSavedCart(cartId)}),(0,filter.h)(([state])=>state.success||!!state.error),(0,map.U)(([state])=>state.value))}getSavedCart(cartId){return this.multiCartService.getCartEntity(cartId)}isStable(cartId){return this.multiCartService.isStable(cartId)}loadSavedCarts(){this.userIdService.takeUserId(!0).subscribe(userId=>this.store.dispatch(new LoadSavedCarts({userId})),()=>{})}getList(){return this.getSavedCartList().pipe((0,withLatestFrom.M)(this.getSavedCartListProcess()),(0,tap.b)(([_,state])=>{state.loading||state.success||state.error||this.loadSavedCarts()}),(0,pluck.j)(0),(0,shareReplay.d)({bufferSize:1,refCount:!0}))}getSavedCartList(){return(0,combineLatest.aj)([this.multiCartService.getCarts(),this.userAccountFacade.get()]).pipe((0,distinctUntilChanged.x)(),(0,map.U)(([carts,user])=>carts.filter(cart=>(void 0===user?.customerId||cart?.name!==`wishlist${user?.customerId}`)&&!(0,spartacus_cart_base_core.F7)(cart?.code)&&cart?.saveTime)))}getSavedCartListProcessLoading(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessLoadingFactory("saved-cart-list")))}getSavedCartListProcess(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessStateFactory("saved-cart-list")))}clearSavedCarts(){this.store.dispatch(new ClearSavedCarts)}restoreSavedCart(cartId){this.userIdService.takeUserId(!0).subscribe(userId=>this.store.dispatch(new RestoreSavedCart({userId,cartId})),()=>{})}getRestoreSavedCartProcessLoading(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessLoadingFactory("saved-cart-restore-cart")))}getRestoreSavedCartProcessSuccess(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessSuccessFactory("saved-cart-restore-cart")))}getRestoreSavedCartProcessError(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessErrorFactory("saved-cart-restore-cart")))}clearRestoreSavedCart(){this.store.dispatch(new ClearRestoreSavedCart)}deleteSavedCart(cartId){this.userIdService.takeUserId(!0).subscribe(userId=>this.multiCartService.deleteCart(cartId,userId),()=>{})}saveCart({cartId,saveCartName,saveCartDescription}){this.userIdService.takeUserId(!0).subscribe(userId=>this.store.dispatch(new SaveCart({userId,cartId,saveCartName,saveCartDescription})),()=>{})}getSaveCartProcessLoading(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessLoadingFactory("saved-cart-save-cart")))}getSaveCartProcessSuccess(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessSuccessFactory("saved-cart-save-cart")))}getSaveCartProcessError(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessErrorFactory("saved-cart-save-cart")))}clearSaveCart(){this.store.dispatch(new ClearSaveCart)}editSavedCart({cartId,saveCartName,saveCartDescription}){this.userIdService.takeUserId(!0).subscribe(userId=>this.store.dispatch(new EditSavedCart({userId,cartId,saveCartName,saveCartDescription})),()=>{})}cloneSavedCart(cartId,saveCartName){this.userIdService.takeUserId(!0).subscribe(userId=>this.store.dispatch(new CloneSavedCart({userId,cartId,saveCartName})),()=>{})}getCloneSavedCartProcessLoading(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessLoadingFactory("saved-cart-clone-cart")))}getCloneSavedCartProcessSuccess(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessSuccessFactory("saved-cart-clone-cart")))}getCloneSavedCartProcessError(){return this.store.pipe((0,ngrx_store.Ys)(spartacus_core.VkE.getProcessErrorFactory("saved-cart-clone-cart")))}clearCloneSavedCart(){this.store.dispatch(new ClearCloneSavedCart)}}__name(SavedCartService,"SavedCartService"),SavedCartService.\u0275fac=__name(function(t){return new(t||SavedCartService)(core.LFG(ngrx_store.yh),core.LFG(spartacus_core.XBV),core.LFG(spartacus_user_account_root.gf),core.LFG(spartacus_cart_base_root.WT),core.LFG(spartacus_core.POd))},"SavedCartService_Factory"),SavedCartService.\u0275prov=core.Yz7({token:SavedCartService,factory:SavedCartService.\u0275fac});const facadeProviders=[SavedCartService,{provide:spartacus_cart_saved_cart_root.aD,useExisting:SavedCartService}];class SavedCartCoreModule{}__name(SavedCartCoreModule,"SavedCartCoreModule"),SavedCartCoreModule.\u0275fac=__name(function(t){return new(t||SavedCartCoreModule)},"SavedCartCoreModule_Factory"),SavedCartCoreModule.\u0275mod=core.oAB({type:SavedCartCoreModule}),SavedCartCoreModule.\u0275inj=core.cJS({providers:[SavedCartConnector,...facadeProviders],imports:[SavedCartStoreModule,SavedCartEventsModule]});var http=__webpack_require__(8664);class OccSavedCartAdapter{constructor(http2,occEndpoints,converter){this.http=http2,this.occEndpoints=occEndpoints,this.converter=converter}load(userId,cartId){return this.http.get(this.getSavedCartEndpoint(userId,cartId)).pipe((0,pluck.j)("savedCartData"),this.converter.pipeable(spartacus_cart_base_root.jK))}loadList(userId){return this.http.get(this.getSavedCartListEndpoint(userId)).pipe((0,pluck.j)("carts"),(0,map.U)(carts=>carts??[]),this.converter.pipeableMany(spartacus_cart_base_root.jK))}restoreSavedCart(userId,cartId){return this.http.patch(this.getRestoreSavedCartEndpoint(userId,cartId),cartId).pipe((0,pluck.j)("savedCartData"),this.converter.pipeable(spartacus_cart_base_root.jK))}cloneSavedCart(userId,cartId,saveCartName){return this.http.post(this.getCloneSavedCartEndpoint(userId,cartId,saveCartName),cartId).pipe((0,pluck.j)("savedCartData"),this.converter.pipeable(spartacus_cart_base_root.jK))}getSavedCartEndpoint(userId,cartId){return this.occEndpoints.buildUrl("savedCart",{urlParams:{userId,cartId}})}getSavedCartListEndpoint(userId){return this.occEndpoints.buildUrl("savedCarts",{urlParams:{userId}})}getRestoreSavedCartEndpoint(userId,cartId){return this.occEndpoints.buildUrl("restoreSavedCart",{urlParams:{userId,cartId}})}getCloneSavedCartEndpoint(userId,cartId,saveCartName){return this.occEndpoints.buildUrl("cloneSavedCart",{urlParams:{userId,cartId,saveCartName}})}}__name(OccSavedCartAdapter,"OccSavedCartAdapter"),OccSavedCartAdapter.\u0275fac=__name(function(t){return new(t||OccSavedCartAdapter)(core.LFG(http.eN),core.LFG(spartacus_core.Lz0),core.LFG(spartacus_core.IXI))},"OccSavedCartAdapter_Factory"),OccSavedCartAdapter.\u0275prov=core.Yz7({token:OccSavedCartAdapter,factory:OccSavedCartAdapter.\u0275fac});class SavedCartOccModule{}__name(SavedCartOccModule,"SavedCartOccModule"),SavedCartOccModule.\u0275fac=__name(function(t){return new(t||SavedCartOccModule)},"SavedCartOccModule_Factory"),SavedCartOccModule.\u0275mod=core.oAB({type:SavedCartOccModule}),SavedCartOccModule.\u0275inj=core.cJS({providers:[(0,spartacus_core.i51)({backend:{occ:{endpoints:{savedCarts:"/users/${userId}/carts?savedCartsOnly=true&fields=carts(DEFAULT,potentialProductPromotions,appliedProductPromotions,potentialOrderPromotions,appliedOrderPromotions,entries(totalPrice(formattedValue),product(images(FULL),stock(FULL)),basePrice(formattedValue,value),updateable),totalPrice(formattedValue),totalItems,totalPriceWithTax(formattedValue),totalDiscounts(value,formattedValue),subTotal(formattedValue),deliveryItemsQuantity,deliveryCost(formattedValue),totalTax(formattedValue, value),pickupItemsQuantity,net,appliedVouchers,productDiscounts(formattedValue),saveTime,user,name,description)",savedCart:"/users/${userId}/carts/${cartId}/savedcart",restoreSavedCart:"/users/${userId}/carts/${cartId}/restoresavedcart",cloneSavedCart:"/users/${userId}/carts/${cartId}/clonesavedcart?name=${saveCartName}"}}}}),{provide:SavedCartAdapter,useClass:OccSavedCartAdapter}],imports:[common.ez]});class SavedCartModule{}__name(SavedCartModule,"SavedCartModule"),SavedCartModule.\u0275fac=__name(function(t){return new(t||SavedCartModule)},"SavedCartModule_Factory"),SavedCartModule.\u0275mod=core.oAB({type:SavedCartModule}),SavedCartModule.\u0275inj=core.cJS({imports:[SavedCartCoreModule,SavedCartOccModule,SavedCartComponentsModule]})}};